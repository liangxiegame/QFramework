# UI Kit（2）打开、关闭界面
在上一篇，我们介绍要了 UI Kit 的最基本使用。

在这一篇，我们介绍下 UI Kit 的界面管理功能。

## UI Kit 的界面管理
在上一篇，我们运行一个独立的 UI 界面是通过 UIPanelTester 实现的。

UIPanelTester 是一个 UI 界面的测试器，它只能在编辑器环境下运行。

真正打开一个 UI 界面，是通过 UIKit.OpenPanel 这个 API 完成的。

比如，我们打开上一篇实现的 UIHomePanel，只需要写如下代码即可:

``` csharp
UIKIt.OpenPanel<UIHomePanel>();
```

代码非常简单。

而我们要关闭掉一个 UI 界面也比较容易，代码如下:
``` csharp
UIKit.ClosePanel<UIHomePanel>();
```

如果是在一个界面内部关掉自己的话，代码如下:
``` csharp
this.CloseSelf(); // this 是 UIPanel
```

OK，到此我们接触了 3 个 API：
* UIKit.OpenPanel\<T\>();
* UIKit.ClosePanel\<T\>();
* UIPanel.CloseSelf();

后边的两个没什么好讲的，很简单，但是第一个 API 比较重要，因为它有一些参数我们可以填。

## UIKit.OpenPanel
UIKit.OpenPanel 的参数定义如下：
![image.png](http://file.liangxiegame.com/75997535-685b-4170-9910-89391bd918df.png)
所有参数如下：
* canvasLevel：界面在哪个层级打开
    * 默认值：Common
* uiData：打开时可以给界面传的初始数据
    * 默认值：null
* assetBundleName：界面资源所在的 assetBundle 名
    * 默认值：null
* prefabName：如果界面名字和 prefab 名字不同，则以这个参数为准去加载界面资源
    * 默认值：null

都有默认值，所以这四个参数都可以不用传。

不过这四个 API 在某种情况下非常实用。

下边举一些例子。

``` csharp
// 在 Forward 层级打开
UIKit.OpenPanel<UIHomePanel>(UILevel.Forward);

// 传递初始数据给 UIHomePanel
UIKit.OpenPanel<UIHomePanel>(new UIHomePanelData()
{
    Coin = 10
});
            
// 从 UIHomePanelTest.prefab 加载界面 
UIKit.OpenPanel<UIHomePanel>(prefabName: "UIHomePanelTest");
```

都比较容易理解。

有的童鞋可能会问，我们给 UIHomePanel 传递的  UIHomePanelData，在哪里使用呢？

答案是在，OnInit 和 OnOpen 中，如下所示:
``` csharp
// ------------------------------------------------------------------------------
//  <autogenerated>
//      This code was generated by a tool.
//      Mono Runtime Version: 2.0.50727.1433
// 
//      Changes to this file may cause incorrect behavior and will be lost if 
//      the code is regenerated.
//  </autogenerated>
// ------------------------------------------------------------------------------

namespace QFramework.Example
{
    using System;
    using System.Collections;
    using System.Collections.Generic;
    using System.Linq;
    using UnityEngine;
    using UnityEngine.UI;
    
    
    public class UIHomePanelData : QFramework.UIPanelData
    {
        public int Coin;
    }
    
    public partial class UIHomePanel : QFramework.UIPanel
    {
        
        protected override void ProcessMsg(int eventId, QFramework.QMsg msg)
        {
            throw new System.NotImplementedException ();
        }
        
        protected override void OnInit(QFramework.IUIData uiData)
        {
            mData = uiData as UIHomePanelData ?? new UIHomePanelData();
            // please add init code here
            
            // 外边传进来的，第一次初始化的时候使用
            Debug.Log(mData.Coin);
        }
        
        protected override void OnOpen(QFramework.IUIData uiData)
        {
            // 每次 OpenPanel 的时候使用
            Debug.Log((uiData as UIHomePanelData).Coin);
        }
        
        protected override void OnShow()
        {

        }
        
        protected override void OnHide()
        {
        }
        
        protected override void OnClose()
        {
        }
    }
}

```

为什么要这样做呢？

因为笔者认为，界面就是用来展现数据的，数据尽量从外部主动填充，而不是在界面中做很多数据获取操作，这样能保证 UIPanel 的职责尽可能地清晰。职责清晰了代码自然就清晰了。

OK，此篇重点介绍了 UIKit.OpenPanel 这个 API，就写到这吧。
  
  
  