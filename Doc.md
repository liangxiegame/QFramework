# 1. ä»‹ç»
# 01. ç®€ä»‹

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ QFramework çš„ä½œè€… å‡‰é‹ï¼ŒQFramework ä»ç¬¬ä¸€æ¬¡ä»£ç æäº¤åˆ°ç°åœ¨å¿« 7 å¹´äº†ï¼ˆ2015 å¹´ 12 æœˆ \~ 2022 å¹´ 10 æœˆï¼‰äº†ï¼Œè€Œç»è¿‡äº† 7 å¹´æ—¶é—´çš„æ‰“ç£¨ï¼Œæˆ‘ä»¬ç»ˆäºè¿æ¥äº† v1.0 ç‰ˆæœ¬ã€‚

æ­¤æ•™ç¨‹ï¼Œå°†æ”¶å½•äº QFramework çš„å®˜æ–¹æ–‡æ¡£ï¼Œå‘å¸ƒäº qframework.cnï¼ŒåŒæ—¶ä¹Ÿä¼šåŒ…å«åœ¨ QFramework.Toolkits çš„ç¼–è¾‘å™¨å†…ç½®æ–‡æ¡£ä¸­ã€‚

## QFramework ç®€ä»‹

QFramework æ˜¯ä¸€å¥—æ¸è¿›å¼ã€å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œé€‚ç”¨äºä»»ä½•ç±»å‹çš„æ¸¸æˆåŠåº”ç”¨é¡¹ç›®ã€‚

QFramework åŒ…å«ä¸€å¥— å¼€å‘æ¶æ„ å’Œ å¤§é‡çš„å·¥å…·é›†ã€‚

QFramework ç‰¹æ€§é€Ÿè§ˆï¼š

*   å¼€å‘æ¶æ„ï¼ˆQFramework.csï¼‰
  *   ç®€å•ã€æ˜“ä¸Šæ‰‹ã€å¼ºå¤§
  *   MVC
  *   IOCã€åˆ†å±‚æ”¯æŒ
  *   CQRS æ”¯æŒ
  *   ç¬¦åˆ SOLIDåŸåˆ™
  *   å¯ä»¥ä½¿ç”¨ DDD çš„æ–¹å¼è®¾è®¡é¡¹ç›®
  *   ä¸åˆ° 1000 è¡Œä»£ç 
*   å·¥å…·é›†ï¼ˆQFramework.Toolkitsï¼‰
  *   UIKit ç•Œé¢\&Viewå¿«é€Ÿå¼€å‘&ç®¡ç†è§£å†³æ–¹æ¡ˆ
    *   UIã€GameObject çš„ä»£ç ç”Ÿæˆ&è‡ªåŠ¨èµ‹å€¼
    *   ç•Œé¢ç®¡ç†
    *   å±‚çº§ç®¡ç†
    *   ç•Œé¢å †æ ˆ
    *   é»˜è®¤ä½¿ç”¨ ResKit æ–¹å¼ç®¡ç†ç•Œé¢èµ„æº
    *   å¯è‡ªå®šä¹‰ç•Œé¢çš„åŠ è½½ã€å¸è½½æ–¹å¼
    *   Manager Of Manager æ¶æ„é›†æˆï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
  *   ResKit èµ„æºå¿«é€Ÿå¼€å‘&ç®¡ç†è§£å†³æ–¹æ¡ˆ
    *   AssetBundle æä¾›æ¨¡æ‹Ÿæ¨¡å¼ï¼Œå¼€å‘é˜¶æ®µæ— éœ€æ‰“åŒ…å³å¯åŠ è½½èµ„æº
    *   èµ„æºåç§°ä»£ç ç”Ÿæˆæ”¯æŒ
    *   åŒä¸€ä¸ª API å¯åŠ è½½ AssetBundleã€Resourcesã€ç½‘ç»œ å’Œ è‡ªå®šä¹‰æ¥æºçš„èµ„æº
    *   æä¾›ä¸€å¥—å¼•ç”¨è®¡æ•°çš„èµ„æºç®¡ç†æ¨¡å‹
  *   AudioKit éŸ³é¢‘ç®¡ç†è§£å†³æ–¹æ¡ˆ
    *   æä¾›èƒŒæ™¯éŸ³ä¹ã€äººå£°ã€éŸ³æ•ˆ ä¸‰ç§éŸ³é¢‘æ’­æ”¾ API
    *   éŸ³é‡æ§åˆ¶
    *   é»˜è®¤ä½¿ç”¨ ResKit æ–¹å¼ç®¡ç†éŸ³é¢‘èµ„æº
    *   å¯è‡ªå®šä¹‰éŸ³é¢‘çš„åŠ è½½ã€å¸è½½æ–¹å¼
  *   CoreKit æä¾›å¤§é‡çš„ä»£ç å·¥å…·
    *   ActionKitï¼šåŠ¨ä½œåºåˆ—æ‰§è¡Œç³»ç»Ÿ
    *   CodeGenKitï¼šä»£ç ç”Ÿæˆ & è‡ªåŠ¨åºåˆ—åŒ–èµ‹å€¼å·¥å…·
    *   EventKitï¼šæä¾›åŸºäºç±»ã€å­—ç¬¦ä¸²ã€æšä¸¾ä»¥åŠä¿¡å·ç±»å‹çš„äº‹ä»¶å·¥å…·é›†
    *   FluentAPIï¼šå¯¹å¤§é‡çš„ Unity å’Œ C# å¸¸ç”¨çš„ API æä¾›äº†é™æ€æ‰©å±•çš„å°è£…ï¼ˆé“¾å¼ APIï¼‰
    *   IOCKitï¼šæä¾›ä¾èµ–æ³¨å…¥å®¹å™¨
    *   LocaleKitï¼šæœ¬åœ°åŒ–&å¤šè¯­è¨€å·¥å…·é›†
    *   LogKitï¼šæ—¥å¿—å·¥å…·é›†
    *   PackageKitï¼šåŒ…ç®¡ç†å·¥å…·ï¼Œç”±æ­¤å¯æ›´æ–°æ¡†æ¶å’Œå¯¹åº”çš„æ’ä»¶æ¨¡å—ã€‚
    *   PoolKitï¼šå¯¹è±¡æ± å·¥å…·é›†ï¼Œæä¾›å¯¹è±¡æ± çš„åŸºç¡€ä¸Šï¼Œä¹Ÿæä¾› ListPool å’Œ Dictionary Pool ç­‰å·¥å…·ã€‚
    *   SingletonKitï¼šå•ä¾‹å·¥å…·é›†
    *   TableKitï¼šæä¾›è¡¨æ ¼ç±»æ•°æ®ç»“æ„çš„å·¥å…·é›†

QFramework çš„è®¾è®¡å“²å­¦æ˜¯ä»æ¯ä¸ªç»†èŠ‚ä¸Šæå‡å¼€å‘æ•ˆç‡ã€‚

åŒæ—¶ QFramework è¿˜åŒ…å«ä¸°å¯Œçš„ç”Ÿæ€ã€‚

*QFrameowrk.Toolkits å†…ç½®ç¼–è¾‘å™¨*

![image.png](https://file.liangxiegame.com/d15a75ba-8d6d-4d77-b096-a93c559d29b9.png)

*èµ„æº*

| **ç‰ˆæœ¬**                          |                                                                                                   |                                                                                                                                                                                                                            |
| ------------------------------- | ------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| QFramework.cs                   | QFramework æœ¬ä½“æ¶æ„çš„å®ç°                                                                                |                                                                                                                                                                                                                            |
| QFramework.cs  ç¤ºä¾‹               | QFramework.cs ä¸å®˜æ–¹ç¤ºä¾‹ï¼š CounterAppã€ã€Šç‚¹ç‚¹ç‚¹ã€‹ã€FlappyBirdã€CubeMasterã€ShootingEditor2Dã€è´ªåƒè›‡ç­‰                 | [github](https://github.com/liangxiegame/QFramework/blob/master/QFramework.cs.Examples.unitypackage)\|[gitee](https://gitee.com/liangxiegame/QFramework/blob/master/QFramework.cs.Examples.unitypackage)                   |
| QFramework.Toolkits             | QFramework  é›†æˆ CoreKit/UIKit/ActionKit/ResKit/PackageKit/AudioKit ç­‰å…¨éƒ¨å®˜æ–¹å·¥å…·ï¼ˆå·²åŒ…å« QFramework.cs å’Œ ç¤ºä¾‹) | [github](https://github.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.unitypackage)\|[gitee](https://gitee.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.unitypackage)                         |
| QFramework.Toolkits.Demo.WuZiQi | ä½¿ç”¨ QFramework.Toolkits å¼€å‘çš„äº”å­æ£‹ Demoï¼ˆéœ€è¦å®‰è£…å¥½  QFramework.Toolkitsï¼‰                                    | [github](https://github.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.Demo.WuZiQi.unitypackage)\|[gitee](https://gitee.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.Demo.WuZiQi.unitypackage) |
| QFramework.Toolkits.Demo.Saolei | ä½¿ç”¨ QFramework.Toolkits å¼€å‘çš„æ‰«é›· Demoï¼ˆéœ€è¦å®‰è£…å¥½  QFramework.Toolkitsï¼‰                                     | [github](https://github.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.Demo.SaoLei.unitypackage)\|[gitee](https://gitee.com/liangxiegame/QFramework/blob/master/QFramework.Toolkits.Demo.SaoLei.unitypackage) |
| QFramework.ToolKitsPro          | åœ¨ ToolKits åŸºç¡€ä¸Šé›†æˆæ›´å¤šå¥½ç”¨çš„å·¥å…·çš„ç‰ˆæœ¬ï¼ˆå·²åŒ…å« QFramework.Toolkitsï¼‰                                               | [AssetStore](http://u3d.as/SJ9)                                                                                                                                                                                            |
| **ç¾¤å‹æ¡ˆä¾‹**                        |                                                                                                   |                                                                                                                                                                                                                            |
| èµ›è½¦æ¸¸æˆã€ŠCrazy Carã€‹                 | ç¾¤å‹ [TastSong](https://github.com/TastSong) ä½¿ç”¨ QF è¿›è¡Œé‡æ„çš„å¼€æºèµ›è½¦æ¸¸æˆ                                      | [æ¸¸æˆä¸»é¡µ(Github](https://github.com/TastSong/CrazyCar))                                                                                                                                                                       |
| **ç¤¾åŒº**                          |                                                                                                   |                                                                                                                                                                                                                            |
| QQ ç¾¤:623597263                  | äº¤æµç¾¤                                                                                               | [ç‚¹å‡»åŠ ç¾¤](http://shang.qq.com/wpa/qunwpa?idkey=706b8eef0fff3fe4be9ce27c8702ad7d8cc1bceabe3b7c0430ec9559b3a9ce66)                                                                                                              |
| github issue                    | github ç¤¾åŒº                                                                                         | [åœ°å€](https://github.com/liangxiegame/QFramework/issues/new)                                                                                                                                                                |
| gitee issue                     | gitee ç¤¾åŒºï¼ˆå›½å†…è®¿é—®å¿«ï¼‰                                                                                   | [åœ°å€](https://gitee.com/liangxiegame/QFramework/issues)                                                                                                                                                                     |
| **æ•™ç¨‹**                          |                                                                                                   |                                                                                                                                                                                                                            |
| ã€Šæ¡†æ¶æ­å»º å†³å®šç‰ˆã€‹                      | æ•™ç¨‹ QFramework  çš„æ ¸å¿ƒæ¶æ„æ˜¯æ€ä¹ˆæ¼”åŒ–è¿‡æ¥çš„ï¼Ÿ                                                                     | [è¯¾ç¨‹ä¸»é¡µ](https://learn.u3d.cn/tutorial/framework_design)\|[å­¦ç”Ÿè¯¾å ‚ç¬”è®°1](https://github.com/Haogehaojiu/FrameworkDesign)\|[å­¦ç”Ÿè¯¾å ‚ç¬”è®°2](https://github.com/Haogehaojiu/ShootingEditor2D)                                              |
| **äº§å“æ¡ˆä¾‹**                        |                                                                                                   |                                                                                                                                                                                                                            |
| ç‹¬ç«‹æ¸¸æˆã€Šé¬¼å±±ä¹‹ä¸‹ã€‹                      | ä½¿ç”¨ QF åˆ¶ä½œçš„ç‹¬ç«‹æ¸¸æˆ                                                                                     | [æ¸¸æˆä¸»é¡µ(Steam)](https://store.steampowered.com/app/1517160/_/)                                                                                                                                                               |
| æ‰‹æœºæ¸¸æˆã€Šè°éŸ³æ¢—æŒ‘æˆ˜ã€‹                     | ä½¿ç”¨ QF åˆ¶ä½œçš„æ‰‹æœºæ¸¸æˆ                                                                                     | [æ¸¸æˆä¸»é¡µ(TapTap)](https://www.taptap.com/app/201075)                                                                                                                                                                          |
| ç‹¬ç«‹æ¸¸æˆã€Šæ¨ç­æ³¡æ³¡å§†ã€‹                     | â€QF ç¾¤å‹ï¼Œå¤§å­¦ç”Ÿå›¢é˜Ÿåˆ¶ä½œçš„ç‹¬ç«‹æ¸¸æˆï¼Œç»ˆäºç­‰åˆ°ä¸Šæ¶å•¦ï¼Œäº²è‡ªæ¸¸ç©è¿‡ï¼Œå¾ˆå¥½ç©ï¼Œå¤§å®¶å¤šå¤šæ”¯~ï¼ˆP.S ä½¿ç”¨ QF.cs ä½œä¸ºæ¶æ„å¼€å‘çš„å“¦~ï¼‰                              | [æ¸¸æˆä¸»é¡µ(TapTap)](https://www.taptap.com/app/233228)                                                                                                                                                                          |
| **å®˜æ–¹å·¥å…·**ï¼ˆç‹¬ç«‹ç‰ˆæœ¬ï¼Œä¸äº’ç›¸ä¾èµ–)            |                                                                                                   |                                                                                                                                                                                                                            |
| SingletonKit                    | æ˜“ä¸Šæ‰‹åŠŸèƒ½å¼ºå¤§çš„å•ä¾‹å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                            | [github](https://github.com/liangxiegame/SingletonKit)\|[gitee](https://gitee.com/liangxiegame/SingletonKit)                                                                                                               |
| ExtensionKit                    | æ˜“ä¸Šæ‰‹åŠŸèƒ½å¼ºå¤§çš„ C#/UnityAPI çš„é™æ€æ‰©å±• ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                             | [github](https://github.com/liangxiegame/ExtensionKit)\|[gitee](https://gitee.com/liangxiegame/ExtensionKit)                                                                                                               |
| IOCKit                          | æ˜“ä¸Šæ‰‹åŠŸèƒ½å¼ºå¤§çš„ IOC å®¹å™¨ ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                        | [github](https://github.com/liangxiegame/IOCKit)\|[gitee](https://gitee.com/liangxiegame/IOCKit)                                                                                                                           |
| TableKit                        | ä¸€å¥—ç±»ä¼¼è¡¨æ ¼çš„æ•°æ®ç»“æ„ï¼ˆList\<List\<T>>)ï¼Œå…¼é¡¾æŸ¥è¯¢æ•ˆç‡å’Œè”åˆå¼ºå¤§çš„æŸ¥è¯¢åŠŸèƒ½ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                           | [github](https://github.com/liangxiegame/TableKit)\|[gitee](https://gitee.com/liangxiegame/TableKit)                                                                                                                       |
| PoolKit                         | å¯¹è±¡æ± å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                                   | [github](https://github.com/liangxiegame/PoolKit)\|[gitee](https://gitee.com/liangxiegame/PoolKit)                                                                                                                         |
| LogKit                          | æ—¥å¿—å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                                    | [github](https://github.com/liangxiegame/LogKit)\|[gitee](https://gitee.com/liangxiegame/LogKit)                                                                                                                           |
| ActionKit                       | åŠ¨ä½œåºåˆ—å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                                  | [github](https://github.com/liangxiegame/ActionKit)\|[gitee](https://gitee.com/liangxiegame/ActionKit)                                                                                                                     |
| ResKit                          | èµ„æºç®¡ç†å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                                  | [github](https://github.com/liangxiegame/ResKit)\|[gitee](https://gitee.com/liangxiegame/ResKit)                                                                                                                           |
| UIKit                           | UIKit æ˜¯ä¸€å¥— UI/View å¼€å‘è§£å†³æ–¹æ¡ˆï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                | [github](https://github.com/liangxiegame/UIKit)\|[gitee](https://gitee.com/liangxiegame/UIKit)                                                                                                                             |
| AudioKit                        | ä¸€å¥—éŸ³é¢‘ç®¡ç†å·¥å…·ï¼Œç”± QF å®˜æ–¹ç»´æŠ¤                                                                                | [github](https://github.com/liangxiegame/AudioKit)\|[gitee](https://gitee.com/liangxiegame/AudioKit)                                                                                                                       |
| PackageKit                      | ä¸€å¥—åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ PackageKit å®‰è£…æ—§ç‰ˆæœ¬çš„ QFrameworkï¼Œä»¥åŠå¤§é‡çš„è§£å†³æ–¹æ¡ˆã€‚                                              | [github](https://github.com/liangxiegame/PackageKit)\|[gitee](https://gitee.com/liangxiegame/PackageKit)                                                                                                                   |
| **å…¶ä»–ç›¸å…³æ•™ç¨‹**                      |                                                                                                   |                                                                                                                                                                                                                            |
| ã€Šç‹¬ç«‹æ¸¸æˆä½“éªŒè®¡åˆ’ã€‹ï¼ˆçŒ«å”ï¼‰                  | ç‹¬ç«‹æ¸¸æˆåˆ¶ä½œä½“éªŒæ•™ç¨‹ï¼Œæœ‰ç”¨åˆ° QFramework.cs                                                                      | [b ç«™](https://space.bilibili.com/656352)                                                                                                                                                                                   |
| ã€ŠåŸåˆ›ç‹¬ç«‹æ¸¸æˆåˆ¶ä½œã€‹ï¼ˆå‡‰é‹ï¼‰                  | åŸåˆ›ç‹¬ç«‹æ¸¸æˆåˆ¶ä½œæ•™ç¨‹ï¼Œæœ‰ç”¨åˆ° QFramework.cs                                                                      | [b ç«™](https://space.bilibili.com/60450548/channel/collectiondetail?sid=125221)                                                                                                                                             |

**å…¸å‹çš„ QFramework.cs æ¶æ„ä»£ç **

```csharp
namespace QFramework.Exmaple
{
    public class CounterAppController : MonoBehaviour , IController
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // Model
        private ICounterAppModel mModel;

        void Start()
        {
            // è·å–æ¨¡å‹
            mModel = this.GetModel<ICounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });

            // è¡¨ç°é€»è¾‘
            mModel.Count.RegisterWithInitValue(newCount => // -+
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
          
            mModel = null;
        }
    }
}

```

**å…¸å‹çš„ QFramework.Toolkits ä»£ç **

```csharp
using QFramework;
using UnityEngine;
using UnityEngine.UI;

namespace liangxiegame
{
    public partial class UIGamePanel : UIPanel
    {
        private ResLoader mResLoader;
        
        protected override void OnInit(IUIData uiData = null)
        {
            mResLoader = ResLoader.Allocate();
            
            mResLoader.LoadSync<GameObject>("GameplayRoot")
                .Instantiate()
                .Identity()
                .GetComponent<GameplayRoot>()
                .InitGameplayRoot();
            
            
            BtnPause.onClick.AddListener(() =>
            {
                AudioKit.PlaySound("btn_click");
                
                ActionKit.Sequence()
                    .Callback(() => BtnPause.interactable = false)
                    .Callback(() => BtnPause.PlayBtnFadeAnimation())
                    .Delay(0.3f)
                    .Callback(() => UIKit.OpenPanel<UIPausePanel>())
                    .Start(this);
            });
        }

        protected override void OnClose()
        {
            mResLoader.Recycle2Cache();
            mResLoader = null;
        }
    }
}
```

## å¤§é‡çš„ç¤ºä¾‹

### å°æ¸¸æˆã€Šç‚¹ç‚¹ç‚¹ã€‹

![b5966b31-f004-4b5f-a38d-25753fb2eb8f.gif](https://file.liangxiegame.com/5a10aa95-4c93-4dae-acec-667a113c30ca.gif)

### å°æ¸¸æˆã€ŠFlappyBirdã€‹

![430b7f31-508d-4569-aa51-b75d5553b8c4.gif](https://file.liangxiegame.com/9845122b-93d9-4106-a027-2d7c129a096a.gif)

ä½œè€…ï¼šç‹äºŒ soso <https://github.com/so-sos-so>

### å°æ¸¸æˆã€ŠCube Masterã€‹

![b1334ef2-f6d4-4a9c-a5c4-b6cd6508595c.gif](https://file.liangxiegame.com/f51abab0-9dc9-478b-b1f1-67f2cd588477.gif) ä½œè€…ï¼šç‹äºŒ soso <https://github.com/so-sos-so>

### ç®€æ˜“å…³å¡ç¼–è¾‘å™¨2D

![c57c20cf-5ee6-4346-8be8-8ad1ea2d63b9.gif](https://file.liangxiegame.com/6492498b-6c22-478d-8785-9f43453c34db.gif)

![ea2cb545-4b5b-4d02-b494-dde4afa4e190.gif](https://file.liangxiegame.com/34b775c6-6a49-4141-9b9a-1377a6c15673.gif)

### å°æ¸¸æˆã€Šè´ªåƒè›‡ã€‹

![fb907355-c06c-4bde-8ca3-5638ba9b3ef7.gif](https://file.liangxiegame.com/ac70d14e-ea89-445d-899e-06f18f11f8d1.gif)

ä½œè€…ï¼šä¸€åªçš®çš®è™¾ <https://gitee.com/PantyNeko/>

ä»¥ä¸Šçš„ç¤ºä¾‹éƒ½æ˜¯ç”± QFramework.cs åˆ¶ä½œè€Œæˆçš„å®˜æ–¹ç¤ºä¾‹ã€‚

å¦å¤–è¿˜æœ‰ç¾¤å‹åˆ¶ä½œçš„å¼€æºæ¸¸æˆ

### CrazyCar

Unityåˆ¶ä½œçš„è”æœºèµ›è½¦æ¸¸æˆï¼Œåå°ä¸ºSpringBoot + Mybatisï¼›æ¸¸æˆé‡‡ç”¨QFrameworkæ¡†æ¶ï¼Œæ”¯æŒKCPå’ŒWebSocketç½‘ç»œ(å•†ç”¨çº§)

![Login.jpg](https://file.liangxiegame.com/0ab6cb1d-2374-4aa2-b27d-f04eb72792cd.png)

![Setting.png](https://file.liangxiegame.com/a113dcba-9ba8-4a40-b000-be3b61719ecc.png)

![Homepage.png](https://file.liangxiegame.com/9075c10d-6d21-411c-b1a4-7f92a08f9bfa.png)

![Avatar.png](https://file.liangxiegame.com/32b48b5b-cdcc-433e-b1b2-4b1333211a70.png) ![Profile.png](https://file.liangxiegame.com/bda476e4-0ede-4fd9-a5bb-e993bce8a786.png)

![Equip.png](https://file.liangxiegame.com/158b0ce0-6e67-47c5-81b5-cee6388dd99c.png)

![Rank.png](https://file.liangxiegame.com/2bd0ef1f-d639-48e8-8c48-320995d20de4.png)

![TimeTrial.png](https://file.liangxiegame.com/aa337718-b868-41d2-bc6b-2ef51c157481.png) ![Match.png](https://file.liangxiegame.com/06157781-3271-438c-bf3f-613e6ec00fb0.png)

ä½œè€…: TastSone  <https://github.com/TastSong>

é¡¹ç›®åœ°å€: <https://github.com/TastSong/CrazyCar>

## æ¡ˆä¾‹ã€Šäº”å­æ£‹ã€‹

![2f4dacbd-e59b-43af-b7be-44220fac664e.png](https://file.liangxiegame.com/a76bc24a-1828-46f2-94c5-8bd24884f932.png)

æºç åœ°å€:

*   github <https://github.com/liangxiegame/QFramework>
*   gitee <https://gitee.com/liangxiegame/QFramework>

![image.png](https://file.liangxiegame.com/3abceb70-2d17-4457-aff1-ef8a6ef4bd66.png)

## æ¡ˆä¾‹ã€Šæ‰«é›·ã€‹

ä½œè€…ï¼šJoker

![172348\_4d54744e\_5161625.webp](https://file.liangxiegame.com/c6116b7e-a08b-4c13-ae64-7053be3c503c.png)

æºç åœ°å€:

*   github <https://github.com/liangxiegame/QFramework>
*   gitee <https://gitee.com/liangxiegame/QFramework>

![image.png](https://file.liangxiegame.com/6482d4eb-5af9-4932-a2f8-2164cb22e931.png)

## æœ¬æ•™ç¨‹ç®€ä»‹

åœ¨ä¸Šä¸€ç‰ˆå®˜æ–¹æ•™ç¨‹ã€ŠQFramework ä½¿ç”¨æŒ‡å— 2020ã€‹å†™å®Œä¹‹åï¼Œç»è¿‡ä¸¤å¹´ï¼ˆ2022 å¹´ï¼‰ï¼ŒQFramework æ”¹è¿›äº†å¾ˆå¤šå·¥å…·çš„ä½¿ç”¨ä½“éªŒï¼ŒåŒæ—¶åˆæ–°å¢äº†ä¸€å¥—éå¸¸ç®€å•ä¸”å¼ºå¤§çš„å¼€å‘æ¶æ„ï¼Œè¿™æ ·å°±è¿æ¥äº† QFramework ç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ QFramework v1ï¼Œè¿™æ ·å°±å¯¼è‡´å¯¼è‡´ QFramework çš„æ¨èä½¿ç”¨çš„ API å‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼Œè™½ç„¶æ—§ç‰ˆæœ¬çš„ API è¿˜èƒ½ç”¨ï¼Œä½†æ˜¯æŒ‰ç…§ã€ŠQFramework ä½¿ç”¨æŒ‡å— 2020ã€‹å†™çš„å¾ˆå¤šä»£ç ä¼šæŠ¥å¾ˆå¤šè­¦å‘Šï¼Œè¿™ä¼šè®©å¾ˆå¤šåˆå­¦è€…æ„Ÿåˆ°ç–‘æƒ‘ï¼Œæ‰€ä»¥ç¬”è€…æ‰“ç®—åœ¨ã€ŠQFramework ä½¿ç”¨æŒ‡å— 2020ã€‹çš„åŸºç¡€ä¸Šï¼Œé‡åˆ¶ä¸€å¥—æ–°çš„ QFramework ä½¿ç”¨æ•™ç¨‹ï¼Œåå­—å«åšã€ŠQFramework v1.0 ä½¿ç”¨æŒ‡å—ã€‹ã€‚

æ•™ç¨‹åˆ†ä¸ºæ¶æ„ç¯‡å’Œå·¥å…·é›†ç¯‡ï¼Œæ¶æ„ç¯‡ç€é‡ä»‹ç» QFramework.cs è¿™å¥—æ¶æ„å…¥é—¨ä»¥åŠä½¿ç”¨è§„èŒƒï¼Œå·¥å…·ç¯‡ç€é‡ä»‹ç» QFramework ä¸­çš„å¤§é‡çš„å·¥å…·é›†çš„ä½¿ç”¨ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 02.Roadmap-è·¯çº¿å›¾

**å°†æ¥ä¹Ÿè®¸**
* sLuaã€toLuaã€xLuaã€ILRuntime æ”¯æŒ
* Pro ç‰ˆæœ¬æ¨è¿›
  * Architecture Designer ä½¿ç”¨å¯è§†åŒ–è®¾è®¡æ¶æ„ï¼Œä¸€é”®ç”Ÿæˆæ¶æ„ä»£ç 
* ResKit æ”¯æŒè‡ªå®šä¹‰ç›®å½•æ–¹æ¡ˆ
* UIKit æ”¯æŒå¤šä¸ª Canvas Root å’Œ æ‘„åƒæœºæ–¹æ¡ˆ
* CodeGenKit åŒæ­¥
* æ’ä»¶å¹³å°çš„æ’ä»¶æ•´ç†
* ResKit é‡æ„ï¼ˆæ”¯æŒçƒ­æ›´ï¼‰
* UIKit é‡æ„
* AudioKit é‡æ„

**v1.0.x**ï¼ˆå½“å‰ï¼‰
* QFramework.Toolkits æ”¶å½•å››ä¸ªç¤ºä¾‹
* ç¼–è¾‘å™¨ä½¿ç”¨ä½“éªŒæ”¹è¿›
* QFramework Pro v0.5 Architecture Designer å‘å¸ƒ

**v0.16.x**ï¼ˆå·²å®Œæˆï¼‰
*ã€ŠQFramework v1.0 ä½¿ç”¨æŒ‡å—ã€‹ å®Œæˆ
* ç¼–è¾‘å™¨æ–‡æ¡£ æ”¯æŒ gif åŠ¨ç”» å’Œ ç®€å•çš„ C# ä»£ç é«˜äº®
* ç¤ºä¾‹å®Œå–„

**v0.15.x**ï¼ˆå·²å®Œæˆï¼‰
* æ–‡æ¡£æ•´ç† & åœ¨ç¼–è¾‘å™¨å†…éƒ¨å†…ç½®

**v0.14.xï¼ˆå·²å®Œæˆï¼‰**
* Asset Store å…¼å®¹ & å‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–

**v0.11.xï¼ˆå·²å®Œæˆï¼‰**
* æ‰“ dll ä¼˜åŒ–æ—§è®¾å¤‡çš„ç¼–è¯‘é€Ÿåº¦

**v0.10.xï¼ˆå·²å®Œæˆï¼‰**
* ILRuntime æ”¯æŒï¼ˆåªå®Œæˆä¸€éƒ¨åˆ†ï¼Œåç»­å†æ”¯æŒï¼‰

**v0.9.xï¼ˆå·²å®Œæˆï¼‰**
* å•å…ƒæµ‹è¯•è¦†ç›–
* PackageKitã€Frameworkã€Extensions çš„ç¤ºä¾‹å…¨éƒ¨è¦†ç›–
* 3 ~ 5 ä¸ª Demo å‘å¸ƒ

**v0.2.x ~ v0.8.xï¼ˆå·²å®Œæˆï¼‰**
* PackageManager ç‹¬ç«‹æˆ PackageKit
* å‰¥ç¦»æ‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæœ€ä¸ºæ‰©å±•æ’ä»¶æ”¯æŒ
* æ’ä»¶å¹³å°å‘å¸ƒï¼šhttps://liangxiegame.com/qf/package
* å‘½åç©ºé—´ä» QF æ”¹å› QFramework
* å¤§é‡ Bug ä¿®å¤ã€å¤§é‡ç¤ºä¾‹ç¼–å†™
* äº”å­æ£‹ Demo å‘å¸ƒï¼šDemoï¼šäº”å­æ£‹
* QFramework ä½¿ç”¨æŒ‡å— 2020 å®Œç»“ï¼šQFramework ä½¿ç”¨æŒ‡å— 2020

**v0.1.xï¼ˆå·²å®Œæˆ)**
* UniRxã€Zenjectã€uFrameã€JsonDotnetã€CatLib é›†æˆå’Œå¢å¼º
* IOC å¢åŠ  IOC éƒ¨åˆ†
* æ¡†æ¶è‡ªåŠ¨æ›´æ–°æœºåˆ¶ => PackageManager
* å‘½åç©ºé—´ä» QFramework æ”¹æˆ QF

**v0.0.xï¼ˆå·²å®Œæˆ**
* æ¡†æ¶æ­å»º 2017 çš„å·¥å…·é›†æ”¶å½•
* æ¡†æ¶æ­å»º 2018 çš„ ResKit å’Œ UI Kit æ¨¡å—å®ç°
* ActionKit æ¨¡å—å®ç°
* Manager Of Managers æ”¯æŒ
* æ¡†æ¶è‡ªåŠ¨æ›´æ–°æœºåˆ¶

* Pro ç‰ˆæœ¬ï¼ˆå¼€æºæ”¶è´¹ç‰ˆæœ¬ï¼‰
  * CoreKitProï¼ˆæœªå¼€å§‹ï¼‰
  * LuaKit-è½»é‡çº§ Lua è„šæœ¬æ–¹æ¡ˆï¼Œç”± MoonSharp é­”æ”¹è€Œæ¥(æœªå¼€å§‹)
  * CodeGenKitPro ä»£ç ç”Ÿæˆåº“
  * ActionKitPro(æœªå¼€å§‹)
  * ResKitPro(æœªå¼€å§‹)
  * UIKitPro
  * LuaKitProï¼ˆåŸºäº xLua)(æœªå¼€å§‹)
  * ILRuntimeKitProï¼ˆåŸºäº ILRuntime çš„çƒ­æ›´æ¡†æ¶ï¼‰(æœªå¼€å§‹)
  * DocKit-å¯è§†åŒ–ç¼–ç¨‹å†™æ–‡æ¡£ï¼Œä¸€é”®ç”Ÿæˆç±»å›¾åŠŸèƒ½ï¼ˆè¿›è¡Œä¸­ï¼‰
  * DialogueKit-å¯¹è¯ç¼–è¾‘å™¨ï¼ˆæœªå¼€å§‹ï¼‰
  * InventoryKit-èƒŒåŒ…ç³»ç»Ÿï¼ˆæœªå¼€å§‹ï¼‰
  * ArchitectureKit-æ¶æ„è®¾è®¡å™¨ï¼ˆæœªå¼€å§‹ï¼‰
  * QuestKit-ä»»åŠ¡ç¼–è¾‘å™¨ï¼ˆæœªå¼€å§‹ï¼‰
  * å­˜æ¡£-æœªå¼€å§‹ï¼‰


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 2. æ¶æ„ç¯‡ï¼šQFramework.cs
# 01. QFramework æ¶æ„ç®€ä»‹

QFramework æ¶æ„æ˜¯ä¸€å¥—ç®€å•ã€å¼ºå¤§ã€æ˜“ä¸Šæ‰‹çš„ç³»ç»Ÿè®¾è®¡æ¶æ„ã€‚

è¿™å¥—æ¶æ„çš„ç‰¹æ€§å¦‚ä¸‹ï¼š
* åŸºäº MVC
* åˆ†å±‚
* (å¯é€‰)CQRS æ”¯æŒ
* (å¯é€‰)äº‹ä»¶é©±åŠ¨
* (å¯é€‰)æ•°æ®é©±åŠ¨
* (å¯é€‰)IOC æ¨¡å—åŒ–
* (å¯é€‰)é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ”¯æŒ
* ç¬¦åˆ SOLID åŸåˆ™
* æºç ä¸åˆ° 1000 è¡Œ

## æä¾›çš„æ¶æ„å›¾
![image.png](https://file.liangxiegame.com/5e9f1682-1907-47a2-a23a-2d5a4ba2e7a4.png)
## ä¸¾ä¸ªä¾‹å­ï¼ˆä¸€å›¾èƒœåƒè¨€ğŸ˜‚ï¼‰
![](https://file.liangxiegame.com/6bf42306-0b2a-4417-bbcf-354af0132596.png)

è¿™ä¸¤å¼ å›¾ç°åœ¨å¤§å®¶å¯èƒ½è¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬è¿‡ä¸€éå¿«é€Ÿå…¥é—¨å°±æ‡‚äº†ã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 02. QFramework çš„ MVC
QFramework åŸºäº MVC çš„å¼€å‘æ¨¡å¼

æ‰€ä»¥æˆ‘ä»¬å…ˆä»æœ€ç†ŸçŸ¥çš„ MVC æ¶æ„å¼€å§‹ç€æ‰‹ QFramework çš„å­¦ä¹ ã€‚

æˆ‘ä»¬å…ˆåšä¸€ä¸ªéå¸¸ç®€å•çš„è®¡æ•°å™¨åº”ç”¨ã€‚


é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ UGUI åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/902ef543-64b1-45ad-ae45-ea180ebec133.png)

åœºæ™¯ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/1db2c50c-cb8b-4b1c-92f6-432ff4083105.png)

å¤åˆ¶å®Œä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè„šæœ¬å«åš CounterAppControllerï¼Œä»£ç å¦‚ä¸‹ï¼š

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    // Controller
    public class CounterAppController : MonoBehaviour
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // Model
        private int mCount = 0;

        void Start()
        {
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                mCount++;
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                mCount--;
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mCount.ToString();
        }
    }
}
```

ä»£ç å¾ˆç®€å•ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€æ˜“çš„ MVC çš„å®ç°ã€‚

æˆ‘ä»¬å°†æ­¤è„šæœ¬æŒ‚åœ¨ Canvas èŠ‚ç‚¹ä¸Šï¼Œè¿è¡Œ Unity ç»“æœå¦‚ä¸‹ï¼š


![282fcc3c-96fa-46e1-b4c6-7f4528b04271.gif](https://file.liangxiegame.com/1b934e4f-8f72-44c2-800a-a97f1e707950.gif)

éå¸¸ç®€å•ã€‚

æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰å¯¼å…¥æˆ‘ä»¬çš„ QFrameworkï¼Œä¸ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä»£ç ä¸­æ‰€ä»‹ç»çš„æ¦‚å¿µã€‚

é¦–å…ˆæ˜¯ Modelã€Viewã€Controller

Model çš„ä»£ç å¦‚ä¸‹:
```csharp
// Model
private int mCount = 0;
```

éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå®ƒå…¶å®å¹¶ä¸ç®—æ˜¯ä¸€ä¸ª Modelï¼Œä»–åªæ˜¯è¦åœ¨ View ä¸­æ˜¾ç¤ºçš„ä¸€ä¸ªæ•°æ®è€Œå·²ï¼Œå…·ä½“ä¸ºä»€ä¹ˆä¸æ˜¯ Model æˆ‘ä»¬åœ¨åè¾¹å†è¯´ã€‚

View çš„ä»£ç å¦‚ä¸‹:
```csharp
// View
private Button mBtnAdd;
private Button mBtnSub;
private Text mCountText;
```

View çš„ä»£ç ä¹Ÿå¾ˆç®€å•ï¼ŒView åœ¨ QFramework çš„ MVC å®šä¹‰é‡Œå°±æ˜¯æä¾›å…³é”®ç»„ä»¶çš„å¼•ç”¨ï¼Œæ¯”å¦‚è¿™ä¸‰ä¸ªç»„ä»¶æ˜¯è¦åœ¨ Controller ä»£ç é‡Œè¦ç”¨åˆ°çš„ã€‚è€Œå…¶ä»–çš„ä¾‹å¦‚ Canvas Scaler ç­‰è¿™äº›ç»„ä»¶ç›®å‰ Controller ä¸éœ€è¦ï¼Œæ‰€ä»¥å°±ä¸ç”¨å£°æ˜ã€‚

Controller çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š

```csharp
void Start()
{
    ...
      
    // ç›‘å¬è¾“å…¥
    mBtnAdd.onClick.AddListener(() =>
    {
        // äº¤äº’é€»è¾‘
        mCount++;
        // è¡¨ç°é€»è¾‘
        UpdateView();        
    });
            
    mBtnSub.onClick.AddListener(() =>
    {
        // äº¤äº’é€»è¾‘
        mCount--;
        // è¡¨ç°é€»è¾‘
        UpdateView();
    });
            
    UpdateView();
}
        
void UpdateView()
{
    mCountText.text = mCount.ToString();
}
```

ä»¥ä¸Šå°±æ˜¯ Controller çš„ä»£ç ã€‚

å¥½äº†ï¼Œæˆ‘ä»¬å›å¤´å†çœ‹ä¸‹å®Œæ•´ä»£ç ã€‚


```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    // Controller
    public class CounterAppController : MonoBehaviour
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // Model
        private int mCount = 0;

        void Start()
        {
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                mCount++;
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                mCount--;
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mCount.ToString();
        }
    }
}
```

ç›®å‰åƒè®¡æ•°å™¨è¿™æ ·çš„é€»è¾‘ï¼Œä»¥ä¸Šçš„ä»£ç å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚

ä½†æ˜¯æˆ‘ä»¬è¦ç”¨å‘å±•çš„çœ¼å…‰çœ‹å¾…é—®é¢˜ã€‚

å‡å¦‚è¿™æ˜¯ä¸€ä¸ªåˆåˆ›é¡¹ç›®ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¾ˆæœ‰å¯èƒ½éœ€è¦æ·»åŠ å¤§é‡çš„ä¸šåŠ¡é€»è¾‘ã€‚

å…¶ä¸­å¾ˆæœ‰å¯èƒ½è®© mCount åœ¨å¤šä¸ª Controller ä¸­ä½¿ç”¨ï¼Œç”šè‡³éœ€è¦é’ˆå¯¹ mCount è¿™ä¸ªæ•°æ®å†™ä¸€äº›å…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚å¢åŠ  mCount åˆ™å¢åŠ  5 ä¸ªåˆ†æ•°ï¼Œæˆ–è€… mCount éœ€è¦å­˜å‚¨ç­‰ï¼Œæ€»ä¹‹ mCount åœ¨æœªæ¥å¯èƒ½ä¼šå‘å±•æˆä¸€ä¸ªéœ€è¦å…±äº«çš„æ•°æ®ï¼Œè€Œ mCount ç›®å‰åªå±äº CounterAppControllerï¼Œæ˜¾ç„¶åœ¨æœªæ¥è¿™æ˜¯ä¸å¤Ÿç”¨çš„ã€‚

æˆ‘ä»¬å°±éœ€è¦è®© mCount æˆå‘˜å˜é‡å˜æˆä¸€ä¸ªå…±äº«çš„æ•°æ®ï¼Œæœ€å¿«çš„åšæ³•æ˜¯å§ mCount å˜é‡å˜æˆé™æ€å˜é‡æˆ–è€…å•ä¾‹ï¼Œä½†æ˜¯è¿™æ ·è™½ç„¶å†™èµ·æ¥å¾ˆå¿«ï¼Œä½†æ˜¯åœ¨åæœŸç»´æŠ¤é¢åº¦æ—¶å€™ä¼šäº§ç”Ÿå¾ˆå¤šçš„é—®é¢˜ã€‚

è€Œ QFramework æ¶æ„æä¾›äº† Model çš„æ¦‚å¿µã€‚

æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹ã€‚

æˆ‘ä»¬å…ˆå¯¼å…¥ QFramework æ¶æ„ã€‚

å¯¼å…¥ QFramework çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å¤åˆ¶ QFramework.cs çš„ä»£ç åˆ° Unity å·¥ç¨‹ä¸­å³å¯ã€‚

QFramework.cs åœ°å€ï¼š
* Gitee: https://gitee.com/liangxiegame/QFramework/blob/master/QFramework.cs
* Github: https://github.com/liangxiegame/QFramework/blob/master/QFramework.cs

å¯¼å…¥ä¹‹åï¼Œæˆ‘ä»¬å°† CounterAppController çš„ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public int Count;
        
        protected override void OnInit()
        {
            Count = 0;
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // 6. äº¤äº’é€»è¾‘
                mModel.Count++;
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // 7. äº¤äº’é€»è¾‘
                mModel.Count--;
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.æŒ‡å®šæ¶æ„
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}
```

å¥½äº†ï¼Œä»£ç å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯ Architectureï¼Œå¦ä¸€ä¸ªæ˜¯ Modelã€‚

Architecture ç”¨äºç®¡ç†æ¨¡å—ï¼Œæˆ–è€…è¯´ Architecture æä¾›ä¸€æ•´å¥—æ¶æ„çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ¨¡å—ç®¡ç†å’Œæä¾› MVC åªæ˜¯å…¶åŠŸèƒ½çš„ä¸€å°éƒ¨åˆ†ã€‚

æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ Unity ç»“æœå¦‚ä¸‹ï¼š

![282fcc3c-96fa-46e1-b4c6-7f4528b04271.gif](https://file.liangxiegame.com/aa28ef15-11e9-49f2-9536-9db18b025a8f.gif)

è¿è¡Œæ­£ç¡®ã€‚

å¥½äº†ï¼Œæˆ‘ä»¬ä¸Šæ‰‹äº† QFramework æä¾›çš„ MVC æ¶æ„ã€‚

è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼ŒModel çš„å¼•å…¥æ˜¯ä¸ºäº†è§£å†³æ•°æ®å…±äº«çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯è¯´å•åªæ˜¯ä¸ºäº†è®©æ•°æ®å’Œè¡¨ç°åˆ†ç¦»ï¼Œè¿™ä¸€ç‚¹æ˜¯éå¸¸é‡è¦çš„ä¸€ç‚¹ã€‚

æ•°æ®å…±äº«åˆ†ä¸¤ç§ï¼šç©ºé—´ä¸Šçš„å…±äº«å’Œæ—¶é—´ä¸Šçš„å…±äº«ã€‚

ç©ºé—´çš„å…±äº«å¾ˆç®€å•ï¼Œå°±æ˜¯å¤šä¸ªç‚¹çš„ä»£ç éœ€è¦è®¿é—® Model é‡Œçš„æ•°æ®ã€‚

æ—¶é—´ä¸Šçš„å…±äº«å°±æ˜¯å­˜å‚¨åŠŸèƒ½ï¼Œå°†ä¸Šä¸€æ¬¡å…³é—­ App ä¹‹å‰çš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿™æ¬¡æ‰“å¼€æ—¶è·å¾—ä¸Šæ¬¡å…³é—­ App ä¹‹å‰çš„æ•°æ®ã€‚

è™½ç„¶æˆ‘ä»¬ä¸Šæ‰‹äº† MVCï¼Œä½†æ˜¯è¿™æ ·çš„ MVC è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡ç»§ç»­è§£å†³ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)




# 03. å¼•å…¥ Command

æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç›®å‰çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼›
```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public int Count;
        
        protected override void OnInit()
        {
            Count = 0;
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // 6. äº¤äº’é€»è¾‘
                mModel.Count++;
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // 7. äº¤äº’é€»è¾‘
                mModel.Count--;
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}
```

ç°åœ¨ï¼Œæ•°æ®å…±äº«çš„é—®é¢˜é€šè¿‡ å¼•å…¥ Model è§£å†³äº†ã€‚

è¿™é‡Œå†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œéœ€è¦å…±äº«çš„æ•°æ®æ”¾ Model é‡Œï¼Œä¸éœ€è¦å…±äº«çš„ï¼Œèƒ½ä¸æ”¾å°±ä¸æ”¾ã€‚

è™½ç„¶å¼•å…¥äº† Modelï¼Œä½†æ˜¯è¿™å¥—ä»£ç éšç€é¡¹ç›®è§„æ¨¡çš„å‘å±•è¿˜æ˜¯æœ‰å¾ˆå¤šçš„é—®é¢˜ã€‚

å…¶ä¸­æœ€ä¸¥é‡ä¹Ÿæœ€å¸¸è§çš„å°±æ˜¯ Controller ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ã€‚

æˆ‘ä»¬ç®€å•åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆ Controller ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ç›‘å¬ç”¨æˆ·è¾“å…¥éƒ¨åˆ†çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š

```csharp
// ç›‘å¬è¾“å…¥
mBtnAdd.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    mModel.Count++;
    // è¡¨ç°é€»è¾‘
    UpdateView();        
});
            
mBtnSub.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    mModel.Count--;
    // è¡¨ç°é€»è¾‘
    UpdateView();
});
```

åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥çš„ä»£ç ä¸­ï¼Œç¬”è€…å†™äº†æ³¨é‡Šï¼Œäº¤äº’é€»è¾‘ å’Œ è¡¨ç°é€»è¾‘ã€‚

ä»€ä¹ˆæ˜¯äº¤äº’é€»è¾‘ å’Œ è¡¨ç°é€»è¾‘ï¼Ÿ

éå¸¸ç®€å•ã€‚

äº¤äº’é€»è¾‘ï¼Œå°±æ˜¯ä»ç”¨æˆ·è¾“å…¥å¼€å§‹åˆ°æ•°æ®å˜æ›´çš„é€»è¾‘

é¡ºåºæ˜¯ View->Controller->Model

è¡¨ç°é€»è¾‘ï¼Œå°±æ˜¯æ•°æ®å˜æ›´åˆ°åœ¨ç•Œé¢æ˜¾ç¤ºçš„é€»è¾‘

é¡ºåºæ˜¯ Model->Controller->View

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/0b4e1255-ee5d-4223-97a6-2e49cf68715c.png)

è™½ç„¶äº¤äº’é€»è¾‘å’Œè¡¨ç°é€»è¾‘ç†è§£èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å®ƒä»¬éå¸¸é‡è¦ï¼Œå› ä¸º QFramework æ¥ä¸‹æ¥çš„æ¦‚å¿µéƒ½æ˜¯å›´ç»•è¿™ä¸¤ä¸ªæ¦‚å¿µå±•å¼€çš„ã€‚

Viewã€Model ä»¥åŠ Controller çš„äº¤äº’é€»è¾‘å’Œè¡¨ç°é€»è¾‘å½¢æˆäº†ä¸€ä¸ªé—­ç¯ã€‚æ„æˆäº†å®Œæ•´çš„ MVC é—­ç¯ã€‚


è€Œ Controller æœ¬èº«ä¹‹æ‰€ä»¥è‡ƒè‚¿ï¼Œæ˜¯å› ä¸ºï¼Œå®ƒè´Ÿè´£äº†ä¸¤ç§èŒè´£ï¼Œå³æ”¹å˜ Model æ•°æ® çš„äº¤äº’é€»è¾‘ï¼Œä»¥åŠ Model æ•°æ®å˜æ›´ä¹‹åæ›´æ–°åˆ°ç•Œé¢çš„è¡¨ç°é€»è¾‘ã€‚

è€Œåœ¨ä¸€ä¸ªæœ‰ä¸€å®šè§„æ¨¡çš„é¡¹ç›®ä¸­ï¼Œè¡¨ç°é€»è¾‘å’Œäº¤äº’é€»è¾‘éå¸¸å¤šã€‚è€Œä¸€ä¸ª Controller å¾ˆå®¹æ˜“å°±åšåˆ°ä¸Šåƒè¡Œä»£ç ã€‚

è€Œå¤§éƒ¨åˆ†çš„ MVC æ–¹æ¡ˆï¼Œè§£å†³ Controller è‡ƒè‚¿ç”¨çš„æ˜¯å¼•å…¥ Command çš„æ–¹å¼ï¼Œå³å¼•å…¥å‘½ä»¤æ¨¡å¼ï¼Œé€šè¿‡å‘½ä»¤æ¥åˆ†æ‹… Controller çš„äº¤äº’é€»è¾‘çš„èŒè´£ã€‚

QFramework ä¹Ÿæ˜¯ä½¿ç”¨äº†åŒæ ·çš„æ–¹å¼è§£å†³ Controller è‡ƒè‚¿çš„é—®é¢˜ã€‚


æˆ‘ä»¬å°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public int Count;
        
        protected override void OnInit()
        {
            Count = 0;
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
        }
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand // ++
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count++;
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand // ++
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<DecreaseCountCommand>();
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}
```

ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç”¨æµç¨‹å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/6544f785-0389-46bc-813d-b9c77abdd336.png)

è¿è¡Œ Unityï¼Œç»“æœå¦‚ä¸‹ï¼š

![282fcc3c-96fa-46e1-b4c6-7f4528b04271.gif](https://file.liangxiegame.com/1b934e4f-8f72-44c2-800a-a97f1e707950.gif)


æ²¡æœ‰å˜åŒ–ï¼Œè¿è¡Œæ­£ç¡®ã€‚

å¤§å®¶å¯èƒ½ä¼šé—®ï¼Œä¸€ä¸ªç®€å•çš„æ•°æ®åŠ å‡æ“ä½œï¼Œè‡³äºåˆ›å»ºä¸€ä¸ª Command å¯¹è±¡æ¥æ‰¿æ‹…ä¹ˆï¼Ÿçœ‹ä¸å‡ºæ¥å¥½å¤„å‘€ï¼Œåè€Œä»£ç æ›´å¤šäº†ã€‚

å¦‚æœæ•´ä¸ªé¡¹ç›®åªæœ‰ä¸€ä¸ªç®€å•çš„æ•°æ®åŠ å‡æ“ä½œï¼Œé‚£ä½¿ç”¨ Command æœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾ï¼Œä½†æ˜¯ä¸€èˆ¬çš„é¡¹ç›®çš„äº¤äº’é€»è¾‘ï¼Œæ˜¯éå¸¸å¤æ‚çš„ï¼Œä»£ç é‡ä¹Ÿéå¸¸å¤šï¼Œæ•´ä¸ªæ—¶å€™ä½¿ç”¨ Command è¯æ±‡å‘æŒ¥ä½œç”¨ã€‚

å…·ä½“å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Œä½¿ç”¨ Command å¯ä»¥å¸¦æ¥å¾ˆå¤šä¾¿åˆ©ï¼Œæ¯”å¦‚ï¼š
* Command å¯ä»¥å¤ç”¨ï¼ŒCommand ä¹Ÿå¯ä»¥è°ƒç”¨ Command
* Command å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿å®ç°æ’¤é”€åŠŸèƒ½ï¼Œå¦‚æœ App æˆ–è€… æ¸¸æˆéœ€è¦çš„è¯
* å¦‚æœéµå¾ªä¸€å®šè§„èŒƒï¼Œå¯ä»¥å®ç°ä½¿ç”¨ Command è·‘è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
* Command å¯ä»¥å®šåˆ¶ Command é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥è®© Command æŒ‰ç…§ç‰¹å®šçš„æ–¹å¼æ‰§è¡Œ
* ä¸€ä¸ª Command ä¹Ÿå¯ä»¥å°è£…æˆä¸€ä¸ª Http æˆ–è€… TCP é‡Œçš„ä¸€æ¬¡æ•°æ®è¯·æ±‚
* Command å¯ä»¥å®ç° Command ä¸­é—´ä»¶æ¨¡å¼
* ç­‰ç­‰

OKï¼Œé€šè¿‡å¼•å…¥ Commandï¼Œå¸®åŠ©åˆ†æ‹…äº† Controller çš„äº¤äº’é€»è¾‘ã€‚ä½¿å¾— Controller æˆä¸ºä¸€ä¸ªè–„è–„çš„ä¸€å±‚ï¼Œåœ¨éœ€è¦ä¿®æ”¹ Model çš„æ—¶å€™ï¼ŒController åªè¦è°ƒç”¨ä¸€å¥ç®€å•çš„ Command å³å¯ã€‚

Command æœ€æ˜æ˜¾çš„å¥½å¤„å°±æ˜¯ï¼š
* å°±ç®—ä»£ç å†ä¹±ï¼Œä¹Ÿåªæ˜¯åœ¨ä¸€ä¸ª Command å¯¹è±¡é‡Œä¹±ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çš„å¯¹è±¡ã€‚
* è®²æ–¹æ³•å°è£…æˆå‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥å®ç°å¯¹å‘½ä»¤å¯¹è±¡çš„ç»„ç»‡ã€æ’åºã€å»¶æ—¶ç­‰æ“ä½œã€‚

æ›´å¤šå¥½å¤„ä¼šéšç€å¤§å®¶çš„å®è·µæ…¢æ…¢ä½“ä¼šåˆ°ã€‚

å½“å‰çš„ MVC æµç¨‹å¦‚ä¸‹ï¼š

![](https://file.liangxiegame.com/5ddfe754-110f-4417-8e29-d890e36d4a7a.png)

è¿™ç¯‡å†…å®¹å°±è¿™äº›ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)


# 04. å¼•å…¥ Event

æˆ‘ä»¬çœ‹ä¸‹å½“å‰çš„ä»£ç :

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public int Count;
        
        protected override void OnInit()
        {
            Count = 0;
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
        }
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count++;
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
                // è¡¨ç°é€»è¾‘
                UpdateView();        
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<DecreaseCountCommand>();
                // è¡¨ç°é€»è¾‘
                UpdateView();
            });
            
            UpdateView();
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```


æˆ‘ä»¬é€šè¿‡å¼•å…¥äº† Command æ¥å¸®åŠ© Controller åˆ†æ‹…äº†ä¸€éƒ¨åˆ†çš„äº¤äº’é€»è¾‘ã€‚

ä½†æ˜¯è¡¨ç°é€»è¾‘çš„ä»£ç ç›®å‰çœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆæ™ºèƒ½ã€‚

è¡¨ç°é€»è¾‘çš„ä»£ç å¦‚ä¸‹ï¼š

```csharp
// ç›‘å¬è¾“å…¥
mBtnAdd.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand<IncreaseCountCommand>();
    // è¡¨ç°é€»è¾‘
    UpdateView();        
});
            
mBtnSub.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand<DecreaseCountCommand>();
    // è¡¨ç°é€»è¾‘
    UpdateView();
});
```

æ¯æ¬¡è°ƒç”¨é€»è¾‘ä¹‹åï¼Œè¡¨ç°é€»è¾‘éƒ¨åˆ†éƒ½éœ€è¦æ‰‹åŠ¨è°ƒç”¨ä¸€æ¬¡ï¼ˆUpdateView æ–¹æ³•ï¼‰ã€‚

åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œè¡¨ç°é€»è¾‘çš„è°ƒç”¨æ¬¡æ•°ï¼Œè‡³å°‘ä¼šå’Œäº¤äº’é€»è¾‘çš„è°ƒç”¨æ¬¡æ•°ä¸€æ ·å¤šã€‚å› ä¸ºåªè¦ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¹åº”åœ°å°±è¦æŠŠæ•°æ®çš„biangåœ¨ç•Œé¢ä¸Šè¡¨ç°å‡ºæ¥ã€‚

è€Œè¿™éƒ¨åˆ†å—²ç”¨è¡¨ç°é€»è¾‘çš„ä»£ç ä¹Ÿä¼šå¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªäº‹ä»¶æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è¿™ä¸ªäº‹ä»¶æœºåˆ¶çš„ä½¿ç”¨å…¶å®æ˜¯å’Œ Command ä¸€èµ·ä½¿ç”¨çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„å°æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://file.liangxiegame.com/60ccd370-7c2c-4792-8435-ff5427dc5a1b.png)

å³é€šè¿‡ Command ä¿®æ”¹æ•°æ®ï¼Œå½“æ•°æ®å‘ç”Ÿä¿®æ”¹åå‘é€å¯¹åº”çš„æ•°æ®å˜æ›´äº‹ä»¶ã€‚

è¿™ä¸ªæ˜¯ç®€åŒ–ç‰ˆæœ¬çš„ CQRS åŸåˆ™ï¼Œå³ Command Query Responsibility Separiationï¼Œè¯»å†™åˆ†ç¦»åŸåˆ™ã€‚

å¼•å…¥è¿™é¡¹åŸåˆ™ä¼šå¾ˆå®¹æ˜“å®ç° äº‹ä»¶é©±åŠ¨ã€æ•°æ®é©±åŠ¨ æ¶æ„ã€‚

åœ¨ QFramework ä¸­ï¼Œç”¨æ³•éå¸¸ç®€å•ï¼Œä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public int Count;
        
        protected override void OnInit()
        {
            Count = 0;
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
        }
    }
    
    // å®šä¹‰æ•°æ®å˜æ›´äº‹ä»¶
    public struct CountChangeEvent // ++
    {
        
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count++;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });
            
            UpdateView();
            
            // è¡¨ç°é€»è¾‘
            this.RegisterEvent<CountChangeEvent>(e =>
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}
```


ä»£ç å¾ˆç®€å•ã€‚

æµç¨‹å›¾å¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/43474a6f-6a18-4d97-bdb9-9319a77481b9.png)

è¿è¡Œç»“æœå¦‚ä¸‹:

![282fcc3c-96fa-46e1-b4c6-7f4528b04271.gif](https://file.liangxiegame.com/1b934e4f-8f72-44c2-800a-a97f1e707950.gif)

å¼•å…¥äº‹ä»¶æœºåˆ¶ å’Œ CQRS åŸåˆ™ä¹‹åï¼Œæˆ‘ä»¬çš„è¡¨ç°é€»è¾‘çš„ä»£ç å˜å°‘äº†å¾ˆå¤šã€‚

ç”±åŸæ¥çš„ä¸¤æ¬¡ä¸»åŠ¨è°ƒç”¨

``` csharp
// ç›‘å¬è¾“å…¥
mBtnAdd.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand<IncreaseCountCommand>(); // æ²¡æœ‰å‚æ•°æ„é€ çš„å‘½ä»¤æ”¯æŒæ³›å‹
    // è¡¨ç°é€»è¾‘
    UpdateView();
});
            
mBtnSub.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand(new DecreaseCountCommand()); // ä¹Ÿæ”¯æŒç›´æ¥ä¼ å…¥å¯¹è±¡ï¼ˆæ–¹ä¾¿é€šè¿‡æ„é€ ä¼ å‚)
    // è¡¨ç°é€»è¾‘
    UpdateView();
});
```

å˜æˆäº†ä¸€å¤„ç›‘å¬äº‹ä»¶ï¼Œæ¥æ”¶äº‹ä»¶è¿›è¡Œè°ƒç”¨ã€‚

``` csharp
// ç›‘å¬è¾“å…¥
mBtnAdd.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand<IncreaseCountCommand>(); // æ²¡æœ‰å‚æ•°æ„é€ çš„å‘½ä»¤æ”¯æŒæ³›å‹
});
            
mBtnSub.onClick.AddListener(() =>
{
    // äº¤äº’é€»è¾‘
    this.SendCommand(new DecreaseCountCommand()); // ä¹Ÿæ”¯æŒç›´æ¥ä¼ å…¥å¯¹è±¡ï¼ˆæ–¹ä¾¿é€šè¿‡æ„é€ ä¼ å‚)
});
            
UpdateView();
            
// è¡¨ç°é€»è¾‘
this.RegisterEvent<CountChangeEvent>(e =>
{
    UpdateView();
}).UnRegisterWhenGameObjectDestroyed(gameObject);
```

è¿™æ ·å‡ç¼“äº†å¾ˆå¤šäº¤äº’é€»è¾‘ã€‚

OKï¼Œåˆ°æ­¤ï¼Œæˆ‘ä»¬ç®—æ˜¯ç”¨ä¸Šäº†è¿˜ç®—åˆæ ¼çš„ MVC çš„å®ç°ï¼Œè€Œ QFramework æ‰€æä¾›çš„æ¦‚å¿µä¸­ï¼Œæœ€é‡è¦çš„æ¦‚å¿µå·²ç»æ¥è§¦åˆ°äº†ï¼Œå³ CQRSï¼Œé€šè¿‡ Command å»ä¿®æ”¹æ•°æ®ï¼Œæ•°æ®å‘ç”Ÿä¿®æ”¹åå‘é€æ•°æ®å˜æ›´äº‹ä»¶ã€‚

å½“å‰çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![](https://file.liangxiegame.com/d25c65e0-25ba-43ca-9060-69bd51efaf46.png)


å­¦åˆ°è¿™é‡Œï¼Œå¯¹äº QFramework æ¶æ„çš„ä½¿ç”¨ç®—æ˜¯çœŸæ­£çš„å…¥é—¨äº†ã€‚

ä¸è¿‡æ¥ä¸‹æ¥è¿˜æœ‰ä¸€äº›æ¦‚å¿µï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡ç»§ç»­ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 05. å¼•å…¥ Utility

åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥æ”¯æŒ CounterApp çš„å­˜å‚¨åŠŸèƒ½ã€‚

å…¶ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€éƒ¨åˆ† Model çš„ä»£ç å³å¯ï¼Œå¦‚ä¸‹ï¼š

```csharp
    // å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        private int mCount;

        public int Count
        {
            get => mCount;
            set
            {
                if (mCount != value)
                {
                    mCount = value;
                    PlayerPrefs.SetInt(nameof(Count),mCount);
                }
            }
        }

        protected override void OnInit()
        {
            Count = PlayerPrefs.GetInt(nameof(Count), mCount);
        }
    }
```

è¿™æ ·å°±æ”¯æŒäº†éå¸¸åŸºæœ¬çš„æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚

å½“ç„¶è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œå¦‚æœæ—¶å€™æœªæ¥æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„æ•°æ®éå¸¸å¤šçš„æ—¶å€™ï¼ŒModel å±‚å°±ä¼šå……æ–¥å¤§é‡å­˜å‚¨ã€åŠ è½½ç›¸å…³çš„ä»£ç ã€‚

è¿˜æœ‰å°±æ˜¯ï¼Œæˆ‘ä»¬ä»¥åå¦‚æœä¸æƒ³ä½¿ç”¨ PlayperPrefs äº†ï¼Œæƒ³ä½¿ç”¨ EasySave æˆ–è€… SQLite çš„æ—¶å€™ï¼Œå°±ä¼šé€ æˆå¤§é‡çš„ä¿®æ”¹å·¥ä½œé‡ã€‚

äºæ˜¯ QFramework æä¾›äº†ä¸€ä¸ª Utility å±‚ï¼Œä¸“é—¨ç”¨æ¥è§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜çš„ï¼Œä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        private int mCount;

        public int Count
        {
            get => mCount;
            set
            {
                if (mCount != value)
                {
                    mCount = value;
                    PlayerPrefs.SetInt(nameof(Count),mCount);
                }
            }
        }

        protected override void OnInit()
        {
            var storage = this.GetUtility<Storage>();

            Count = storage.LoadInt(nameof(Count));

            // å¯ä»¥é€šè¿‡ CounterApp.Interface ç›‘å¬æ•°æ®å˜æ›´äº‹ä»¶
            CounterApp.Interface.RegisterEvent<CountChangeEvent>(e =>
            {
                this.GetUtility<Storage>().SaveInt(nameof(Count), Count);
            });
        }
    }

    // å®šä¹‰ utility å±‚
    public class Storage : IUtility
    {
        public void SaveInt(string key, int value)
        {
            PlayerPrefs.SetInt(key,value);
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            return PlayerPrefs.GetInt(key, defaultValue);
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
            this.RegisterUtility(new Storage());
        }
    }
    
    // å®šä¹‰æ•°æ®å˜æ›´äº‹ä»¶
    public struct CountChangeEvent // ++
    {
        
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count++;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });
            
            UpdateView();
            
            // è¡¨ç°é€»è¾‘
            this.RegisterEvent<CountChangeEvent>(e =>
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```

ä»£ç éå¸¸ç®€å•ï¼Œæˆ‘ä»¬è¿è¡Œä¸‹ Unity çœ‹ä¸‹ç»“æœï¼š

![f55b6c09-f5a0-402f-bffa-5ceb0bc3d8fb.gif](https://file.liangxiegame.com/1c622976-b32a-4b62-92a3-d34b2c628e27.gif)

è¿è¡Œæ­£ç¡®ã€‚

è¿™æ ·å½“æˆ‘ä»¬ï¼Œæƒ³è¦å°† PlayerPrefs æ–¹æ¡ˆæ›¿æ¢æˆ EasySave çš„æ—¶å€™ï¼Œåªéœ€è¦å¯¹ Storage é‡Œçš„ä»£ç è¿›è¡Œä¿®æ”¹å³å¯ã€‚

æœ€åç»™å‡ºæµç¨‹å›¾ï¼Œå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/f2329b2f-700a-4693-b22e-b1afc50c7364.png)

å¥½äº†ï¼Œè¿™ç¯‡å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 06. å¼•å…¥ System
åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥å¼•å…¥æœ€åä¸€ä¸ªåŸºæœ¬æ¦‚å¿µ Systemã€‚

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ä»£ç ï¼Œå¦‚ä¸‹:

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        private int mCount;

        public int Count
        {
            get => mCount;
            set
            {
                if (mCount != value)
                {
                    mCount = value;
                    PlayerPrefs.SetInt(nameof(Count),mCount);
                }
            }
        }

        protected override void OnInit()
        {
            var storage = this.GetUtility<Storage>();

            Count = storage.LoadInt(nameof(Count));

            // å¯ä»¥é€šè¿‡ CounterApp.Interface ç›‘å¬æ•°æ®å˜æ›´äº‹ä»¶
            CounterApp.Interface.RegisterEvent<CountChangeEvent>(e =>
            {
                this.GetUtility<Storage>().SaveInt(nameof(Count), Count);
            });
        }
    }

    // å®šä¹‰ utility å±‚
    public class Storage : IUtility
    {
        public void SaveInt(string key, int value)
        {
            PlayerPrefs.SetInt(key,value);
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            return PlayerPrefs.GetInt(key, defaultValue);
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
            this.RegisterUtility(new Storage());
        }
    }
    
    // å®šä¹‰æ•°æ®å˜æ›´äº‹ä»¶
    public struct CountChangeEvent // ++
    {
        
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count++;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });
            
            UpdateView();
            
            // è¡¨ç°é€»è¾‘
            this.RegisterEvent<CountChangeEvent>(e =>
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```

è¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªåŠŸèƒ½ï¼Œå³ç­–åˆ’æå‡ºäº†ä¸€ä¸ªæˆå°±è¾¾æˆçš„åŠŸèƒ½ï¼Œå³ Count åˆ° 10 çš„æ—¶å€™ï¼Œè§¦å‘ä¸€ä¸ªç‚¹å‡»è¾¾äººæˆå°±ï¼Œç‚¹å‡»äºŒåæ¬¡ åˆ™è§¦å‘ä¸€ä¸ª ç‚¹å‡»ä¸“å®¶æˆå°±ã€‚

é€»è¾‘å¬èµ·æ¥å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ IncreaseCountCommand é‡Œç¼–å†™å³å¯ï¼Œå¦‚ä¸‹ï¼š

```csharp
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            var model = this.GetModel<CounterAppModel>();
                
            model.Count++;
            this.SendEvent<CountChangeEvent>(); // ++

            if (model.Count == 10)
            {
                Debug.Log("è§¦å‘ ç‚¹å‡»è¾¾äºº æˆå°±");
            }
            else if (model.Count == 20)
            {
                Debug.Log("è§¦å‘ ç‚¹å‡»ä¸“å®¶ æˆå°±");
            }
        }
    }
```

ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚

è¿è¡Œä¹‹åï¼Œç¬”è€…ç‚¹å‡»äº† 20 æ¬¡ + å·ï¼Œç»“æœå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/826d5513-059e-41ba-8f5a-4fbea78dbde7.png)

è¿™ä¸ªåŠŸèƒ½å¾ˆå¿«å°±å®Œæˆäº†ã€‚

ä½†æ˜¯è¿™ä¸ªæ—¶å€™ç­–åˆ’è¯´ï¼Œå¸Œæœ›å†å¢åŠ ä¸€ä¸ªå½“ç‚¹å‡» - å·åˆ° -10 æ—¶ï¼Œè§¦å‘ä¸€ä¸ª ç‚¹å‡»èœé¸Ÿæˆå°±ï¼Œç„¶åç­–åˆ’è¿˜è¯´ï¼Œç‚¹å‡»è¾¾äºº å’Œ ç‚¹å‡»ä¸“å®¶ æˆå°±å¤ªå®¹æ˜“è¾¾æˆäº†ï¼Œéœ€è¦åˆ†åˆ«æ”¹æˆ 1000 æ¬¡ å’Œ 2000 æ¬¡ã€‚

è€Œè¿™æ¬¡ç­–åˆ’æå‡ºçš„éœ€æ±‚ï¼Œéœ€è¦æˆ‘ä»¬ä¿®æ”¹ä¸¤å¤„çš„ä»£ç ï¼Œå³ IncreaseCountCommand é‡Œéœ€è¦ä¿®æ”¹æ•°å€¼ä¸º 1000 å’Œ 2000ï¼Œç„¶åå† DecreaseCountCommand å¢åŠ ä¸€ä¸ªåˆ¤æ–­é€»è¾‘ã€‚

ä¸€æ¬¡æå‡ºçš„éœ€æ±‚ï¼Œç»“æœé€ æˆäº†å¤šå¤„ä¿®æ”¹ï¼Œè¿™è¯´æ˜ä»£ç æœ‰é—®é¢˜ã€‚

é¦–å…ˆåƒè¿™ç§è§„åˆ™ç±»çš„é€»è¾‘ï¼Œæ¯”å¦‚åˆ†æ•°ç»Ÿè®¡æˆ–è€…æˆå°±ç»Ÿè®¡ç­‰ä»£ç ï¼Œä¸é€‚åˆåˆ†æ•£å†™åœ¨ Command é‡Œï¼Œè€Œé€‚åˆç»Ÿä¸€å†™åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œè€Œè¿™ç§å¯¹è±¡ï¼Œåœ¨ QFramework é‡Œæœ‰æä¾›ï¼Œå°±æ˜¯ System å¯¹è±¡ã€‚

ä½¿ç”¨ä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        private int mCount;

        public int Count
        {
            get => mCount;
            set
            {
                if (mCount != value)
                {
                    mCount = value;
                    PlayerPrefs.SetInt(nameof(Count),mCount);
                }
            }
        }

        protected override void OnInit()
        {
            var storage = this.GetUtility<Storage>();

            Count = storage.LoadInt(nameof(Count));

            // å¯ä»¥é€šè¿‡ CounterApp.Interface ç›‘å¬æ•°æ®å˜æ›´äº‹ä»¶
            CounterApp.Interface.RegisterEvent<CountChangeEvent>(e =>
            {
                this.GetUtility<Storage>().SaveInt(nameof(Count), Count);
            });
        }
    }


    public class AchievementSystem : AbstractSystem // +
    {
        protected override void OnInit()
        {
            var model = this.GetModel<CounterAppModel>();

            this.RegisterEvent<CountChangeEvent>(e =>
            {
                if (model.Count == 10)
                {
                    Debug.Log("è§¦å‘ ç‚¹å‡»è¾¾äºº æˆå°±");
                }
                else if (model.Count == 20)
                {
                    Debug.Log("è§¦å‘ ç‚¹å‡»ä¸“å®¶ æˆå°±");
                } else if (model.Count == -10)
                {
                    Debug.Log("è§¦å‘ ç‚¹å‡»èœé¸Ÿ æˆå°±");
                }
            });
        }
    }

    // å®šä¹‰ utility å±‚
    public class Storage : IUtility
    {
        public void SaveInt(string key, int value)
        {
            PlayerPrefs.SetInt(key,value);
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            return PlayerPrefs.GetInt(key, defaultValue);
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ System 
            this.RegisterSystem(new AchievementSystem()); // +
             
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
            this.RegisterUtility(new Storage());
        }
    }
    
    // å®šä¹‰æ•°æ®å˜æ›´äº‹ä»¶
    public struct CountChangeEvent // ++
    {
        
    }
    
    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            var model = this.GetModel<CounterAppModel>();
                
            model.Count++;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count--;
            this.SendEvent<CountChangeEvent>(); // ++
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });
            
            UpdateView();
            
            // è¡¨ç°é€»è¾‘
            this.RegisterEvent<CountChangeEvent>(e =>
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```

ä»£ç è¶Šæ¥è¶Šå¤šï¼Œä½†æ˜¯ä¸éš¾ã€‚

è¿è¡Œæ¸¸æˆï¼Œç¬”è€…ç‚¹å‡»çš„ç»“æœå¦‚ä¸‹ï¼š

![](https://file.liangxiegame.com/a1adc1e8-6bb9-49c1-ae74-e0e55673e865.png)

ç»“æœæ²¡é—®é¢˜ã€‚

å¥½äº†ï¼Œç¬”è€…å†™çš„æˆå°±ç³»ç»Ÿéå¸¸ç®€é™‹ï¼Œå®é™…ä¸Šé¢åº¦æˆå°±ç³»ç»Ÿå¯ä»¥å†™å¾—éå¸¸å®Œå–„ï¼Œæ¯”å¦‚å¯ä»¥å†æˆå°±ç³»ç»Ÿé‡Œè¿›è¡Œå­˜å‚¨åŠ è½½ç­‰æ“ä½œï¼Œè€Œæ­¤æ–‡çš„æˆå°±ç³»ç»Ÿä»…ä»…æ˜¯å±•ç¤ºç›®çš„ã€‚

åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±æ¥è§¦åˆ°äº† QFramework æ¶æ„æ‰€æä¾›çš„æ ¸å¿ƒæ¦‚å¿µã€‚

æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¬¬ä¸€ç¯‡çš„ä¸¤å¼ å›¾ï¼Œå¦‚ä¸‹:

![](https://file.liangxiegame.com/39bdcf54-0240-46e0-8f68-9eb708505695.png)



![](https://file.liangxiegame.com/6bf42306-0b2a-4417-bbcf-354af0132596.png)

åˆ°æ­¤ï¼Œå¤§å®¶åº”è¯¥èƒ½çœ‹æ‡‚è¿™ä¸¤å¼ å›¾äº†ã€‚

QFramework æ€»å…±åˆ†å››ä¸ªå±‚çº§ï¼Œå³
* è¡¨ç°å±‚ï¼šIController
* ç³»ç»Ÿå±‚ï¼šISystem
* æ•°æ®å±‚ï¼šIModel
* å·¥å…·å±‚ï¼šIUtility

é™¤äº†å››ä¸ªå±‚çº§ï¼Œè¿˜æ¥è§¦äº†ä¸º Controller çš„äº¤äº’é€»è¾‘å‡è´Ÿçš„ Command å’Œ ä¸ºè¡¨ç°é€»è¾‘å‡è´Ÿçš„ Eventã€‚

è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ CQRS åŸåˆ™çš„ç®€æ˜“ç‰ˆæœ¬ï¼ŒCommand->Model->State Changed Eventã€‚

åˆ°ç›®å‰ä¸ºæ­¢ QFramework çš„åŸºæœ¬ç”¨æ³•æˆ‘ä»¬è¿‡äº†ä¸€éäº†ã€‚

ä»ä¸‹ä¸€ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç» QFramework æ¶æ„æä¾›çš„å‰©ä½™åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æ˜¯å¯é€‰çš„ã€‚

è¿™ç¯‡å°±åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)





# 07. ä½¿ç”¨ BindableProperty ä¼˜åŒ–äº‹ä»¶

åœ¨è¿™ç¯‡æˆ‘ä»¬ä»‹ç»ä¸€ä¸ªæ–°çš„æ¦‚å¿µ BindablePropertyã€‚

BindableProperty æ˜¯åŒ…å« æ•°æ® + æ•°æ®å˜æ›´äº‹ä»¶ çš„ä¸€ä¸ªå¯¹è±¡ã€‚

## BindableProperty åŸºæœ¬ä½¿ç”¨
ç®€å•çš„ç”¨æ³•å¦‚ä¸‹:

```csharp
var age = new BindableProperty<int>(10);

age.Register(newAge=>{
  
  Debug.Log(newAge)
}).UnRegisterWhenGameObjectDestoryed(gameObject);


age++;
age--;


// è¾“å‡ºç»“æœ
// 11
// 10
```

éå¸¸ç®€å•ï¼Œå°±æ˜¯å½“è°ƒç”¨ age++ å’Œ age-- çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ•°æ®å˜æ›´äº‹ä»¶ã€‚

BindableProperty é™¤äº†æä¾› Register è¿™ä¸ª API ä¹‹å¤–ï¼Œè¿˜æä¾›äº† RegisterWithInitValue API,æ„æ€æ˜¯ æ³¨å†Œæ—¶ å…ˆæŠŠå½“å‰å€¼è¿”å›è¿‡æ¥ã€‚

å…·ä½“ç”¨æ³•å¦‚ä¸‹:

```csharp
var age = new BindableProperty<int>(5);

age.RegisterWithInitValue(newAge => {
  
  Debug.Log(newAge);
  
});

// è¾“å‡ºç»“æœ
// 5
```

è¿™ä¸ª API å°±æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–çš„æƒ…å†µä¸‹ï¼Œage å…ˆè¿”å›ä¸€ä¸ªå½“å‰çš„å€¼ï¼Œæ¯”è¾ƒæ–¹ä¾¿ç”¨äºæ˜¾ç¤ºåˆå§‹ç•Œé¢ã€‚

BindableProperty æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ï¼Œå¯ä»¥è„±ç¦» QFramework æ¶æ„ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç”¨éè¦ç”¨ QFramework çš„ MVC æ‰èƒ½ç”¨ BindablePropertyï¼Œè€Œæ˜¯å¯ä»¥å†è‡ªå·±é¡¹ç›®ä¸­éšæ„ä½¿ç”¨ã€‚

## ä½¿ç”¨ BindableProperty ä¼˜åŒ–  CounterApp çš„ä»£ç 

æˆ‘ä»¬ç›´æ¥ä¼˜åŒ–å³å¯ï¼Œä¼˜åŒ–åä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public class CounterAppModel : AbstractModel
    {
        public BindableProperty<int> Count { get; } = new BindableProperty<int>();

        protected override void OnInit()
        {
            var storage = this.GetUtility<Storage>();
            
            // è®¾ç½®åˆå§‹å€¼ï¼ˆä¸è§¦å‘äº‹ä»¶ï¼‰
            Count.SetValueWithoutEvent(storage.LoadInt(nameof(Count)));

            // å½“æ•°æ®å˜æ›´æ—¶ å­˜å‚¨æ•°æ®
            Count.Register(newCount =>
            {
                storage.SaveInt(nameof(Count),newCount);
            });
        }
    }


    public class AchievementSystem : AbstractSystem 
    {
        protected override void OnInit()
        {
            this.GetModel<CounterAppModel>() // -+
                .Count
                .Register(newCount =>
                {
                    if (newCount == 10)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»è¾¾äºº æˆå°±");
                    }
                    else if (newCount == 20)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»ä¸“å®¶ æˆå°±");
                    }
                    else if (newCount == -10)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»èœé¸Ÿ æˆå°±");
                    }
                });
        }
    }

    // å®šä¹‰ utility å±‚
    public class Storage : IUtility
    {
        public void SaveInt(string key, int value)
        {
            PlayerPrefs.SetInt(key,value);
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            return PlayerPrefs.GetInt(key, defaultValue);
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ System 
            this.RegisterSystem(new AchievementSystem()); // +
             
            // æ³¨å†Œ Model
            this.RegisterModel(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
            this.RegisterUtility(new Storage());
        }
    }

    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            var model = this.GetModel<CounterAppModel>();
                
            model.Count.Value++; // -+
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<CounterAppModel>().Count.Value--; // -+
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private CounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<CounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });

            // è¡¨ç°é€»è¾‘
            mModel.Count.RegisterWithInitValue(newCount => // -+
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```


ä»£ç æ”¹åŠ¨å¾ˆå¤šï¼Œé‡è¦çš„æ”¹åŠ¨ä¸ºï¼š
* Model ä¸­çš„ Count å’Œ mCount æ”¹æˆäº†ä¸€ä¸ªå«åš Count çš„ BindableProperty
* åˆ æ‰äº† CountChangeEvent æ”¹ç”¨ç›‘å¬ BindableProperty
* Controller åœ¨åˆå§‹åŒ–ä¸­å»æ‰ä¸€æ¬¡ UpdateView çš„ä¸»åŠ¨è°ƒç”¨

å¯ä»¥è¯´ä»£ç é‡ä¸€ä¸‹å­å°‘äº†å¾ˆå¤šã€‚

æˆ‘ä»¬çœ‹ä¸‹è¿è¡Œç»“æœï¼š

![282fcc3c-96fa-46e1-b4c6-7f4528b04271.gif](https://file.liangxiegame.com/1b934e4f-8f72-44c2-800a-a97f1e707950.gif)


è¿è¡Œæ²¡é—®é¢˜ã€‚

ç”±äºæˆ‘ä»¬çš„ Count æ•°æ®ï¼Œæ˜¯å•ä¸ªæ•°æ® + äº‹ä»¶å˜æ›´çš„å½¢å¼ï¼Œæ‰€ä»¥ç”¨ BindableProperty éå¸¸åˆé€‚ï¼Œå¯ä»¥å°‘å†™å¾ˆå¤šä»£ç ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒä¸»è§’çš„é‡‘å¸ã€åˆ†æ•°ç­‰æ•°æ®éå¸¸é€‚åˆç”¨ BindableProperty çš„æ–¹å¼å®ç°ã€‚

å¥½äº† BindableProperty æˆ‘ä»¬å°±ä»‹ç»åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 08. ç”¨æ¥å£è®¾è®¡æ¨¡å—ï¼ˆä¾èµ–å€’ç½®åŸåˆ™ï¼‰

QFramework æœ¬èº«æ”¯æŒä¾èµ–å€’ç½®åŸåˆ™ï¼Œå°±æ˜¯æ‰€æœ‰çš„æ¨¡å—è®¿é—®å’Œäº¤äº’éƒ½å¯ä»¥é€šè¿‡æ¥å£æ¥å®Œæˆï¼Œä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    
    // 1. å®šä¹‰ä¸€ä¸ª Model å¯¹è±¡
    public interface ICounterAppModel : IModel
    {
        BindableProperty<int> Count { get; }
    }
    public class CounterAppModel : AbstractModel,ICounterAppModel
    {
        public BindableProperty<int> Count { get; } = new BindableProperty<int>();

        protected override void OnInit()
        {
            var storage = this.GetUtility<IStorage>();
            
            // è®¾ç½®åˆå§‹å€¼ï¼ˆä¸è§¦å‘äº‹ä»¶ï¼‰
            Count.SetValueWithoutEvent(storage.LoadInt(nameof(Count)));

            // å½“æ•°æ®å˜æ›´æ—¶ å­˜å‚¨æ•°æ®
            Count.Register(newCount =>
            {
                storage.SaveInt(nameof(Count),newCount);
            });
        }
    }

    public interface IAchievementSystem : ISystem
    {
        
    }

    public class AchievementSystem : AbstractSystem ,IAchievementSystem
    {
        protected override void OnInit()
        {
            this.GetModel<ICounterAppModel>() // -+
                .Count
                .Register(newCount =>
                {
                    if (newCount == 10)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»è¾¾äºº æˆå°±");
                    }
                    else if (newCount == 20)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»ä¸“å®¶ æˆå°±");
                    }
                    else if (newCount == -10)
                    {
                        Debug.Log("è§¦å‘ ç‚¹å‡»èœé¸Ÿ æˆå°±");
                    }
                });
        }
    }

    public interface IStorage : IUtility
    {
        void SaveInt(string key, int value);
        int LoadInt(string key, int defaultValue = 0);
    }
    
    public class Storage : IStorage
    {
        public void SaveInt(string key, int value)
        {
            PlayerPrefs.SetInt(key,value);
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            return PlayerPrefs.GetInt(key, defaultValue);
        }
    }


    // 2.å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆæä¾› MVCã€åˆ†å±‚ã€æ¨¡å—ç®¡ç†ç­‰ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œ System 
            this.RegisterSystem<IAchievementSystem>(new AchievementSystem()); 
             
            // æ³¨å†Œ Model
            this.RegisterModel<ICounterAppModel>(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
            this.RegisterUtility<IStorage>(new Storage());
        }
    }

    // å¼•å…¥ Command
    public class IncreaseCountCommand : AbstractCommand 
    {
        protected override void OnExecute()
        {
            var model = this.GetModel<ICounterAppModel>();
                
            model.Count.Value++; // -+
        }
    }
    
    public class DecreaseCountCommand : AbstractCommand
    {
        protected override void OnExecute()
        {
            this.GetModel<ICounterAppModel>().Count.Value--; // -+
        }
    }

    // Controller
    public class CounterAppController : MonoBehaviour , IController /* 3.å®ç° IController æ¥å£ */
    {
        // View
        private Button mBtnAdd;
        private Button mBtnSub;
        private Text mCountText;
        
        // 4. Model
        private ICounterAppModel mModel;

        void Start()
        {
            // 5. è·å–æ¨¡å‹
            mModel = this.GetModel<ICounterAppModel>();
            
            // View ç»„ä»¶è·å–
            mBtnAdd = transform.Find("BtnAdd").GetComponent<Button>();
            mBtnSub = transform.Find("BtnSub").GetComponent<Button>();
            mCountText = transform.Find("CountText").GetComponent<Text>();
            
            
            // ç›‘å¬è¾“å…¥
            mBtnAdd.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand<IncreaseCountCommand>();
            });
            
            mBtnSub.onClick.AddListener(() =>
            {
                // äº¤äº’é€»è¾‘
                this.SendCommand(new DecreaseCountCommand(/* è¿™é‡Œå¯ä»¥ä¼ å‚ï¼ˆå¦‚æœæœ‰ï¼‰ */));
            });

            // è¡¨ç°é€»è¾‘
            mModel.Count.RegisterWithInitValue(newCount => // -+
            {
                UpdateView();

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void UpdateView()
        {
            mCountText.text = mModel.Count.ToString();
        }

        // 3.
        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }

        private void OnDestroy()
        {
            // 8. å°† Model è®¾ç½®ä¸ºç©º
            mModel = null;
        }
    }
}

```

ä»£ç ä¸éš¾ã€‚

æ‰€æœ‰çš„æ¨¡å—æ³¨å†Œï¼Œæ¨¡å—è·å– ç­‰ä»£ç éƒ½æ˜¯é€šè¿‡æ¥å£å®Œæˆï¼Œè¿™ä¸€ç‚¹ç¬¦åˆ SOLID åŸåˆ™ä¸­çš„ ä¾èµ–å€’ç½®åŸåˆ™ã€‚

é€šè¿‡æ¥å£è®¾è®¡æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬æ›´å®¹æ˜“æ€è€ƒæ¨¡å—ä¹‹é—´çš„äº¤äº’å’ŒèŒè´£æœ¬èº«ï¼Œè€Œä¸æ˜¯å…·ä½“å®ç°ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™å¯ä»¥å‡å°‘å¾ˆå¤šçš„å¹²æ‰°ã€‚

å½“ç„¶é¢å‘æ¥å£çš„æ–¹å¼å»åšå¼€å‘ä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–çš„å¥½å¤„ï¼Œè¿™å½“ç„¶æ˜¯å¤§å®¶éšç€ä½¿ç”¨æ—¶é•¿ä¼šæ…¢æ…¢ä½“ä¼šçš„ã€‚

å…¶ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„å¤§ä¸€ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„ Storageï¼Œå¦‚æœæƒ³æŠŠå­˜å‚¨çš„ API ä» PlayerPrefs åˆ‡æ¢æˆ EasySaveï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦å»ä¿®æ”¹ Storage å¯¹è±¡ï¼Œè€Œæ˜¯æ‰©å±•ä¸€ä¸ª IStorage æ¥å£å³å¯ï¼Œä¼ªä»£ç å¦‚ä¸‹:
```csharp
    public class EasySaveStorage : IStorage
    {
        public void SaveInt(string key, int value)
        {
            // todo
        }

        public int LoadInt(string key, int defaultValue = 0)
        {
            // todo
            throw new System.NotImplementedException();
        }
    }
```

æ³¨å†Œæ¨¡å—çš„ä¼ªä»£ç å¦‚ä¸‹:

```csharp
    // å®šä¹‰ä¸€ä¸ªæ¶æ„ï¼ˆç”¨äºç®¡ç†æ¨¡å—ï¼‰
    public class CounterApp : Architecture<CounterApp>
    {
        protected override void Init()
        {
            // æ³¨å†Œæˆå°±ç³»ç»Ÿ
            this.RegisterSystem<IAchievementSystem>(new AchievementSystem());
            
            this.RegisterModel<ICounterAppModel>(new CounterAppModel());
            
            // æ³¨å†Œå­˜å‚¨å·¥å…·å¯¹è±¡
            // this.RegisterUtility<IStorage>(new Storage());
            this.RegisterUtility<IStorage>(new EasySaveStorage());
        }
    }
```

è¿™æ ·ï¼Œåº•å±‚æ‰€æœ‰å­˜å‚¨çš„ä»£ç éƒ½åˆ‡æ¢æˆäº† EasySave çš„å­˜å‚¨ï¼Œæ›¿æ¢ä¸€å¥—æ–¹æ¡ˆéå¸¸ç®€å•ã€‚

å¥½äº†ï¼Œç”¨æ¥å£è®¾è®¡æ¨¡å—çš„åŠŸèƒ½å°±ä»‹ç»å®Œäº†ã€‚

è¿™ç¯‡å†…å®¹å°±è¿™äº›ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 09. Query ä»‹ç»

Query æ˜¯ CQRS ä¸­çš„ Qï¼Œä¹Ÿå°±æ˜¯ Command Query Responsibility Saperation ä¸­çš„ Queryã€‚

å…³äº Command æˆ‘ä»¬å·²ç»ä»‹ç»äº†ã€‚

è€Œ Query æ˜¯å’Œ Command å¯¹åº”çš„æŸ¥è¯¢å¯¹è±¡ã€‚

é¦–å…ˆ Controller ä¸­çš„è¡¨ç°é€»è¾‘æ›´å¤šæ˜¯æ¥æ”¶åˆ°æ•°æ®å˜æ›´äº‹ä»¶ä¹‹åï¼Œå¯¹ Model æˆ–è€… System è¿›è¡ŒæŸ¥è¯¢ï¼Œè€ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™éœ€è¦ç»„åˆæŸ¥è¯¢ï¼Œæ¯”å¦‚å¤šä¸ª Model ä¸€èµ·æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ•°æ®å¯èƒ½è¿˜éœ€è¦è½¬æ¢ä¸€ä¸‹ï¼Œè¿™ç§æŸ¥è¯¢çš„ä»£ç é‡æ¯”è¾ƒå¤šã€‚å°¤å…¶æ˜¯åƒæ¨¡æ‹Ÿè­¦ç”¨æˆ–è€…éå¸¸é‡æ•°æ®çš„é¡¹ç›®ï¼Œæ‰€ä»¥ QFramework æ”¯æŒé€šè¿‡ Query è¿™æ ·çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ¥è§£å†³è¿™éƒ¨åˆ†é—®é¢˜ã€‚

ä½¿ç”¨çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå’Œ Command ç”¨æ³•ä¸€è‡´ï¼Œè¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªå°çš„ Appï¼Œ å«åš QueryExampleApp ä»£ç å¦‚ä¸‹:

```csharp
using System.Collections.Generic;
using UnityEngine;

namespace QFramework.Example
{
    public class QueryExampleController : MonoBehaviour,IController
    {
        public class StudentModel : AbstractModel
        {

            public List<string> StudentNames = new List<string>()
            {
                "å¼ ä¸‰",
                "æå››"
            };
            
            protected override void OnInit()
            {
                
            }
        }
        
        public class TeacherModel : AbstractModel
        {
            public List<string> TeacherNames = new List<string>()
            {
                "ç‹äº”",
                "èµµå…­"
            };
                
            protected override void OnInit()
            {
                
            }
        }

        // Architecture
        public class QueryExampleApp : Architecture<QueryExampleApp>
        {
            protected override void Init()
            {
                this.RegisterModel(new StudentModel());
                this.RegisterModel(new TeacherModel());
            }
        }
        
        
        /// <summary>
        /// è·å–å­¦æ ¡çš„å…¨éƒ¨äººæ•°
        /// </summary>
        public class SchoolAllPersonCountQuery : AbstractQuery<int>
        {
            protected override int OnDo()
            {
                return this.GetModel<StudentModel>().StudentNames.Count +
                       this.GetModel<TeacherModel>().TeacherNames.Count;
            }
        }

        private int mAllPersonCount = 0;

        private void OnGUI()
        {
            GUILayout.Label(mAllPersonCount.ToString());

            if (GUILayout.Button("æŸ¥è¯¢å­¦æ ¡æ€»äººæ•°"))
            {
                mAllPersonCount = this.SendQuery(new SchoolAllPersonCountQuery());
            }
        }

        public IArchitecture GetArchitecture()
        {
            return QueryExampleApp.Interface;
        }
    }
}
```

ä»£ç ä¸éš¾ã€‚

è¿è¡Œä¹‹åï¼Œå½“æŒ‰ä¸‹æŸ¥è¯¢æŒ‰é’®æ—¶ç»“æœå¦‚ä¸‹ï¼š


![image.png](https://file.liangxiegame.com/1736bf69-b795-408a-8c09-6e413f57b0b1.png)


å¥½äº†ï¼Œè¿™æ · Query çš„ç¤ºä¾‹å°±å†™å®Œäº†ã€‚

Query æ˜¯ä¸€ä¸ªå¯é€‰çš„æ¦‚å¿µï¼Œå¦‚æœæ¸¸æˆä¸­æ•°æ®çš„æŸ¥è¯¢é€»è¾‘å¹¶ä¸æ˜¯å¾ˆé‡çš„è¯ï¼Œç›´æ¥åœ¨ Controller çš„è¡¨ç°é€»è¾‘é‡Œå†™å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®æ¯”è¾ƒé‡ï¼Œæˆ–è€…é¡¹ç›®è§„æ¨¡éå¸¸å¤§çš„è¯ï¼Œæœ€å¥½æ˜¯ç”¨ Query æ¥æ‰¿æ‹…æŸ¥è¯¢çš„é€»è¾‘ã€‚


Command ä¸€èˆ¬è´Ÿè´£æ•°æ®çš„ å¢ åˆ  æ”¹ï¼Œè€Œ Query è´Ÿè´£æ•°æ®çš„ æŸ¥ã€‚


å¦‚æœæ¸¸æˆéœ€è¦ä»æœåŠ¡å™¨åŒæ­¥æ•°æ®ï¼Œä¸€èˆ¬æ‹‰å–æœåŠ¡å™¨æ•°æ®çš„è¯·æ±‚å¯ä»¥å†™åœ¨ Query ä¸­ï¼Œè€Œå¢åˆ æ”¹æœåŠ¡å™¨è¾“çš„è¯·æ±‚å¯ä»¥å†™åœ¨ Command ä¸­ã€‚

å¥½äº†ï¼Œå…³äº Query å°±ä»‹ç»åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 10. æ¶æ„è§„èŒƒ ä¸ æ¨èç”¨æ³•

QFramework æ¶æ„æä¾›äº†å››ä¸ªå±‚çº§ï¼š
* è¡¨ç°å±‚ï¼šIController
* ç³»ç»Ÿå±‚ï¼šISystem
* æ•°æ®å±‚ï¼šIModel
* å·¥å…·å±‚ï¼šIUtility


é™¤äº†å››ä¸ªå±‚çº§ï¼Œè¿˜æä¾›äº† Commandã€Queryã€Eventã€BindableProperty ç­‰æ¦‚å¿µå’Œå·¥å…·ã€‚

è¿™é‡Œæœ‰ä¸€å¥—å±‚çº§çš„è§„åˆ™ï¼Œå¦‚ä¸‹ï¼š

* è¡¨ç°å±‚ï¼šViewController å±‚ã€‚IControlleræ¥å£ï¼Œè´Ÿè´£æ¥æ”¶è¾“å…¥å’ŒçŠ¶æ€å˜åŒ–æ—¶çš„è¡¨ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMonoBehaviour å‡ä¸ºè¡¨ç°å±‚
  * å¯ä»¥è·å– Systemã€Model
  * å¯ä»¥å‘é€ Commandã€Query
  * å¯ä»¥ç›‘å¬ Event

Controller çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š

```csharp
#region Controller

public interface IController : IBelongToArchitecture, ICanSendCommand, ICanGetSystem, ICanGetModel,ICanRegisterEvent, ICanSendQuery
{
}

#endregion
```

* ç³»ç»Ÿå±‚ï¼šSystemå±‚ã€‚ISystemæ¥å£ï¼Œå¸®åŠ©IControlleræ‰¿æ‹…ä¸€éƒ¨åˆ†é€»è¾‘ï¼Œåœ¨å¤šä¸ªè¡¨ç°å±‚å…±äº«çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¡æ—¶ç³»ç»Ÿã€å•†åŸç³»ç»Ÿã€æˆå°±ç³»ç»Ÿç­‰
  * å¯ä»¥è·å– Systemã€Model
  * å¯ä»¥ç›‘å¬Event
  *  å¯ä»¥å‘é€Event

System çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š

```csharp
#region System

public interface ISystem : IBelongToArchitecture, ICanSetArchitecture, ICanGetModel, ICanGetUtility,ICanRegisterEvent, ICanSendEvent, ICanGetSystem
{
    void Init();
}
```


* æ•°æ®å±‚ï¼šModelå±‚ã€‚IModelæ¥å£ï¼Œè´Ÿè´£æ•°æ®çš„å®šä¹‰ã€æ•°æ®çš„å¢åˆ æŸ¥æ”¹æ–¹æ³•çš„æä¾›
  * å¯ä»¥è·å– Utility
  * å¯ä»¥å‘é€ Event


Model çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š
```csharp
public interface IModel : IBelongToArchitecture, ICanSetArchitecture, ICanGetUtility, ICanSendEvent
{
    void Init();
}
```


* å·¥å…·å±‚ï¼šUtilityå±‚ã€‚IUtilityæ¥å£ï¼Œè´Ÿè´£æä¾›åŸºç¡€è®¾æ–½ï¼Œæ¯”å¦‚å­˜å‚¨æ–¹æ³•ã€åºåˆ—åŒ–æ–¹æ³•ã€ç½‘ç»œè¿æ¥æ–¹æ³•ã€è“ç‰™æ–¹æ³•ã€SDKã€æ¡†æ¶ç»§æ‰¿ç­‰ã€‚å•¥éƒ½å¹²ä¸äº†ï¼Œå¯ä»¥é›†æˆç¬¬ä¸‰æ–¹åº“ï¼Œæˆ–è€…å°è£…API

Utility çš„æ¥å£å®šä¹‰å¦‚ä¸‹:
```csharp
#region Utility

public interface IUtility
{
}

#endregion
```


* Commandï¼šå‘½ä»¤ï¼Œè´Ÿè´£æ•°æ®çš„å¢åˆ æ”¹ã€‚
  * å¯ä»¥è·å– Systemã€Model
  * å¯ä»¥å‘é€ Eventã€Command

Command çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š

```csharp
public interface ICommand : IBelongToArchitecture, ICanSetArchitecture, ICanGetSystem, ICanGetModel, ICanGetUtility,ICanSendEvent, ICanSendCommand, ICanSendQuery
{
    void Execute();
}
```

* Queryï¼šæŸ¥è¯¢ã€è´Ÿè´£æ•°æ®çš„æŸ¥è¯¢
  * å¯ä»¥è·å– Systemã€Model
  * å¯ä»¥å‘é€ Query

```csharp
public interface IQuery<TResult> : IBelongToArchitecture, ICanSetArchitecture, ICanGetModel, ICanGetSystem,ICanSendQuery
{
    TResult Do();
}
```


* é€šç”¨è§„åˆ™ï¼š
  - IController æ›´æ”¹ ISystemã€IModel çš„çŠ¶æ€å¿…é¡»ç”¨Command
  - ISystemã€IModel çŠ¶æ€å‘ç”Ÿå˜æ›´åé€šçŸ¥ IController å¿…é¡»ç”¨äº‹ä»¶æˆ–BindableProperty
  - IControllerå¯ä»¥è·å–ISystemã€IModelå¯¹è±¡æ¥è¿›è¡Œæ•°æ®æŸ¥è¯¢
  - ICommandã€IQuery ä¸èƒ½æœ‰çŠ¶æ€,
  - ä¸Šå±‚å¯ä»¥ç›´æ¥è·å–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸èƒ½è·å–ä¸Šå±‚å¯¹è±¡
  - ä¸‹å±‚å‘ä¸Šå±‚é€šä¿¡ç”¨äº‹ä»¶
  - ä¸Šå±‚å‘ä¸‹å±‚é€šä¿¡ç”¨æ–¹æ³•è°ƒç”¨ï¼ˆåªæ˜¯åšæŸ¥è¯¢ï¼ŒçŠ¶æ€å˜æ›´ç”¨ Commandï¼‰ï¼ŒIController çš„äº¤äº’é€»è¾‘ä¸ºç‰¹åˆ«æƒ…å†µï¼Œåªèƒ½ç”¨ Command

é€šç”¨è§„åˆ™æ˜¯ç†æƒ³çŠ¶æ€ä¸‹çš„ä¸€å¥—è§„åˆ™ï¼Œä½†æ˜¯è½å®çš„å®é™…é¡¹ç›®ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¯¹ä»¥ä¸Šè§„åˆ™åšä¸€äº›ä¿®æ”¹ã€‚

ä¿®æ”¹çš„æ–¹å¼éå¸¸ç®€å•ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ› IController å¯ä»¥å‘é€äº‹ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨ IController æ¥å£ä¸Šå¢åŠ ä¸€ä¸ª ICanSendEvent æ¥å£å³å¯ï¼Œä»£ç å¦‚ä¸‹:

```csharp
    #region Controller

    public interface IController : IBelongToArchitecture, ICanSendCommand, ICanGetSystem, ICanGetModel,
        ICanRegisterEvent, ICanSendQuery,
        ICanSendEvent // +
    {
    }

    #endregion
```

è¿™æ ·ï¼Œå°±å¯ä»¥åœ¨ Controller å¯¹è±¡é‡Œï¼Œé€šè¿‡ this.SendEvent æ¥å‘é€äº‹ä»¶äº†ã€‚

å¦‚æœæ˜¯æ‰“ç®—å…ˆäº†è§£æˆ–å­¦ä¹  QFramework æ¶æ„ï¼Œé‚£ä¹ˆæˆ‘æ¨èå°±å…ˆæŒ‰ç…§ QFramework é»˜è®¤çš„æ¶æ„è§„èŒƒæ¥åšç»ƒä¹ é¡¹ç›®ã€‚

å¦‚æœæ˜¯æ‰“ç®—é©¬ä¸Šç”¨ QFramework åšé¡¹ç›®ï¼Œé‚£ä¹ˆå¯ä»¥å†ä¿æŒåŸæœ‰å¼€å‘ä¹ æƒ¯çš„åŸºç¡€ä¸Šï¼Œä¸€ç‚¹ç‚¹å¼•å…¥ QFramework çš„æ¦‚å¿µï¼Œæ¯”å¦‚ä¸€å¼€å§‹ç”¨ BindableProperty å’Œ Architecture æ¥è§£å†³ Model å’Œæ•°æ®æ›´æ–°çš„é—®é¢˜ã€‚

å†æ…¢æ…¢å¼€å§‹ç”¨ Command æ¥è§£å†³äº¤äº’é€»è¾‘è‡ƒè‚¿çš„é—®é¢˜ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°èƒ½å®Œå…¨æŒæ¡å…¨éƒ¨æ¦‚å¿µï¼Œæœ€ç»ˆèƒ½ä¿®æ”¹å’Œå®šåˆ¶ QFramework.cs æºç ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 11. å…‰é€Ÿå®ç° EditorCounterApp å’Œ ç»™ä¸»ç¨‹çœ‹çš„å¼€å‘æ¨¡å¼

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå¥½ç©çš„äº‹æƒ…ï¼Œå°±æ˜¯åœ¨å‰è¾¹å·²ç»å®ç°å¥½çš„ CounterApp çš„åŸºç¡€ä¸Šï¼Œå…‰é€Ÿå®ç°ä¸€ä¸ªç¼–è¾‘å™¨ç‰ˆæœ¬çš„ CounterAppã€‚

ä»£ç éå¸¸ç®€å•ï¼Œå¦‚ä¸‹:

```csharp
#if UNITY_EDITOR
using System;
using UnityEditor;
using UnityEngine;

namespace QFramework.Example
{
    public class EditorCounterAppWindow : EditorWindow,IController
    {

        [MenuItem("QFramework/Example/EditorCounterAppWindow")]
        static void Open()
        {
            GetWindow<EditorCounterAppWindow>().Show();
        }
        
        private ICounterAppModel mCounterAppModel;

        private void OnEnable()
        {
            mCounterAppModel = this.GetModel<ICounterAppModel>();
        }

        private void OnDisable()
        {
            mCounterAppModel = null;
        }

        private void OnGUI()
        {
            if (GUILayout.Button("+"))
            {
                this.SendCommand<IncreaseCountCommand>();
            }
            
            GUILayout.Label(mCounterAppModel.Count.Value.ToString());


            if (GUILayout.Button("-"))
            {
                this.SendCommand<DecreaseCountCommand>();
            }
        }

        public IArchitecture GetArchitecture()
        {
            return CounterApp.Interface;
        }
    }
}

#endif
```

ä»£ç é‡ä¸å¤šï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/3b685522-d4ef-4648-ba3d-5726aaee7b62.png)


è¿™æ ·å°±éå¸¸å¿«é€Ÿåœ°å®ç°äº† CounterApp çš„ ç¼–è¾‘å™¨ç‰ˆæœ¬ã€‚

å› ä¸º QFramework å†™çš„ App ï¼Œåº•å±‚ä¸‰å±‚æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚

å¦‚å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/fc803d9e-2868-4b5b-af29-d39dd9e37891.png)

åº•å±‚çš„ä¸‰å±‚ ä¸ è¡¨ç°å±‚ çš„é€šä¿¡æ–¹å¼æœ‰ Commandã€å›è°ƒ/äº‹ä»¶ã€æ–¹æ³•/Queryã€‚


æˆ‘ä»¬å¯ä»¥æŠŠè¡¨ç°å±‚ç±»æ¯”æˆç½‘é¡µå‰ç«¯ï¼Œè€Œåº•å±‚ä¸‰å±‚ç±»æ¯”æˆæœåŠ¡å™¨ã€‚

é‚£ä¹ˆ Commandã€å›è°ƒ/äº‹ä»¶ã€æ–¹æ³•/Query å…¶å®å°±æ˜¯ç±»ä¼¼äº HTTP æˆ–è€… TCP çš„æ¥å£æˆ–åè®®ã€‚

è€Œæ¥å£æˆ–è€…åè®®åªè¦åšå¥½çº¦å®šï¼Œé‚£ä¹ˆå‰ç«¯å°±ä¸éœ€è¦å…³å¿ƒæœåŠ¡ç«¯çš„å…·ä½“å®ç°äº†ï¼Œè€ŒæœåŠ¡ç«¯ä¹Ÿä¸éœ€è¦å…³å¿ƒå‰ç«¯çš„å…·ä½“å®ç°ã€‚

è¿™å°±åšåˆ°äº†åœ¨åˆ†å·¥æ—¶ï¼Œå°†è¡¨ç°å±‚å’Œåº•å±‚ä¸‰å±‚çš„å·¥ä½œåˆ†åˆ«ç»™ä¸åŒçš„äººæ¥è´Ÿè´£ã€‚

è€Œç¬”è€…æ›¾ç»åšè¿‡ä¸€ä¸ªè¿™æ ·çš„é¡¹ç›®ã€‚

åœ¨é¡¹ç›®ä¸­ç¬”è€…è´Ÿè´£å°† åº•å±‚ä¸‰å±‚å®ç°å¥½ï¼Œç„¶åå’ŒæœåŠ¡å™¨æŠŠæ•°æ®å’Œæ¥å£è°ƒå¥½ï¼Œæ•°æ®çš„æ˜¾ç¤ºéƒ¨åˆ†ç¬”è€…ç”¨çš„ä¸€ä¸ªå¿«é€Ÿå†™ç•Œé¢çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ xmllayout æˆ–è€… delightï¼Œè¿™ç§æ–¹æ¡ˆå†™ç•Œé¢éå¸¸å¿«ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç³»ç»ŸåŸå‹ã€‚

ç„¶åç­‰æ•°æ®å’Œæ¥å£è°ƒå¥½ï¼Œç³»ç»ŸåŸå‹å®ç°å¥½åï¼ŒæŠŠç•Œé¢ã€åšåœºæ™¯æµç¨‹ã€åšè¡¨ç°çš„å·¥ä½œéƒ½åˆ†é…ç»™äº†åˆå­¦è€…çš„åŒäº‹ä»¬ï¼ŒåŒäº‹ä»¬åªè¦çœ‹å®ç°çš„ç³»ç»ŸåŸå‹ï¼Œå°±çŸ¥é“è°ƒç”¨å“ªäº› Command/Queryã€ç›‘å¬å“ªäº›äº‹ä»¶ã€æˆ–è°ƒç”¨å“ªäº›æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥åšå¥½åˆ†å·¥åä½œäº†ã€‚

ç”¨ä¸€å¼ å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/430968f9-68a8-470a-8450-b70316a31419.png)


å½“ç„¶è¿™åªæ˜¯å…¶ä¸­ä¸€ç§çš„é¡¹ç›®å¼€å‘æ¨¡å¼ã€‚

éšç€æ—¶é—´ï¼Œåˆå­¦è€…åŒäº‹ä»¬ç”¨ç†Ÿäº†è¿™å¥—æ¶æ„ä¹‹åï¼Œæ¸æ¸åœ°ä¹Ÿèƒ½è‡ªå·±å†™åº•å±‚ä¸‰å±‚äº†ï¼Œäºæ˜¯ç¬”è€…å°±æ…¢æ…¢æŠŠåº•å±‚çš„å·¥ä½œé‡ä¹Ÿåˆ†å‡ºå»äº†ï¼Œè‡ªå·±å°±æ²¡å•¥äº‹å¹²äº†ã€‚

å¥½äº†ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡ç¬”è€…æ›¾ç»ä½¿ç”¨çš„ä¸€ç§å¼€å‘æ¨¡å¼çš„åˆ†äº«ï¼Œè€Œå…·ä½“è‡ªå·±çš„å¼€å‘æ¨¡å¼ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥åˆ¶å®šï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å…ˆæŒ‰ç…§åŸæœ‰çš„ä¹ æƒ¯çš„å¼€å‘æ¨¡å¼ï¼Œç„¶åé€æ¸æŒæ¡è¿™å¥—æ¶æ„ï¼ŒæŒæ¡äº†ä¹‹åæ…¢æ…¢æ”¹è¿›ä¹‹å‰çš„å¼€å‘æ¨¡å¼ã€‚

è¿™ç¯‡å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)


# 12. çº¸ä¸Šè®¾è®¡
ç”±äº QFramework æ”¯æŒ MVCã€åˆ†å±‚ å’Œ CQRSï¼Œå†åŠ ä¸Šæä¾›äº†ä½¿ç”¨è§„èŒƒï¼Œé‚£ä¹ˆ QFramework å°±å¯ä»¥è¾¾åˆ°é«˜åº¦çš„æ ‡å‡†åŒ–ï¼Œè¾¾åˆ°é«˜åº¦çš„æ ‡å‡†åŒ–é‚£ä¹ˆå°±æœ‰äº†åšä¸€ä»¶äº‹æƒ…çš„æ¡ä»¶ï¼Œå°±æ˜¯çº¸ä¸Šè®¾è®¡ã€‚

å‡å¦‚æˆ‘ä»¬æƒ³å®ç°ä¸€ä¸ªä¸»è§’åƒé‡‘å¸ï¼Œé‡‘å¸æ•°é‡å¢åŠ çš„åŠŸèƒ½ï¼Œåˆ™å¯ä»¥æŒ‰ç…§å¦‚ä¸‹é¡ºåºè®¾è®¡å›¾ã€‚


é¦–å…ˆéœ€è¦ç¡®å®šæ•°æ®ç»“æ„ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨ç±»å›¾æ¥ç¡®å®šï¼Œä¹Ÿå¯ä»¥ç”¨æ›´ç®€å•çš„æ–¹å¼ç»˜åˆ¶ã€‚

![image.png](https://file.liangxiegame.com/fb76cf87-9758-4289-8b6b-29621beba7c4.png)



ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¡¨ç°å±‚å¦‚ä½•æ˜¾ç¤ºé‡‘å¸ã€‚

![image.png](https://file.liangxiegame.com/6f4dcfce-75a6-4e5d-bfc0-edc5f2e20f16.png)

æ¥ç€ï¼Œæˆ‘ä»¬è¦å¼€å§‹è®¾è®¡ Commandã€‚

![image.png](https://file.liangxiegame.com/ed1b486b-4ea7-45e1-8af2-6c238952c83e.png)

ç„¶åï¼Œå¯ä»¥æŠŠå¦‚ä½•è§¦å‘ï¼Œå’Œå¦‚ä½•æ›´æ–°çš„å›¾éƒ½ç”»å¥½ã€‚

![image.png](https://file.liangxiegame.com/504fc46e-351a-4b56-874e-bbb9d2879642.png)

è¿™æ ·ä¸€ä¸ªåƒé‡‘å¸çš„åŠŸèƒ½æ€è·¯å°±è®¾è®¡å¥½äº†ã€‚

å½“ç„¶åƒé‡‘å¸è¿™ä¸ªä¾‹å­å¾ˆç®€å•ã€‚

ä¸è¿‡ç¬”è€…å»ºè®®ï¼Œå¦‚æœ QFramework æ¶æ„ç”¨å¾—ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„æ—¶å€™ï¼Œå°±ç”¨è¿™ç§å°åŠŸèƒ½æ¥åšä¸€äº›çº¸ä¸Šè®¾è®¡æ¯”è¾ƒåˆé€‚ã€‚

è€Œå½“ QFramework æ¶æ„ç”¨å¾—å¾ˆç†Ÿçš„æ—¶å€™ï¼Œå¯ä»¥åœ¨çº¸ä¸Šè®¾è®¡ä¸€äº›æ›´å¤æ‚çš„åŠŸèƒ½ã€‚

æ¯”å¦‚æŠ€èƒ½ç³»ç»Ÿã€å¼ºåŒ–é“å…·ç³»ç»Ÿã€èƒŒåŒ…ç³»ç»Ÿã€ä»»åŠ¡ç³»ç»Ÿç­‰ç­‰ã€‚


æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¬¬ä¸€ç¯‡ä¸­çš„ä¸€å¼ å›¾ã€‚

![](https://file.liangxiegame.com/6bf42306-0b2a-4417-bbcf-354af0132596.png)

è¿™å¼ å›¾ï¼Œå…¶å®å°±æ˜¯ä¸€å¼ çº¸ä¸Šè®¾è®¡å›¾ï¼Œå³ å½“ä¸»è§’æ‰“æ­»æ•Œäººå è§¦å‘åˆ†æ•°å˜æ›´ã€è§¦å‘æˆå°±è¾¾æˆ çš„åŠŸèƒ½ã€‚

è¿™ç§å›¾åŠ ä¸Šåƒé‡‘å¸å›¾ï¼Œæ˜¯ QFramework çº¸ä¸Šè®¾è®¡ä¸­çš„ åŠŸèƒ½å›¾ã€‚


é™¤äº†åŠŸèƒ½å›¾ ï¼Œè¿˜æœ‰ QFrameowrk çº¸ä¸Šè®¾è®¡çš„ æ¶æ„å›¾ã€‚

æ¶æ„å›¾çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/c1584a3b-f8be-49a1-897a-9f1b684864bf.png)


æ¶æ„å›¾åªæ˜¯ç½—åˆ—äº†æ¯ä¸ªæ¨¡å—éƒ½åœ¨å“ªä¸ªå±‚çº§ï¼Œå¹¶æ²¡æœ‰å±•ç¤ºå…·ä½“å¦‚ä½•äº¤äº’ã€‚

è€ŒåŠŸèƒ½åˆ™æ˜¯å±•ç¤ºäº†ä¸€ä¸ªåŠŸèƒ½å…·ä½“çš„é€»è¾‘æ§åˆ¶æµå‘ã€‚

åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¶æ„å›¾ å’Œ åŠŸèƒ½å›¾ éƒ½ä¸æ˜¯å¿…é¡»çš„ã€‚

åŠŸèƒ½å›¾åœ¨æ—©æœŸæ›´å¤šæ˜¯å¸®åŠ© QFramework ä¸ç†Ÿæ‚‰çš„äººæ¢³ç†æ€è·¯ç”¨çš„ã€‚

ä½†æ˜¯ä¹Ÿæœ‰å¼€å‘äººå‘˜ä¸åœ¨ç”µè„‘æ—çš„æ—¶å€™ï¼Œè€Œæ­¤æ—¶é¡¹ç›®ä¹Ÿæ¯”è¾ƒç´§ï¼Œè¿™ä¸ªæ—¶å€™ çº¸ä¸Šè®¾è®¡ å°±ä¼šæ’ä¸Šç”¨åœºäº†ã€‚

å¼€å‘äººå‘˜å®Œå…¨å¯ä»¥çº¸ä¸ŠæŠŠæ•´ä¸ªé¡¹ç›®çš„åŠŸèƒ½æ€è·¯éƒ½å®ç°å‡ºæ¥ã€‚

è¿˜æœ‰ä¸€ç§ç”¨æ³•å°±æ˜¯ï¼Œå¼€å‘äººå‘˜æ‹¿åˆ°éœ€æ±‚ä¹‹åï¼Œé›†åˆå…¨éƒ¨å¼€å‘äººå‘˜å¼€ä¸€æ¬¡ä¼šè®®ï¼Œåœ¨ä¼šè®®ä¸­è¾¹ç ”è¯»ç­–åˆ’æ–‡æ¡£è¾¹å’Œå¤§å®¶ä¸€èµ·ç”¨çº¸ä¸Šè®¾è®¡æŠŠæ•´ä¸ªé¡¹ç›®çš„åŠŸèƒ½æ€è·¯éƒ½å®ç°å‡ºæ¥ï¼Œç„¶åå†æŠŠç¼–ç å’Œå…·ä½“å®ç°çš„å·¥ä½œé‡åˆ†é…ç»™æ¯ä¸ªäººï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ç”¨æ³•ã€‚

æ€»ä¹‹ çº¸ä¸Šè®¾è®¡ æ˜¯éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªæ–¹æ³•ã€‚

å¯èƒ½æœ‰äººä¼šé—®ï¼Œçº¸ä¸Šè®¾è®¡éœ€è¦éµå¾ªä»€ä¹ˆæ ¼å¼å—ï¼Ÿ

ç­”æ¡ˆæ˜¯æ²¡æœ‰çš„ã€‚

å¦‚æœä¹ æƒ¯ç”¨ UML ç±»å›¾ï¼Œé‚£å°±ç”¨ UML ç±»å›¾ç»˜åˆ¶ï¼Œå¦‚æœä¹ æƒ¯ç”¨æ–¹å—ã€åœ†åœˆã€æ£±è§’é‚£å°±ç”¨æ–¹å—ã€åœ†åœˆã€æ£±è§’ï¼Œå¦‚æœä¹ æƒ¯ç”¨çº¸ç¬”ï¼Œé‚£å°±ç”¨çº¸ç¬”ã€‚

æ€»ä¹‹æ€ä¹ˆå¿«æ€ä¹ˆæ–¹ä¾¿å°±æ€ä¹ˆç”¨ã€‚


çº¸ä¸Šè®¾è®¡ é™¤äº†æ–¹ä¾¿åŠŸèƒ½å®ç°ï¼Œä¹Ÿæ–¹ä¾¿åœ¨å›¢é˜Ÿå†…æ²Ÿé€šï¼Œæ¯”å¦‚ä¸€ä½å¼€å‘äººå‘˜å¦‚æœå¯¹å®ç°ä¸€ä¸ªåŠŸèƒ½æ²¡æœ‰æ€è·¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥é—®ä¸»ç¨‹æˆ–è€… QFramework é«˜æ‰‹ï¼Œè®©é«˜æ‰‹ç”¨ä¸€å¼ çº¸æ¥æ¢³ç†æ€è·¯ï¼Œè¿™æ ·å¼€å‘äººå‘˜æ‹¿åˆ°è¿™å¼ çº¸å°±å¯ä»¥å»å®ç°äº†ã€‚è¿˜å¯ä»¥æ¯æ¬¡è®©å¼€å‘äººå‘˜å…ˆåœ¨çº¸ä¸Šè®¾è®¡å¥½ï¼Œç„¶åæŠŠè¿™å¼ çº¸æ‹¿ç»™ä¸»ç¨‹æˆ–è€… QFramework é«˜æ‰‹ï¼Œä¸»ç¨‹æˆ– QFramework é«˜æ‰‹éªŒè¯å®Œæ‰å¯ä»¥è¿›è¡Œç¼–ç å®ç°ï¼Œè¿™æ ·ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

å¥½äº†å…³äºçº¸ä¸Šè®¾è®¡çš„å…¥é—¨å’Œä¸€äº›æ‹“å±•ç”¨æ³•å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)







# 13. Architecture çš„å¥½å¤„


ä¸ç®¡æ˜¯ Systemã€Model è¿˜æ˜¯ Utilityï¼Œéƒ½ä¼šæ³¨å†Œåˆ° Architecture ä¸­ã€‚

ä¼ªä»£ç å¦‚ä¸‹:
```csharp
namespace QFramework.PointGame
{
    public class PointGame : Architecture<PointGame>
    {
        protected override void Init()
        {
            RegisterSystem<IScoreSystem>(new ScoreSystem());
            RegisterSystem<ICountDownSystem>(new CountDownSystem());
            RegisterSystem<IAchievementSystem>(new AchievementSystem());

            RegisterModel<IGameModel>(new GameModel());

            RegisterUtility<IStorage>(new PlayerPrefsStorage());
        }
    }
}

```

å¤§å®¶å¯èƒ½ä¼šé—®ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®æœ‰éå¸¸å¤šçš„ Systemã€Modelã€Utility å…¨éƒ¨æ³¨å†Œåˆ° Architectureï¼Œè¿™æ · Architecture çš„ä»£ç é‡å°±å˜å¤šäº†ï¼Œä¼šä¸ä¼šè®©é¡¹ç›®å˜å¾—éš¾ä»¥ç®¡ç†ï¼Ÿ

ç­”æ¡ˆæ˜¯ä¸ä¼šï¼ŒArchitecture æ³¨å†Œçš„æ¨¡å—è¶Šå¤šï¼Œè¿™å¥—æ¶æ„å‘æŒ¥çš„ä½œç”¨å°±è¶Šå¤§ã€‚

å› ä¸º Architecture æœ¬èº«å°±èƒ½å¾ˆå¥½åœ°å±•ç¤ºé¡¹ç›®çš„ç»“æ„ï¼Œå¯ä»¥æŠŠ Architecture æœ¬èº«å½“åšä¸€ä¸ªæ¶æ„å›¾ã€‚

æ¯”å¦‚ä»¥ä¸Šä¼ªä»£ç å¯¹åº”çš„æ¶æ„å›¾å¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/cc294f03-4171-4cb3-b774-b487688e51fb.png)
éå¸¸æ¸…æ™°ã€‚

è€Œä¼ªä»£ç ä¸­åªæœ‰ 5 ä¸ªæ³¨å†Œæ¨¡å—ï¼Œæ˜¯éå¸¸å°‘è§çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¡¹ç›®éƒ½ä¼šæ³¨å†Œåå‡ ä¸ªç”šè‡³å‡ åä¸ªæ¨¡å—ï¼Œä¹Ÿæœ‰ä¸Šç™¾ä¸ªæ¨¡å—çš„æ—¶å€™ã€‚

è€Œå¦‚æœè¿™äº›æ¨¡å—æ²¡æœ‰ç”¨ QFramework è€Œå…¨éƒ¨ä½¿ç”¨å•ä¾‹å®ç°çš„è¯ï¼Œé¡¹ç›®å°±ä¼šå˜å¾—å¾ˆæ··ä¹±ã€‚

è€Œä½¿ç”¨äº† QFrameworkï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Architecture ä¸­ç»Ÿä¸€é›†ä¸­ç®¡ç†è¿™äº›æ¨¡å—ï¼Œæ˜¯æ–¹ä¾¿é¡¹ç›®ç®¡ç†çš„ã€‚

è¿™å°±æ˜¯ä½¿ç”¨ Architecture çš„ä¼˜åŠ¿ã€‚

è¿™é‡Œï¼Œå†è´´å‡ºä¸€ä¸‹ç¬”è€…æ›¾ç»å†™çš„é¡¹ç›®çš„ Architectureï¼Œä»£ç å¦‚ä¸‹:

```csharp
using IndieGame.Models;
using IndieGame.Utility;
using QFramework;
using UnityEngine;
using UTGM;

namespace IndieGame
{
    public class LiangxiesGame : Architecture<LiangxiesGame>
    {
        public static bool IsTestMode = true;

        public static void SetTestMode(bool testMode)
        {
            IsTestMode = testMode;
        }

        protected override void Init()
        {
            RegisterSystem<ISaveSystem>(new SaveSystem());
            RegisterSystem<IInputSystem>(new InputSystem());
            RegisterSystem<ILevelSystem>(new LevelSystem());
            RegisterSystem<IBookSystem>(new BookSystem());
            RegisterSystem<IMapSystem>(new MapSystem());
            RegisterSystem<IGameTimeSystem>(new GameTimeSystem());
            RegisterSystem<IRankSystem>(new RankSystem());
            RegisterSystem<IGameSystem>(new GameSystem());
            RegisterSystem<ILuaSystem>(new LuaSystem());
            RegisterSystem<IAchievementSystem>(new AchievementSystem());
            RegisterSystem<IEnemyRecycleSystem>(new EnemyRecycleSystem());
            RegisterSystem<IUISystem>(new UISystem());
            RegisterSystem<IHurtSystem>(new HurtSystem());
            RegisterSystem<ILevelUpSystem>(new LevelUpSystem());
            RegisterSystem<ILevelConfigSystem>(new LevelConfigSystem());
        
            RegisterModel<ICoinModel>(new CoinModel());
            RegisterModel<ISettingModel>(new SettingModel());
            RegisterModel<IBookModel>(new BookModel());
            RegisterModel<IMechanismModel>(new MechanismModel());
            RegisterModel<IPlayerModel>(new PlayerModel());
            
            RegisterUtility<IStorage>(new EasySaveStorage());

            Application.persistentDataPath.CreateDirIfNotExists();
        }
    }
}
```

System å±‚æœ‰ä»€ä¹ˆã€Model å±‚æœ‰ä»€ä¹ˆã€Utility å±‚æœ‰ä»€ä¹ˆï¼Œä¸€ç›®äº†ç„¶ã€‚

å¥½äº†ï¼Œè¿™ç¯‡å°±åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 14. Command æ‹¦æˆª

QFramework æä¾›äº†æ‹¦æˆª Command çš„ APIã€‚

æˆ‘ä»¬å°è¯•åœ¨ CounterApp ä¸­å®ç°ä¸€ä¸ª Command æ—¥å¿—ã€‚

ä»£ç å¾ˆç®€å•ï¼Œå¦‚ä¸‹:

```csharp
public class CounterApp : Architecture<CounterApp>
{
    protected override void Init()
    {
        // æ³¨å†Œ System 
        this.RegisterSystem<IAchievementSystem>(new AchievementSystem()); 
             
        // æ³¨å†Œ Model
        this.RegisterModel<ICounterAppModel>(new CounterAppModel());
            
        // æ³¨å†Œå­˜å‚¨å·¥å…·çš„å¯¹è±¡
        this.RegisterUtility<IStorage>(new Storage());
    }

    protected override void ExecuteCommand(ICommand command)
    {
        Debug.Log("Before " + command.GetType().Name + "Execute");
        base.ExecuteCommand(command);
        Debug.Log("After " + command.GetType().Name + "Execute");
    }
}
```

åªéœ€è¦åœ¨ Architecture ä¸­è¦†å†™ ExecuteCommand å³å¯ã€‚

è¿è¡Œä¹‹åï¼Œç¬”è€…éšæ„ç‚¹å‡»äº†å‡ æ¬¡æŒ‰é’®ï¼Œç»“æœå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/96bdc2f4-222d-4e91-a10e-dc2128e50fb4.png)

è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ Command æ—¥å¿—åŠŸèƒ½ã€‚


## æœ‰äº† Command æ‹¦æˆªæœ‰ä»€ä¹ˆç”¨ï¼Ÿ

æœ‰äº† Command æ‹¦æˆªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åšéå¸¸å¤šçš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š
* Command æ—¥å¿—å¯ä»¥ç”¨æ¥æ–¹ä¾¿è°ƒè¯•
* å¯ä»¥å®ç° Command ä¸­é—´ä»¶æ¨¡å¼ å¯ä»¥å†™å„ç§å„æ ·é¢åº¦ Command ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ Command æ—¥å¿—ä¸­é—´ä»¶
* å¯ä»¥æ–¹ä¾¿ä½ å…ˆæ’¤é”€åŠŸèƒ½
* å¯ä»¥ç”¨ Command åšè‡ªåŠ¨åŒ–æµ‹è¯•
* ç­‰ç­‰

å¥½äº†è¿™ç¯‡å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 15. å†…ç½®å·¥å…·ï¼šTypeEventSystem

QFramework é™¤äº†æä¾›äº†ä¸€å¥—æ¶æ„ä¹‹å¤–ï¼ŒQFramework è¿˜æä¾›ä¸‰ä¸ªå¯ä»¥è„±ç¦»æ¶æ„ä½¿ç”¨çš„å·¥å…· TypeEventSystemã€EasyEventã€BindablePropertyã€IOCContainerã€‚

è¿™äº›å·¥å…·å¹¶ä¸æ˜¯æœ‰æ„æä¾›ï¼Œè€Œæ˜¯ QFramework çš„æ¶æ„åœ¨è®¾è®¡ä¹‹åˆæ˜¯é€šè¿‡è¿™ä¸‰ä¸ªå·¥å…·ç»„åˆä½¿ç”¨è€Œæˆçš„ã€‚

åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥å­¦ä¹  TypeEventSystem çš„ä½¿ç”¨ã€‚

## åŸºæœ¬ä½¿ç”¨

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class TypeEventSystemBasicExample : MonoBehaviour
    {
        public struct TestEventA
        {
            public int Age;
        }

        private void Start()
        {
            TypeEventSystem.Global.Register<TestEventA>(e =>
            {
                Debug.Log(e.Age);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        private void Update()
        {
            // é¼ æ ‡å·¦é”®ç‚¹å‡»
            if (Input.GetMouseButtonDown(0))
            {
                TypeEventSystem.Global.Send(new TestEventA()
                {
                    Age = 18
                });
            }

            // é¼ æ ‡å³é”®ç‚¹å‡»
            if (Input.GetMouseButtonDown(1))
            {
                TypeEventSystem.Global.Send<TestEventA>();
            }
        }
    }
}

// è¾“å‡ºç»“æœ
// ç‚¹å‡»é¼ æ ‡å·¦é”®ï¼Œåˆ™è¾“å‡º:
// 18
// ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œåˆ™è¾“å‡º:
// 0
```

è¿™å°±æ˜¯ TypeEventSystem çš„æœ€åŸºæœ¬ç”¨æ³•ã€‚

## äº‹ä»¶ç»§æ‰¿æ”¯æŒ
é™¤äº†åŸºæœ¬ç”¨æ³•ï¼ŒTypeEventSystem çš„äº‹ä»¶è¿˜æ”¯æŒç»§æ‰¿å…³ç³»ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹:
```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class TypeEventSystemInheritEventExample : MonoBehaviour
    {
        public interface IEventA
        {
            
        }
        
        public struct EventB : IEventA
        {
            
        }

        private void Start()
        {
            TypeEventSystem.Global.Register<IEventA>(e =>
            {
                Debug.Log(e.GetType().Name);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }

        private void Update()
        {
            if (Input.GetMouseButtonDown(0))
            {
                TypeEventSystem.Global.Send<IEventA>(new EventB());
                
                // æ— æ•ˆ
                TypeEventSystem.Global.Send<EventB>();
            }
        }
    }
}


// è¾“å‡ºç»“æœ:
// å½“æŒ‰ä¸‹é¼ æ ‡å·¦é”®æ—¶ï¼Œè¾“å‡º:
// EventB
```

ä»£ç ä¸éš¾ã€‚

## TypeEventSystem æ‰‹åŠ¨æ³¨é”€

å¦‚æœæƒ³æ§åˆ¶ TypeEventSystem çš„æ³¨é”€ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨æ³¨é”€ä¹Ÿå¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class TypeEventSystemUnRegisterExample : MonoBehaviour
    {

        public struct EventA
        {
            
        }
        
        private void Start()
        {
            TypeEventSystem.Global.Register<EventA>(OnEventA);
        }

        void OnEventA(EventA e)
        {
            
        }

        private void OnDestroy()
        {
            TypeEventSystem.Global.UnRegister<EventA>(OnEventA);
        }
    }
}
```

ä»£ç ä¹Ÿå¾ˆç®€å•ã€‚

## æ¥å£äº‹ä»¶

TypeEventSystem è¿˜æ”¯æŒæ¥å£äº‹ä»¶æ¨¡å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹:

```csharp
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace QFramework.Example
{
    public struct InterfaceEventA
    {
            
    }

    public struct InterfaceEventB
    {
        
    }

    public class InterfaceEventModeExample : MonoBehaviour
        , IOnEvent<InterfaceEventA>
        , IOnEvent<InterfaceEventB>
    {
        public void OnEvent(InterfaceEventA e)
        {
            Debug.Log(e.GetType().Name);
        }
        
        public void OnEvent(InterfaceEventB e)
        {
            Debug.Log(e.GetType().Name);
        }

        private void Start()
        {
            this.RegisterEvent<InterfaceEventA>()
                .UnRegisterWhenGameObjectDestroyed(gameObject);

            this.RegisterEvent<InterfaceEventB>();
        }

        private void OnDestroy()
        {
            this.UnRegisterEvent<InterfaceEventB>();
        }

        private void Update()
        {
            if (Input.GetMouseButtonDown(0))
            {
                TypeEventSystem.Global.Send<InterfaceEventA>();
                TypeEventSystem.Global.Send<InterfaceEventB>();
            }
        }
    }
}

// è¾“å‡ºç»“æœ
// å½“æŒ‰ä¸‹é¼ æ ‡å·¦é”®æ—¶ï¼Œè¾“å‡º:
// InterfaceEventA
// InterfaceEventB
```

ä»£ç å¾ˆç®€å•ã€‚

åŒæ ·æ¥å£äº‹ä»¶ä¹Ÿæ”¯æŒäº‹ä»¶ä¹‹é—´çš„ç»§æ‰¿ã€‚

æ¥å£äº‹ä»¶æ‹¥æœ‰æ›´å¥½çš„çº¦æŸï¼Œåªè¦å®Œæˆå®ç°æ¥å£ï¼Œå°±å¯ä»¥é€šè¿‡ IDE çš„ä»£ç ç”Ÿæˆå°‘å†™å¾ˆå¤šä»£ç ï¼Œå…¶çµæ„Ÿå— CorgiEngineã€TopDownEngine å¯å‘ã€‚

## é MonoBehavior è„šæœ¬å¦‚ä½•è‡ªåŠ¨é”€æ¯

```csharp
public class NoneMonoScript : IUnRegisterList
{
    public List<IUnRegister> UnregisterList { get; } = new List<IUnRegister>();


    void Start()
    {
        TypeEventSystem.Global.Register<EasyEventExample.EventA>(a =>
        {
                    
        }).AddToUnregisterList(this);
    }

    void OnDestroy()
    {
        this.UnRegisterAll();
    }
}
```


## å°ç»“
å¦‚æœæƒ³æ‰‹åŠ¨æ³¨é”€ï¼Œå¿…é¡»è¦åˆ›å»ºä¸€ä¸ªç”¨äºæ¥æ”¶äº‹ä»¶çš„æ–¹æ³•ã€‚

è€Œç”¨è‡ªåŠ¨æ³¨é”€åˆ™ç›´æ¥ç”¨å§”æ‰˜å³å¯ã€‚

è¿™ä¸¤ä¸ªå„æœ‰ä¼˜åŠ£ï¼ŒæŒ‰éœ€ä½¿ç”¨ã€‚

å¦å¤–ï¼Œäº‹ä»¶çš„å®šä¹‰æœ€å¥½ä½¿ç”¨ structï¼Œå› ä¸º struct çš„ gc æ›´å°‘ï¼Œå¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚

æ¥å£äº‹ä»¶æ‹¥æœ‰æ›´å¥½çš„çº¦æŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IDE çš„ä»£ç ç”Ÿæˆæ¥æé«˜å¼€å‘æ•ˆç‡ã€‚

æ€»ä¹‹ TypeEventSystem æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„äº‹ä»¶å·¥å…·ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 16. å†…ç½®å·¥å…·ï¼šEasyEvent

TypeEventSystem æ˜¯åŸºäº EasyEvent å®ç°çš„ã€‚

EasyEvent ä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥è„±ç¦»æ¶æ„ä½¿ç”¨çš„å·¥å…·ã€‚

è¿™é‡Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹åŸºæœ¬ç”¨æ³•ã€‚

## åŸºæœ¬ä½¿ç”¨
ä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class EasyEventExample : MonoBehaviour
    {
        private EasyEvent mOnMouseLeftClickEvent = new EasyEvent();
        
        private EasyEvent<int> mOnValueChanged = new EasyEvent<int>();
        
        public class EventA : EasyEvent<int,int> { }

        private EventA mEventA = new EventA();

        private void Start()
        {
            mOnMouseLeftClickEvent.Register(() =>
            {
                Debug.Log("é¼ æ ‡å·¦é”®ç‚¹å‡»");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            mOnValueChanged.Register(value =>
            {

                Debug.Log($"å€¼å˜æ›´:{value}");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);


            mEventA.Register((a, b) =>
            {
                Debug.Log($"è‡ªå®šä¹‰äº‹ä»¶:{a} {b}");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }

        private void Update()
        {
            if (Input.GetMouseButtonDown(0))
            {
                mOnMouseLeftClickEvent.Trigger();
            }
            
            if (Input.GetMouseButtonDown(1))
            {
                mOnValueChanged.Trigger(10);
            }

            // é¼ æ ‡ä¸­é”®
            if (Input.GetMouseButtonDown(2))
            {
                mEventA.Trigger(1,2);
            }
        }
    }
}

// è¾“å‡ºç»“æœï¼š
// æŒ‰é¼ æ ‡å·¦é”®æ—¶ï¼Œè¾“å‡º:
// é¼ æ ‡å·¦é”®ç‚¹å‡»
// æŒ‰é¼ æ ‡å³é”®æ—¶ï¼Œè¾“å‡º:
// å€¼å˜æ›´:10
// æŒ‰é¼ æ ‡ä¸­é”®æ—¶ï¼Œè¾“å‡º:
// è‡ªå®šä¹‰äº‹ä»¶:1 2
```

åŸºæœ¬ä½¿ç”¨éå¸¸ç®€å•ã€‚

EasyEvent æœ€å¤šæ”¯æŒä¸‰ä¸ªæ³›å‹ã€‚

## EasyEvent çš„ä¼˜åŠ¿
EasyEvent æ˜¯ C# å§”æ‰˜å’Œäº‹ä»¶çš„æ›¿ä»£ã€‚

EasyEvent ç›¸æ¯” C# å§”æ‰˜å’Œäº‹ä»¶ï¼Œä¼˜åŠ¿æ˜¯å¯ä»¥è‡ªåŠ¨æ³¨é”€ã€‚

ç›¸æ¯” TypeEventSystemï¼Œä¼˜åŠ¿æ˜¯æ›´è½»é‡ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸ç”¨å£°æ˜äº‹ä»¶ç±»ï¼Œè€Œä¸”æ€§èƒ½æ›´å¥½ï¼ˆæ¥è¿‘ C# å§”æ‰˜ï¼‰ã€‚

ç¼ºç‚¹åˆ™æ˜¯å…¶æºå¸¦çš„å‚æ•°æ²¡æœ‰åå­—ï¼Œéœ€è¦è‡ªå·±å®šä¹‰åå­—ã€‚

åœ¨è®¾è®¡ä¸€äº›é€šç”¨ç³»ç»Ÿçš„æ—¶å€™ï¼ŒEasyEvent ä¼šæ´¾ä¸Šç”¨åœºï¼Œæ¯”å¦‚èƒŒåŒ…ç³»ç»Ÿã€å¯¹è¯ç³»ç»Ÿï¼ŒTypeEventSystem æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ã€‚

åœ¨ä¸€ä¸ªé¡¹ç›®æ—©æœŸåšåŸå‹éªŒè¯æ—¶ï¼ŒEasyEvent ä¹Ÿä¼šèµ·éå¸¸å¤§çš„ä½œç”¨ï¼ŒQFramework æ¶æ„ä¸­çš„äº‹ä»¶ï¼Œå…¶å®å†™èµ·æ¥æœ‰ç‚¹ç¹çï¼Œè€Œåœ¨é¡¹ç›®æ—©æœŸå¿«é€Ÿè¿­ä»£åŸå‹æ˜¯é‡ç‚¹ï¼Œæ­¤æ—¶ç”¨ EasyEvent å¯ä»¥è·å¾—æ›´å¿«çš„å¼€å‘æ•ˆç‡ï¼Œè€Œä½¿ç”¨ QFramework æ¶æ„ä¸­çš„äº‹ä»¶åœ¨é¡¹ç›®è§„æ¨¡æ›´å¤§çš„æ—¶å€™ä¼šå‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ï¼Œå®ƒæ›´æ–¹ä¾¿åä½œæ›´å®¹æ˜“ç»´æŠ¤ï¼Œä¹Ÿæ›´å®¹æ˜“æ ‡å‡†åŒ–ã€‚

å¥½äº†ï¼Œå…³äº EasyEvent çš„ä»‹ç»å°±åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 17. å†…ç½®å·¥å…·ï¼šBindableProperty

åœ¨æ­¤ç¯‡ä»‹ç» BindablePropertyã€‚

BindableProperty æä¾› æ•°æ® + æ•°æ®å˜æ›´äº‹ä»¶ çš„ä¸€ä¸ªå¯¹è±¡ã€‚

## åŸºæœ¬ä½¿ç”¨

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class BindablePropertyExample : MonoBehaviour
    {
        private BindableProperty<int> mSomeValue = new BindableProperty<int>(0);

        private BindableProperty<string> mName = new BindableProperty<string>("QFramework");
        
        void Start()
        {
            mSomeValue.Register(newValue =>
            {
                Debug.Log(newValue);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            mName.RegisterWithInitValue(newName =>
            {
                Debug.Log(mName);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
        
        void Update()
        {

            if (Input.GetMouseButtonDown(0))
            {
                mSomeValue.Value++;
            }
        }
    }
}


// è¾“å‡ºç»“æœ
// QFramework
// æŒ‰ä¸‹é¼ æ ‡å·¦é”®,è¾“å‡º:
// 1
// æŒ‰ä¸‹é¼ æ ‡å·¦é”®,è¾“å‡º:
// 2
```

éå¸¸ç®€å•ã€‚


å…³äº BindablePropertyï¼Œåœ¨ä¹‹å‰å†™ CounterApp çš„æ—¶å€™æœ‰ä»‹ç»è¿‡ï¼Œæ‰€ä»¥è¿™ç¯‡å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 18. å†…ç½®å·¥å…·ï¼šIOCContainer

QFramework æ¶æ„çš„æ¨¡å—æ³¨å†Œä¸è·å–æ˜¯é€šè¿‡ IOCContainer å®ç°çš„ã€‚

IOC çš„æ„æ€æ˜¯æ§åˆ¶åè½¬ï¼Œå³æ§åˆ¶åè½¬å®¹å™¨ã€‚

å…¶æŠ€æœ¯çš„æœ¬è´¨å¾ˆç®€å•ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒKey æ˜¯ Typeï¼ŒValue æ˜¯ Objectï¼Œå³ï¼šDictionary<Type,object>ã€‚

QFramework æ¶æ„ä¸­çš„ IOCContainer æ˜¯ä¸€ä¸ªéå¸¸ç®€æ˜“ç‰ˆæœ¬çš„æ§åˆ¶ç¿»è½¬å®¹å™¨ï¼Œä»…æ”¯æŒäº†æ³¨å†Œå¯¹è±¡ä¸ºå•ä¾‹çš„æ¨¡å¼ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„æ§åˆ¶åè½¬å®¹å™¨ä¼šæœ‰å„ç§å„æ ·çš„å¯¹è±¡æ³¨å†Œæ¨¡å¼ï¼Œæœ‰çš„ç”šè‡³ä¼šå†…ç½®å¯¹è±¡æ± å’Œå¯¹è±¡å·¥å‚ï¼Œæ¯”å¦‚ Zenjectã€‚

ä¸è¿‡ï¼Œæˆ‘ä»¬å…ˆä¸ç”¨ç†ä¼šé‚£äº›ï¼Œå¦‚æœå…ˆä¸Šæ‰‹ä½¿ç”¨äº†æœ€ç®€æ˜“çš„ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬ä¼šæ›´å®¹æ˜“ä¸Šæ‰‹ã€‚

æˆ‘ä»¬çœ‹ä¸‹ IOCContainer çš„åŸºæœ¬ä½¿ç”¨ã€‚

ä»£ç å¦‚ä¸‹:

```csharp
using System;
using UnityEngine;

namespace QFramework.Example
{
    public class IOCContainerExample : MonoBehaviour
    {
        
        public class SomeService
        {
            public void Say()
            {
                Debug.Log("SomeService Say Hi");
            }
        }
        
        
        public interface INetworkService
        {
            void Connect();
        }
        
        public class NetworkService : INetworkService
        {
            public void Connect()
            {
                Debug.Log("NetworkService Connect Succeed");
            }
        }

        private void Start()
        {
            var container = new IOCContainer();
            
            container.Register(new SomeService());
            
            container.Register<INetworkService>(new NetworkService());
            
            
            container.Get<SomeService>().Say();
            container.Get<INetworkService>().Connect();
        }
    }
}

// è¾“å‡ºç»“æœ:
// SomeService Say Hi
// NetworkService Connect Succeed
```

éå¸¸ç®€å•ã€‚

ä½†æ˜¯å¯¹äºå¾ˆå¤šåˆå­¦è€…ï¼ŒIOCContainer æ„Ÿè§‰ä¸çŸ¥é“æ€ä¹ˆç”¨ï¼Œä¹Ÿæ— æ³•ç†è§£ã€‚

è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„è¯´æ³•ï¼Œä½¿ç”¨ IOCContainer æ›´å®¹æ˜“è®¾è®¡å‡ºç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™çš„æ¨¡å—ã€‚

è€Œ QFramework æ¶æ„çš„ç”¨æ¥å£è®¾è®¡æ¨¡å—çš„æ”¯æŒå°±æ˜¯é€šè¿‡ IOCContainer æ”¯æŒçš„ï¼ŒåŒæ ·ä½¿ç”¨ IOCContainer ä¹Ÿæ›´å®¹æ˜“è®¾è®¡å‡ºåˆ†å±‚çš„æ¶æ„ã€‚

å¥½äº†ï¼Œå…³äº IOCContainer å°±ä»‹ç»åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 19. å¿ƒä¸­æœ‰æ¶æ„

QFramework.cs æä¾›äº† MVCã€åˆ†å±‚ã€CQRSã€äº‹ä»¶é©±åŠ¨ã€æ•°æ®é©±åŠ¨ç­‰å·¥å…·ï¼Œé™¤äº†è¿™äº›å·¥å…·ï¼ŒQFramework.cs è¿˜æä¾›äº†æ¶æ„ä½¿ç”¨è§„èŒƒã€‚

è€Œå½“ä½¿ç”¨ QFramework ç†Ÿç»ƒåˆ°ä¸€å®šçš„ç¨‹åº¦ä¹‹åï¼Œå°±å¯ä»¥è¾¾åˆ°å¿ƒä¸­æœ‰æ¶æ„çš„å¢ƒç•Œã€‚

å¦‚æœè¾¾åˆ°è¿™ä¸ªå¢ƒç•Œï¼Œä½ å°±æ—©å·²ä¸æ˜¯å½“å¹´çš„ä½ äº†ï¼ˆå¼€ç©ç¬‘ï¼‰ã€‚

å¿ƒä¸­æœ‰æ¶æ„çš„å¢ƒç•Œï¼Œå…·ä½“æ˜¯æŒ‡å¯ä»¥ä¸ä¾èµ– QFramework.cs å°±å¯ä»¥å†é¡¹ç›®ä¸­å®è·µ QFramework.cs æ¶æ„ã€‚

å…·ä½“çš„ç¤ºä¾‹å¦‚ä¸‹:

```csharp
using System;
using System.Collections.Generic;
using UnityEngine;

namespace QFramework.Example
{
    public class ArchitectureInHeartExample : MonoBehaviour
    {

        #region Framework

        public interface ICommand
        {
            void Execute();
        }

        public class BindableProperty<T>
        {
            private T mValue = default;

            public T Value
            {
                get => mValue;
                set
                {
                    if (mValue != null && mValue.Equals(value)) return;
                    mValue = value;
                    OnValueChanged?.Invoke(mValue);
                }
            }

            public event Action<T> OnValueChanged = _ => { };
        }

        #endregion


        #region å®šä¹‰ Model

        public static class CounterModel
        {
            public static BindableProperty<int> Counter = new BindableProperty<int>()
            {
                Value = 0
            };
        }
        
        #endregion

        #region å®šä¹‰ Command
        public struct IncreaseCountCommand : ICommand
        {
            public void Execute()
            {
                CounterModel.Counter.Value++;
            }
        }
        
        public struct DecreaseCountCommand : ICommand
        {
            public void Execute()
            {
                CounterModel.Counter.Value--;
            }
        }
        #endregion


        private void OnGUI()
        {
            if (GUILayout.Button("+"))
            {
                new IncreaseCountCommand().Execute();
            }

            GUILayout.Label(CounterModel.Counter.Value.ToString());

            if (GUILayout.Button("-"))
            {
                new DecreaseCountCommand().Execute();
            }
        }
    }
}
```

ä¸Šå›¾æ˜¯ä¸€ä¸ªè®¡æ•°å™¨åº”ç”¨çš„å®ç°ã€‚

åœ¨è¿™ä¸ªå®ç°é‡Œï¼Œæ²¡æœ‰ä½¿ç”¨ QFramework.cs é‡Œçš„ä»»ä½•å†…å®¹ï¼Œä½†æ˜¯ä¹Ÿå†™å‡ºæ¥äº†ç¬¦åˆ QFramework.cs æ¶æ„è§„èŒƒçš„è®¡æ•°å™¨åº”ç”¨å®ç°ã€‚

å½“å¤§å®¶ä½¿ç”¨ QFramework.cs åˆ°ä¸€å®šç¨‹åº¦ä¹‹åï¼Œåœ¨æœªæ¥ä¸ä½¿ç”¨ QFramework.cs ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ QFramework.cs æ¶æ„è§„èŒƒæ¥å†™é¡¹ç›®ï¼Œè€Œåˆ°æ­¤æ—¶ï¼Œå¯¹äºå¤§å®¶æ¥è¯´æœ‰æ²¡æœ‰  QFramework.cs å°±æ— æ‰€è°“äº†ï¼Œå› ä¸º QFramework.cs çš„æ¶æ„è§„èŒƒå·²ç»åˆ»åœ¨å¤§å®¶çš„éª¨å­é‡Œäº†ã€‚



å½“å¤§å®¶ç†Ÿç»ƒä½¿ç”¨ QFramework.cs ä¹‹åï¼Œæœ‰ä¸€å¤©å¦‚æœå¤§å®¶å»ç ”ç©¶ ç½‘é¡µå‰ç«¯ã€æœåŠ¡å™¨ã€App å¼€å‘ï¼Œä¼šå‘ç°å®ƒä»¬çš„å¾ˆå¤šæ¡†æ¶ä¸ QFramework.cs æ¶æ„æœ‰å…±é€šä¹‹å¤„ï¼Œç”šè‡³è¯´ï¼Œé€šè¿‡ QFramework.cs ä¸­ç§¯ç´¯çš„å¼€å‘ç»éªŒå¯ä»¥ç›´æ¥ç…§æ¬åˆ°å…¶ä»–é¢†åŸŸçš„å¼€å‘ä¸­ã€‚

è¿™æ˜¯å› ä¸º QFramework.cs æœ€åˆçš„è®¾è®¡ç›®çš„ï¼Œå°±æ˜¯ä¸ºäº†ç³…åˆå’Œç®€åŒ–å¤§é‡å…¶ä»–é¢†åŸŸçš„æ¶æ„æ¦‚å¿µï¼Œæ¯”å¦‚ React ä¸­çš„ Reduxï¼ˆFluxï¼‰ã€.Net Core å¼€å‘ä¸­çš„é¢†åŸŸé©±åŠ¨è®¾è®¡ã€CQRSã€ä»“å‚¨æ¨¡å¼ç­‰ã€App å¼€å‘ä¸­çš„ MVCã€MVPã€MVVM ç­‰ã€‚

æˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹è¿™äº›å›¾ï¼Œå¤§å®¶å°±æ¸…æ¥šäº†ã€‚

é¦–å…ˆæ˜¯å‰ç«¯ React ä¸­çš„ Redux çš„å·¥ä½œæµç¨‹ï¼Œå¦‚ä¸‹ï¼š
![bg2016091802.jpg](https://file.liangxiegame.com/8b854e1e-4772-4a79-b595-c0ded004a569.png)




å…¶ä¸­ React Components å¯¹åº”çš„æ˜¯ QFramework.cs  ä¸­çš„ Controllerã€‚

Action + Reducers å¯¹åº”çš„æ˜¯ QFramework.cs ä¸­çš„ Command

Store å¯¹åº”çš„æ˜¯ QFramework.cs ä¸­çš„ Modelã€‚


æ¥ç€æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼š

![image.png](https://file.liangxiegame.com/f966558b-c616-46cd-9eee-4ba56de64b2c.png)


å…¶ä¸­ Interface å¯¹åº”çš„æ˜¯ IControllerã€‚

Application å¯¹åº”çš„æ˜¯ ISystemã€‚

Domain å¯¹åº”çš„æ˜¯ Modelã€‚

Infrustracture å¯¹åº”çš„æ˜¯ Utility + ä¸€éƒ¨åˆ† Modelã€‚


æ¥ç€çœ‹ä¸‹ CQRSï¼ŒCQRS ä¸€èˆ¬æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡åŒ…å«çš„æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![v2-da8a89f95e09bb518ad8c770b1413e5e_720w.jpg](https://file.liangxiegame.com/5f45fb20-537e-4574-80ac-c8d6a2d7921e.png)



å…¶ä¸­ User Interface å¯¹åº”çš„æ˜¯ IControllerã€‚

Command å’Œ Query å¯¹åº”çš„æ˜¯ Command å’Œ Queryã€‚

Domain Model å’Œ Data å¯¹åº”çš„æ˜¯ Model

Event å¯¹åº”çš„æ˜¯ Eventã€‚

éå¸¸æ¥è¿‘ã€‚

æ¥ç€çœ‹ä¸‹ä»“å‚¨æ¨¡å¼:

![20150922190750314.png](https://file.liangxiegame.com/5bf7ddeb-702d-4e05-aa4a-b3751a7547eb.png)


ä»“å‚¨æ¨¡å¼æ²¡æœ‰å…·ä½“çš„å›¾ï¼Œè€Œæ­¤å›¾æ˜¯ä»ç½‘ä¸Šéšä¾¿æ‰¾çš„ï¼Œå¾ˆæ¸…æ™°åœ°è¡¨è¾¾å‡ºäº†ä»“å‚¨æ¨¡å¼çš„ç»“æ„ã€‚

å…¶ä¸­ IRepository å¯¹åº”çš„æ˜¯ IModelã€‚

Repository å¯¹åº”çš„æ˜¯ AbstractModelã€‚

IBookRepository å¯¹åº”çš„æ˜¯ ICounterModelã€‚

BookRespository å¯¹åº”çš„æ˜¯ CounterModelã€‚

ä½¿ç”¨ ICounterModel å’Œ CounterModel ä¸¾ä¾‹ä¸æ˜¯å¾ˆåˆé€‚ï¼Œå› ä¸º CounterModel åªæœ‰ä¸€ä¸ª Counter æ•°æ®ã€‚

æ›´é€‚åˆçš„ä¸¾ä¾‹æ˜¯ IStudentModelï¼ŒStudentModel ï¼Œå› ä¸º StudentModel ä¼šç»´æŠ¤ä¸€ä¸ª Student çš„ Listã€‚

ä»“å‚¨æ¨¡å¼çš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥è®©ä¸Šå±‚ï¼ˆSystemã€Controllerï¼‰ä¸“æ³¨äºæ•°æ®çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å¢åˆ æ”¹æŸ¥å®ç°ï¼Œå› ä¸ºåœ¨æœåŠ¡å™¨ç«¯ï¼Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼Œæ•°æ®åº“æœ‰å¾ˆå¤šç±»å‹ï¼Œæ¯”å¦‚ MySQLã€MongoDB ç­‰ï¼Œè€Œåœ¨æœåŠ¡å™¨ç«¯å¼€å‘æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½åœ¨å¼€å‘é˜¶æ®µç”¨ SQLite æˆ–è€… MongoDBï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒç”¨çš„æ˜¯ MySQLã€PostgreSQLï¼Œæ‰€ä»¥åœ¨é™æ€ç±»å‹è¯­è¨€ä¸­ï¼Œä»“å‚¨æ¨¡å¼ä¼šå’Œ ORM ä¸€èµ·é…åˆï¼Œè®©å¼€å‘è€…ä¸“æ³¨åœ¨æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œæ•°æ®ä¹‹é—´çš„å…³è”ä¸Šï¼Œè€Œä¸æ˜¯å…·ä½“çš„æŸ¥è¯¢è¯­å¥ï¼Œè¿™æ ·èƒ½æé«˜å¼€å‘æ•ˆç‡ã€‚


æœ€åï¼ŒMVCã€MVPã€MVVM è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå…¶ä¸­ MVP å’Œ MVVM çš„å®ç°ä¼šç”¨ BindablePropertyï¼Œæœ‰çš„ä¼šç”¨åå°„çš„å½¢å¼å®ç°ã€‚

è€Œ QFramework.cs ä¸­çš„ BindableProperty å’Œ MVC åˆ†å±‚ï¼Œåˆ™æ˜¯æ¥è‡ªè¿™äº›æ¶æ„ä¸­ã€‚

å¥½äº†ï¼Œæ­¤ç¯‡çš„å†…å®¹å°±è¯´å®Œäº†ã€‚

å¤§å®¶å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆ QFramework.cs è¦ç³…åˆè¿™äº›æ¶æ„æ¦‚å¿µï¼Ÿ

å› ä¸ºåœ¨ 2019 å¹´å·¦å³ï¼Œç¬”è€…åˆšå¥½åœ¨ä¸šä½™æ—¶é—´ç ”ç©¶äº†ä¸€å¹´ React å¼€å‘ï¼Œç”¨ React å‰ç«¯å¼€å‘åšäº†ä¸€äº› SideProjectï¼ŒæœåŠ¡å™¨åˆ™æ˜¯ç”¨çš„ .Net Coreï¼Œå†åŠ ä¸Šä¹‹å‰ç¬”è€…ä¹Ÿæœ‰åš iOSã€Android ç­‰å¼€å‘ç»éªŒã€‚è€Œåœ¨å½“æ—¶ï¼Œç¬”è€…çªç„¶å‘ç°è¿™äº›é¢†åŸŸçš„æ¶æ„æ¦‚å¿µå¾ˆå¤šéƒ½æ˜¯ç›¸é€šçš„ï¼Œå¯èƒ½åœ¨è¿™ä¸ªé¢†åŸŸå«è¿™ä¸ªï¼Œåœ¨å¦ä¸€ä¸ªé¢†åŸŸåªæ˜¯æ¢äº†ä¸€ä¸ªåå­—è€Œå·²ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†å¯ä¸å¯ä»¥æŠŠè¿™äº›æ¶æ„æ¦‚å¿µéƒ½ç³…åˆåœ¨ä¸€èµ·ï¼Œç„¶åå»æ‰ç¹ççš„ä¿ç•™æœ‰ç”¨çš„éƒ¨åˆ†ï¼Œäºæ˜¯å°±å¼€å§‹äº† QFramework.cs çš„è®¾è®¡ã€‚

æ‚ç³…å’Œç®€åŒ–è¿™äº›æ¦‚å¿µçš„  QFramework.cs æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ

é¦–å…ˆ QFramework.cs æ˜¯éå¸¸å®¹æ˜“ä¸Šæ‰‹çš„æ¶æ„ï¼Œå› ä¸ºå…¶ä¸­çš„ MVC ä¸‰å±‚æ¦‚å¿µè®©å¤§å®¶ä¼šè§‰å¾—éå¸¸äº²åˆ‡ï¼Œæ‰€ä»¥ä¸Šæ‰‹æˆæœ¬å¹¶ä¸æ˜¯å¾ˆé«˜ã€‚

å…¶æ¬¡ QFramework.cs æ˜¯ä¸€ä¸ªèƒ½æé«˜å¤§å®¶æŠ€æœ¯æ°´å¹³çš„æ¶æ„ï¼Œåœ¨æ¶æ„æ–¹é¢ï¼Œå¤©èŠ±æ¿æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡çš„å®ç°ï¼Œæ˜¯æ¶æ„å¸ˆå¿…ç ”ç©¶çš„å†…å®¹ï¼Œå¦‚æœ QFramework.cs ç”¨ç†Ÿæ‚‰äº†ï¼Œå†å»ç ”ç©¶é¢†åŸŸé©±åŠ¨è®¾è®¡ä¼šå®¹æ˜“å¾—å¤šï¼Œè€Œé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸ç®¡åœ¨é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨ï¼Œåªè¦å»ç ”ç©¶å°±ä¼šå¯¹æ¶æ„æ°´å¹³æœ‰å¾ˆå¤§çš„æå‡ï¼Œè€Œ QFramework.cs ç®—æ˜¯ç®€åŒ–ç‰ˆæœ¬çš„é¢†åŸŸé©±åŠ¨è®¾è®¡çš„å®ç°ã€‚

ç„¶å QFramework.cs å¯ä»¥ç”¨æ¥åšç³»ç»Ÿè®¾è®¡ã€å¯ä»¥åšæ¸¸æˆã€åšé¡¹ç›®ã€åšæ’ä»¶éƒ½æ˜¯å¾ˆé€‚åˆçš„ï¼Œå› ä¸ºç¬”è€…è‡ªå·±çš„å¾ˆå¤šé¡¹ç›®ã€æ’ä»¶ã€æœåŠ¡å™¨éƒ½æ˜¯ç”¨ QFramework.cs æ¶æ„æ¥åšçš„ã€‚

æœ€å QFramework.cs æœ¬èº«æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œæ˜“ä¸Šæ‰‹ã€ç®€å•ã€ä»£ç ç²¾ç®€ã€å¯ç»´æŠ¤æ€§å¼ºã€å¼€å‘æ•ˆç‡é«˜ã€å¯å®šåˆ¶æ€§å¼ºã€æ‰©å±•æ€§å¼ºï¼Œå› ä¸º QFramework.cs å¸å–äº†å¤§é‡å…¶ä»–é¢†åŸŸæ¶æ„çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶ä¹Ÿç»å†è¿‡å¤§é‡é¡¹ç›®çš„æ‰“ç£¨è€Œæˆï¼Œæ€»ä½“çš„ä»£ç ç²¾ç®€åˆ°äº† 900 è¡Œå·¦å³ã€‚


å¦‚æœå¤§å®¶æƒ³åœ¨æ›´è¿›ä¸€æ­¥å¼ºåŒ–è¿™äº›æ¦‚å¿µï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å°è¯•å»å­¦ä¹ å…¶ä»–é¢†åŸŸçš„æ¶æ„ï¼Œæ¯”å¦‚:
* React ä¸  RedUå‹
* Java/.Net Core ä¸ DDD å®ç°ï¼ŒCQRSã€ä»“å‚¨æ¨¡å¼
* App å¼€å‘ä¸­çš„ MVCã€MVPã€MVVM

å¥½äº†ï¼Œè¿™ç¯‡å†…å®¹å°±è¯´åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)










# 20. QFramework.cs çš„æ›´å¤šå†…å®¹

ç»ˆäºæŠŠæƒ³ä»‹ç»çš„å†…å®¹éƒ½è®²å®Œäº†ã€‚

å¦‚æœæƒ³è¿›ä¸€æ­¥äº†è§£å’Œå­¦ä¹  QFramework.cs å¯ä»¥çœ‹å¦‚ä¸‹å†…å®¹ã€‚

## ä½¿ç”¨ QFramework.cs çš„æ¡ˆä¾‹ä¸é¡¹ç›®

æ›´å¤šçš„æ¡ˆä¾‹å¯ä»¥åˆ° QFramework github ä¸»é¡µæŸ¥çœ‹ã€‚

åœ°å€:
* github: https://github.com/liangxiegame/QFramework
* gitee: https://gitee.com/liangxiegame/QFramework

å›½å†…ç«¥é‹å»ºè®®æ‰“å¼€ gitee ç‰ˆæœ¬ä»“åº“ã€‚

åœ¨ Readme ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹:

![image.png](https://file.liangxiegame.com/26d4141d-b622-4fed-8dd3-f87979ae5c25.png)

åœ¨è¿™é‡Œå¯ä»¥å®‰è£… QFramework.cs ä¸å®˜æ–¹ç¤ºä¾‹ã€‚

ç‚¹å‡»ä¹‹åï¼Œå†ç‚¹å‡»ä¸‹å›¾ä¸­çš„ä¸‹è½½æŒ‰é’®ã€‚

![image.png](https://file.liangxiegame.com/78c1b225-4cfb-4f0c-ab98-33049e2068f2.png)
å°±å¯ä»¥ä¸‹è½½ QFramework.cs å®˜æ–¹ç¤ºä¾‹äº†ã€‚


ç¤ºä¾‹ä¸­ï¼Œé™¤äº†æœ¬æ•™ç¨‹åŒ…å«çš„ CounterAppï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç¤ºä¾‹ï¼Œå¦‚ä¸‹:

### å°æ¸¸æˆã€Šç‚¹ç‚¹ç‚¹ã€‹

![b5966b31-f004-4b5f-a38d-25753fb2eb8f.gif](https://file.liangxiegame.com/5a10aa95-4c93-4dae-acec-667a113c30ca.gif)

### å°æ¸¸æˆã€ŠFlappyBirdã€‹

![430b7f31-508d-4569-aa51-b75d5553b8c4.gif](https://file.liangxiegame.com/9845122b-93d9-4106-a027-2d7c129a096a.gif)

ä½œè€…ï¼šç‹äºŒ soso https://github.com/so-sos-so

### å°æ¸¸æˆã€ŠCube Masterã€‹

![b1334ef2-f6d4-4a9c-a5c4-b6cd6508595c.gif](https://file.liangxiegame.com/f51abab0-9dc9-478b-b1f1-67f2cd588477.gif)
ä½œè€…ï¼šç‹äºŒ soso https://github.com/so-sos-so

### ç®€æ˜“å…³å¡ç¼–è¾‘å™¨2D
![c57c20cf-5ee6-4346-8be8-8ad1ea2d63b9.gif](https://file.liangxiegame.com/6492498b-6c22-478d-8785-9f43453c34db.gif)

![ea2cb545-4b5b-4d02-b494-dde4afa4e190.gif](https://file.liangxiegame.com/34b775c6-6a49-4141-9b9a-1377a6c15673.gif)


### å°æ¸¸æˆã€Šè´ªåƒè›‡ã€‹

![fb907355-c06c-4bde-8ca3-5638ba9b3ef7.gif](https://file.liangxiegame.com/ac70d14e-ea89-445d-899e-06f18f11f8d1.gif)

ä½œè€…ï¼šä¸€åªçš®çš®è™¾ https://gitee.com/PantyNeko/

ä»¥ä¸Šçš„ç¤ºä¾‹éƒ½æ˜¯ç”± QFramework.cs åˆ¶ä½œè€Œæˆçš„å®˜æ–¹ç¤ºä¾‹ã€‚


å¦å¤–è¿˜æœ‰ç¾¤å‹åˆ¶ä½œçš„å¼€æºæ¸¸æˆ

### CrazyCar

Unityåˆ¶ä½œçš„è”æœºèµ›è½¦æ¸¸æˆï¼Œåå°ä¸ºSpringBoot + Mybatisï¼›æ¸¸æˆé‡‡ç”¨QFrameworkæ¡†æ¶ï¼Œæ”¯æŒKCPå’ŒWebSocketç½‘ç»œ(å•†ç”¨çº§)


![Login.jpg](https://file.liangxiegame.com/0ab6cb1d-2374-4aa2-b27d-f04eb72792cd.png)

![Setting.png](https://file.liangxiegame.com/a113dcba-9ba8-4a40-b000-be3b61719ecc.png)

![Homepage.png](https://file.liangxiegame.com/9075c10d-6d21-411c-b1a4-7f92a08f9bfa.png)

![Avatar.png](https://file.liangxiegame.com/32b48b5b-cdcc-433e-b1b2-4b1333211a70.png) ![Profile.png](https://file.liangxiegame.com/bda476e4-0ede-4fd9-a5bb-e993bce8a786.png)


![Equip.png](https://file.liangxiegame.com/158b0ce0-6e67-47c5-81b5-cee6388dd99c.png)

![Rank.png](https://file.liangxiegame.com/2bd0ef1f-d639-48e8-8c48-320995d20de4.png)

![TimeTrial.png](https://file.liangxiegame.com/aa337718-b868-41d2-bc6b-2ef51c157481.png)
![Match.png](https://file.liangxiegame.com/06157781-3271-438c-bf3f-613e6ec00fb0.png)

ä½œè€…: TastSone  https://github.com/TastSong

é¡¹ç›®åœ°å€: https://github.com/TastSong/CrazyCar


## QFramework.cs çš„æ¶æ„å¦‚ä½•æ¼”åŒ–å‡ºæ¥çš„?

QFramework.cs çš„æ¶æ„å½“å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯ä» ã€Šæ¡†æ¶æ­å»º å†³å®šç‰ˆã€‹ä¸­è®¾è®¡å‡ºæ¥çš„ï¼Œå¦‚æœå­¦ä¹ è¿™é—¨è¯¾ç¨‹ï¼Œå¯ä»¥å¯¹ QFramework.cs çš„åŸç†å’Œç†å¿µç†è§£å¾—æ›´æ·±åˆ»ï¼Œæ›´å®¹æ˜“å¯¹ QFramework.cs åšä¿®æ”¹å’Œå®šåˆ¶ã€‚

* ã€Šæ¡†æ¶æ­å»º å†³å®šç‰ˆã€‹B ç«™è¯•å¬ï¼šhttps://www.bilibili.com/video/BV1wh411U7X6
* ã€Šæ¡†æ¶æ­å»º å†³å®šç‰ˆã€‹å®Œæ•´ç‰ˆ
  *  Unity å®˜æ–¹ä¸­æ–‡è¯¾å ‚ï¼šhttps://learn.u3d.cn/tutorial/framework_design
  *  siki å­¦é™¢ï¼šhttps://www.sikiedu.com/my/course/871
  *  GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ï¼šhttps://www.gamepixedu.com/my/course/2


å¦å¤– QFramework.Toolkits å’Œ QFramework.ToolkitsPro é‡ŒåŒ…å«çš„å·¥å…·å¾ˆå¤šéƒ½æ˜¯ç”± QFramework.cs è®¾è®¡çš„ï¼Œ å·¥å…·çš„æºç æœ¬èº«ä¹Ÿæ˜¯ä¸é”™çš„å­¦ä¹ èµ„æ–™ã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 3. å·¥å…·ç¯‡ï¼šQFramework.Toolkits
# 01. QFramework.Toolkits ç®€ä»‹

QFramework.Toolkits æ˜¯åŒ…å« QFramework.cs å’Œ å¤§é‡å·¥å…·é›†çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨ QFramework v1.0 ä¹‹å‰ï¼ŒQFramework.Toolkits å°±æ˜¯ QFramework æœ¬èº«ï¼Œè€Œåœ¨ QFramework v1.0 å¼€å§‹ï¼ŒQFramework æ‹¥æœ‰äº†è‡ªå·±çš„å¼€å‘æ¶æ„â€”QFramework.csï¼Œäºæ˜¯åŸæ¥çš„ QFramework å°±å˜æˆäº† QFramework.Toolkitsã€‚

QFramework.Toolkits ç§°ä¸º QFramework å·¥å…·é›†ï¼Œæ˜¯ä¸€å¥—**å¼€ç®±å³ç”¨çš„ã€æ¸è¿›å¼**çš„**å¿«é€Ÿå¼€å‘**æ¡†æ¶ã€‚

ç›®æ ‡æ˜¯ä½œä¸ºæ— æ¡†æ¶ç»éªŒçš„å…¬å¸ã€ç‹¬ç«‹å¼€å‘è€…ã€ä»¥åŠ Unity3D åˆå­¦è€…ä»¬çš„**ç¬¬ä¸€å¥—æ¡†æ¶**ã€‚æ¡†æ¶å†…éƒ¨ç§¯ç´¯äº†å¤šä¸ªé¡¹ç›®åœ¨å„ä¸ªæŠ€æœ¯æ–¹å‘çš„è§£å†³æ–¹æ¡ˆã€‚å­¦ä¹ æˆæœ¬ä½ï¼Œæ¥å…¥æˆæœ¬ä½ï¼ˆä¾µå…¥æ€§ä½ï¼‰ï¼Œé‡æ„æˆæœ¬ä½ï¼ŒäºŒæ¬¡å¼€å‘æˆæœ¬ä½ã€‚æ–‡æ¡£å†…å®¹ä¸°å¯Œã€‚

QFramework å·¥å…·é›†çš„è®¾è®¡å“²å­¦æ˜¯è¿½æ±‚æè‡´çš„å¼€å‘æ•ˆç‡å’Œå¼€å‘ä½“éªŒã€‚

**QFramework.Toolkits ç‰¹æ€§ä¸€è§ˆ**

* å·¥å…·é›†ï¼ˆQFramework.Toolkits v0.16ï¼‰
    * UIKit ç•Œé¢&Viewå¿«é€Ÿå¼€å‘&ç®¡ç†è§£å†³æ–¹æ¡ˆ
        * UIã€GameObject çš„ä»£ç ç”Ÿæˆ&è‡ªåŠ¨èµ‹å€¼
        * ç•Œé¢ç®¡ç†
        * å±‚çº§ç®¡ç†
        * ç•Œé¢å †æ ˆ
        * é»˜è®¤ä½¿ç”¨ ResKit æ–¹å¼ç®¡ç†ç•Œé¢èµ„æº
        * å¯è‡ªå®šä¹‰ç•Œé¢çš„åŠ è½½ã€å¸è½½æ–¹å¼
        * Manager Of Manager æ¶æ„é›†æˆï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
    * ResKit èµ„æºå¿«é€Ÿå¼€å‘&ç®¡ç†è§£å†³æ–¹æ¡ˆ
        * AssetBundle æä¾›æ¨¡æ‹Ÿæ¨¡å¼ï¼Œå¼€å‘é˜¶æ®µæ— éœ€æ‰“åŒ…å³å¯åŠ è½½èµ„æº
        * èµ„æºåç§°ä»£ç ç”Ÿæˆæ”¯æŒ
        * åŒä¸€ä¸ª API å¯åŠ è½½ AssetBundleã€Resourcesã€ç½‘ç»œ å’Œ è‡ªå®šä¹‰æ¥æºçš„èµ„æº
        * æä¾›ä¸€å¥—å¼•ç”¨è®¡æ•°çš„èµ„æºç®¡ç†æ¨¡å‹
    * AudioKit éŸ³é¢‘ç®¡ç†è§£å†³æ–¹æ¡ˆ
        * æä¾›èƒŒæ™¯éŸ³ä¹ã€äººå£°ã€éŸ³æ•ˆ ä¸‰ç§éŸ³é¢‘æ’­æ”¾ API
        * éŸ³é‡æ§åˆ¶
        * é»˜è®¤ä½¿ç”¨ ResKit æ–¹å¼ç®¡ç†éŸ³é¢‘èµ„æº
        * å¯è‡ªå®šä¹‰éŸ³é¢‘çš„åŠ è½½ã€å¸è½½æ–¹å¼
    * CoreKit æä¾›å¤§é‡çš„ä»£ç å·¥å…·
        * ActionKitï¼šåŠ¨ä½œåºåˆ—æ‰§è¡Œç³»ç»Ÿ
        * CodeGenKitï¼šä»£ç ç”Ÿæˆ & è‡ªåŠ¨åºåˆ—åŒ–èµ‹å€¼å·¥å…·
        * EventKitï¼šæä¾›åŸºäºç±»ã€å­—ç¬¦ä¸²ã€æšä¸¾ä»¥åŠä¿¡å·ç±»å‹çš„äº‹ä»¶å·¥å…·é›†
        * FluentAPIï¼šå¯¹å¤§é‡çš„ Unity å’Œ C# å¸¸ç”¨çš„ API æä¾›äº†é™æ€æ‰©å±•çš„å°è£…ï¼ˆé“¾å¼ APIï¼‰
        * IOCKitï¼šæä¾›ä¾èµ–æ³¨å…¥å®¹å™¨
        * LocaleKitï¼šæœ¬åœ°åŒ–&å¤šè¯­è¨€å·¥å…·é›†
        * LogKitï¼šæ—¥å¿—å·¥å…·é›†
        * PackageKitï¼šåŒ…ç®¡ç†å·¥å…·ï¼Œç”±æ­¤å¯æ›´æ–°æ¡†æ¶å’Œå¯¹åº”çš„æ’ä»¶æ¨¡å—ã€‚
        * PoolKitï¼šå¯¹è±¡æ± å·¥å…·é›†ï¼Œæä¾›å¯¹è±¡æ± çš„åŸºç¡€ä¸Šï¼Œä¹Ÿæä¾› ListPool å’Œ Dictionary Pool ç­‰å·¥å…·ã€‚
        * SingletonKitï¼šå•ä¾‹å·¥å…·é›†
        * TableKitï¼šæä¾›è¡¨æ ¼ç±»æ•°æ®ç»“æ„çš„å·¥å…·é›†


**å…¸å‹çš„ QFrameowrk.Toolkits ä»£ç **

```csharp
using QFramework;
using UnityEngine;
using UnityEngine.UI;

namespace liangxiegame
{
    public partial class UIGamePanel : UIPanel
    {
        private ResLoader mResLoader;
        
        protected override void OnInit(IUIData uiData = null)
        {
            mResLoader = ResLoader.Allocate();
            
            mResLoader.LoadSync<GameObject>("GameplayRoot")
                .Instantiate()
                .Identity()
                .GetComponent<GameplayRoot>()
                .InitGameplayRoot();
            
            
            BtnPause.onClick.AddListener(() =>
            {
                AudioKit.PlaySound("btn_click");
                
                ActionKit.Sequence()
                    .Callback(() => BtnPause.interactable = false)
                    .Callback(() => BtnPause.PlayBtnFadeAnimation())
                    .Delay(0.3f)
                    .Callback(() => UIKit.OpenPanel<UIPausePanel>())
                    .Start(this);
            });
        }

        protected override void OnClose()
        {
            mResLoader.Recycle2Cache();
            mResLoader = null;
        }
    }
}
```

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 02. ä¸‹è½½ä¸å®‰è£…


## å¦‚ä½•ä¸‹è½½&å®‰è£…
QFramework.Toolkits çš„æœ€æ–° unitypackage å­˜æ”¾åœ¨  git ä»“åº“é‡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![image.png](https://file.liangxiegame.com/e5ff0b03-e593-4720-b077-1b0af817cdf0.png)

git ä»“åº“åœ°å€:
* githubï¼š https://github.com/liangxiegame/QFramework
* giteeï¼ˆå›½å†…é•œåƒï¼‰ï¼š https://gitee.com/liangxiegame/QFramework

ç‚¹å‡»åŒ…æ–‡ä»¶åï¼Œå†ç‚¹å‡»ä¸‹è½½æŒ‰é’®ã€‚

![image.png](https://file.liangxiegame.com/4cfddfa3-a27a-4454-9cd9-8ebeef6ae8cc.png)

ä¸‹è½½å®Œæˆåå¯¼å…¥åˆ° Unity å·¥ç¨‹å³å¯ã€‚

## å¦‚ä½•æ›´æ–°

å½“æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼Œåœ¨ QFramework çš„ç¼–è¾‘å™¨é¢æ¿å†…å°±å¯ä»¥å‡çº§ï¼Œæ‰“å¼€æ–¹å¼ ctrl + e æˆ– ctrl + shift + eï¼Œæ‰“å¼€åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/af6ae4cb-312b-413b-a92e-a57c27820a60.png)

å½“æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼Œå›¾ä¸­çš„æŒ‰é’®ä¼šæ˜¾ç¤ºä¸º"æ›´æ–°"ï¼Œç‚¹å‡»å°±å¯ä»¥ä¸€é”®æ›´æ–°ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)

# 03. CodeGenKit è„šæœ¬ç”Ÿæˆ

åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬å­¦ä¹ å‡ ä¹æ¯ä¸ªé¡¹ç›®éƒ½è¦ç”¨åˆ°å¹¶ä¸”ä»ä¸­å—ç›Šçš„åŠŸèƒ½ï¼šè‡ªåŠ¨ç”Ÿæˆè„šæœ¬å¹¶ç»‘å®šï¼Œç®€ç§°è„šæœ¬ç”Ÿæˆã€‚

## åŸºæœ¬ä½¿ç”¨

æˆ‘ä»¬å…ˆåœ¨åœºæ™¯ä¸­ï¼Œéšä¾¿åˆ›å»ºä¸€äº›æœ‰çˆ¶å­ç»“æ„çš„ GameObjectï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/ed37997b-614b-4fb1-baa8-c23d7748c67d.png)

æ¥ç€ç»™ Player æŒ‚ä¸Š ViewControllerï¼Œå¿«æ·é”® ï¼ˆAlt + Vï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/cfb5f767-120f-4e0f-a69b-bdef1b6e9c98.png)


ç„¶åå¡«å†™ åˆšåˆšæ·»åŠ çš„ç»„ä»¶ä¿¡æ¯:

![image.png](https://file.liangxiegame.com/a2bc2a07-02bf-46e3-ad65-36309c290bce.png)


åœ¨è¿™é‡Œï¼Œå¯ä»¥å¡«å†™å‘½åç©ºé—´ï¼Œè¦ç”Ÿæˆçš„è„šæœ¬åï¼Œä»¥åŠè„šæœ¬ç”Ÿæˆçš„ç›®å½•ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥å°†è¦ç”Ÿæˆçš„ç›®å½•æ‹–åˆ°å¤§æ–¹å—ä¸­ã€‚

å¦‚æœæ‹–æ‹½äº†ç›®å½•ï¼Œå°±ä¼šè‡ªåŠ¨å¡«å†™è„šæœ¬ç”Ÿæˆç›®å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/41f2abac-2fcf-4c03-8ba0-ab45f71859f3.png)

ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ Player GameObject ä¸€ä¸ªå­èŠ‚ç‚¹æŒ‚ä¸Š Bind ç»„ä»¶ï¼ˆå¿«æ·é”®ï¼Œalt + b)ï¼Œå¦‚ä¸‹æ‰€ç¤º

![image.png](https://file.liangxiegame.com/e818f0e5-6bfc-436b-8f61-20fb90da4bd6.png)



Weapon æŒ‚ä¸Šçš„ç»„ä»¶å¦‚ä¸‹æ‰€ç¤º:
![image.png](https://file.liangxiegame.com/04e7c9a4-0bc6-4257-9793-41531c3faa64.png)


æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å›¾ä¸­çš„ ç”Ÿæˆä»£ç æŒ‰é’® æˆ–è€…æ˜¯ Player ä¸Š ViewController çš„ ç”Ÿæˆä»£ç æŒ‰é’®ï¼Œä¸¤è€…ç‚¹å‡»å“ªä¸ªéƒ½å¯ä»¥ã€‚

ç‚¹å‡»ä¹‹åï¼Œå°±ä¼šç”Ÿæˆä»£ç ï¼Œç­‰å¾…ç¼–è¯‘ï¼Œç»“æœå¦‚ä¸‹:

è„šæœ¬ç›®å½•:
![image.png](https://file.liangxiegame.com/d3fc5522-6655-4318-8bec-7f4721753110.png)

æˆ‘ä»¬åœ¨çœ‹ä¸‹åœºæ™¯ä¸­çš„ Player çš„ Inspector å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/07c51906-6c1d-49be-bb9b-faef8ce999ae.png)


æˆ‘ä»¬çœ‹åˆ°ï¼ŒPlayer è‡ªåŠ¨è·å¾—äº† Weapon çš„å¼•ç”¨ã€‚

è€Œä¸”ï¼Œåœ¨ Player.cs ä¸­å¯ä»¥ç›´æ¥è®¿é—®åˆ° Weaponï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![image.png](https://file.liangxiegame.com/3a9f0ac1-c05c-4cdf-b442-c33fadb6897a.png)

## å¢é‡ç”Ÿæˆ
æˆ‘ä»¬å†çœ‹ä¸‹ç›®å½•ï¼š

![image.png](https://file.liangxiegame.com/47398560-791c-4e41-8586-6b76347f2758.png)

è¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ Player å’Œ Player.Designerã€‚

å…¶ä¸­ Player æ˜¯ç”¨æ¥ç»™å¤§å®¶å†™é€»è¾‘ç”¨çš„ï¼Œæ‰€ä»¥ Player åªä¼šç”Ÿæˆä¸€æ¬¡ã€‚

è€Œ Player.Designer æ¯æ¬¡ç‚¹å‡»ç”Ÿæˆä»£ç éƒ½ä¼šé‡æ–°ç”Ÿæˆã€‚

æˆ‘ä»¬çœ‹ä¸‹ Player.Designer çš„ä»£ç ï¼Œå¦‚ä¸‹:

```csharp
// Generate Id:471bf5e6-b60b-42b8-b5c8-b070a963ab4a
using UnityEngine;

// 1.è¯·åœ¨èœå• ç¼–è¾‘å™¨æ‰©å±•/Namespace Settings é‡Œè®¾ç½®å‘½åç©ºé—´
// 2.å‘½åç©ºé—´æ›´æ”¹åï¼Œç”Ÿæˆä»£ç ä¹‹åï¼Œéœ€è¦æŠŠé€»è¾‘ä»£ç æ–‡ä»¶ï¼ˆé Designerï¼‰çš„å‘½åç©ºé—´æ‰‹åŠ¨æ›´æ”¹
namespace QFramework.Example
{
	public partial class Player
	{

		public Transform Weapon;

	}
}
```

ä»£ç ä¸­åªæœ‰ä¸€ä¸ª Weapon ã€‚

æ¥ç€ï¼Œæˆ‘ä»¬å†ç»™ Player çš„å¦ä¸€ä¸ªå­ GameObject æŒ‚ä¸Š Bind è„šæœ¬ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/acde8a1e-2e6f-4bee-8aa9-02cec82f2808.png)

ç„¶åç‚¹å‡»ç”Ÿæˆä»£ç ï¼Œæ“ä½œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/991db32f-8212-4d7a-8176-0065cebad93f.png)


ç”Ÿæˆä¹‹åï¼Œç»“æœå¦‚ä¸‹:

Player å¤šäº†ä¸€ä¸ª Ground Check
![image.png](https://file.liangxiegame.com/d769f7e4-1e70-4dfc-9962-27d6b99998a4.png)

å†çœ‹ä¸‹  Player.Designer çš„ä»£ç ï¼Œå¦‚ä¸‹:

```csharp
// Generate Id:f512c2ed-6243-4a89-897e-bdaaabe50d63
using UnityEngine;

// 1.è¯·åœ¨èœå• ç¼–è¾‘å™¨æ‰©å±•/Namespace Settings é‡Œè®¾ç½®å‘½åç©ºé—´
// 2.å‘½åç©ºé—´æ›´æ”¹åï¼Œç”Ÿæˆä»£ç ä¹‹åï¼Œéœ€è¦æŠŠé€»è¾‘ä»£ç æ–‡ä»¶ï¼ˆé Designerï¼‰çš„å‘½åç©ºé—´æ‰‹åŠ¨æ›´æ”¹
namespace QFramework.Example
{
	public partial class Player
	{

		public Transform Weapon;

		public Transform GroundCheck;

	}
}
```

è¿™æ¬¡å¤šäº†ä¸€ä¸ª GroundCheckã€‚

è€Œ Player ä»£ç åˆ™æœªå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚

æ‰€ä»¥æ¯æ¬¡ç”Ÿæˆä»£ç ï¼ŒPlayer.cs åªä¼šç”Ÿæˆä¸€æ¬¡ï¼ŒPlayer.Designer.cs æ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆï¼Œæ‰€ä»¥å¤§å®¶æ”¾å¿ƒåœ¨ Player.cs é‡Œå†™ä»£ç ã€‚

## ç±»å‹é€‰æ‹©
ä¹‹å‰æˆ‘ä»¬ç”¨ Bind ç»‘å®šçš„ GameObject éƒ½æ˜¯ Transform ç±»å‹çš„ï¼Œè¿™æ¬¡æˆ‘ä»¬å°è¯•ç»‘å®šä¸€ä¸‹å…¶ä»–ç±»å‹ã€‚

æˆ‘ä»¬ç»™ Weapon GameObject æŒ‚ä¸Šä¸€ä¸ª Sprite Renderer å¦‚ä¸‹æ‰€ç¤º:

![image.png](https://file.liangxiegame.com/913a4dcb-7e35-433c-a50a-454614ddf89d.png)


ç„¶åï¼Œæˆ‘ä»¬ç‚¹å‡» Bind çš„ç±»å‹ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š

![image.png](https://file.liangxiegame.com/9ff5d52d-61bb-43b7-b4f0-5e9c118329e1.png)

ä¹Ÿå°±æ˜¯è¯´ Bind å¯ä»¥é€‰æ‹©æŒ‚åœ¨æ­¤ GameObject ä¸Šçš„ç»„ä»¶ã€‚

æˆ‘ä»¬é€‰æ‹© Sprite Render ç±»å‹ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/720ec620-1ca4-42b7-afa8-ec94ee846d06.png)

ç„¶åç‚¹å‡»ç”Ÿæˆä»£ç ï¼Œç»“æœå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/dd6a1012-6721-4c71-9291-de008a5b8614.png)


Player å¼•ç”¨çš„  Weapon å˜æˆäº† Sprite Renderer ç±»å‹ã€‚

Player.Designer.cs çš„ä»£ç å˜æˆäº†å¦‚ä¸‹:

```csharp
// Generate Id:de59e915-d1b6-40aa-a8e5-6fc4a8bf8e3e
using UnityEngine;

// 1.è¯·åœ¨èœå• ç¼–è¾‘å™¨æ‰©å±•/Namespace Settings é‡Œè®¾ç½®å‘½åç©ºé—´
// 2.å‘½åç©ºé—´æ›´æ”¹åï¼Œç”Ÿæˆä»£ç ä¹‹åï¼Œéœ€è¦æŠŠé€»è¾‘ä»£ç æ–‡ä»¶ï¼ˆé Designerï¼‰çš„å‘½åç©ºé—´æ‰‹åŠ¨æ›´æ”¹
namespace QFramework.Example
{
	public partial class Player
	{

		public UnityEngine.SpriteRenderer Weapon;

		public Transform GroundCheck;

	}
}
```

Weapon ä»åŸæ¥çš„ Transform ç±»å‹å˜æˆäº† SpriteRenderer ç±»å‹ã€‚

è¿™æ ·æˆ‘ä»¬åœ¨ Player.cs å°±å¯ä»¥æ‹¿åˆ° SpriteRenderer ç±»å‹çš„ Weapon äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/534d8275-5d63-4307-89a8-378722f0bffc.png)

## å¦‚ä½•è®¾ç½®é»˜è®¤çš„ å‘½åç©ºé—´ å’Œ è„šæœ¬ç”Ÿæˆç›®å½•
å¾ˆç®€å•ï¼Œæ‰“å¼€ QFramework ç¼–è¾‘å™¨é¢æ¿ï¼Œï¼ˆå¿«æ·é”® ctrl + e æˆ– ctrl + shift + e)

![image.png](https://file.liangxiegame.com/4322e7cc-8f5e-4e45-abbe-d63110d2e605.png)

åœ¨ CodeGenKit è®¾ç½®é‡Œå°±å¯ä»¥æ›´æ”¹é»˜è®¤çš„å‘½åç©ºé—´å’Œé»˜è®¤çš„è„šæœ¬ç”Ÿæˆä½ç½®ã€‚

å½“ç„¶åœ¨è¿™é‡Œç”Ÿæˆäº†ï¼Œä¹Ÿè¿˜æ˜¯å¯ä»¥åœ¨ ViewController Inspector ä¸Šè¿›è¡Œè®¾ç½®ã€‚

æˆ‘ä»¬å…ˆæ”¹ä¸‹å‘½åç©ºé—´å’Œè„šæœ¬ç”Ÿæˆè·¯å¾„ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/72f7df2a-40cb-443c-a1f3-f4c5d5656a4b.png)

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª GameObject æŒ‚ä¸Š ViewController ç»„ä»¶ï¼Œç»“æœå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/f461ade5-8cf6-4bfd-a94d-c86f523cf8e8.png)

è¿™æ ·é»˜è®¤çš„å‘½åç©ºé—´å°±ç”Ÿæ•ˆäº†ã€‚

## ViewController ä¸ ViewController åµŒå¥—
ViewController ä¸ ViewController ä¹‹é—´å¯ä»¥åµŒå¥—

æˆ‘ä»¬åœ¨ Player çš„ Weapon GameObject å†åˆ›å»ºä¸€ä¸ª WeaponEffect GameObject å¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/e9ef6d43-7e8c-42ff-9593-76dced914c7a.png)

ç„¶åå°† WeaponEffect æŒ‚ä¸Š Bind è„šæœ¬ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/0eed4e49-2a89-4d36-af02-4e42647cfe3a.png)

æ¥ç€ç»™ Weapon æŒ‚ä¸€ä¸ª ViewController è„šæœ¬ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/e0b90b3b-cf9a-4688-ab6d-c73c8feb9f72.png)

æˆ‘ä»¬å°†è„šæœ¬ç”Ÿæˆç›®å½•ä¿®æ”¹ä¸€ä¸‹ï¼Œä¿®æ”¹æˆä¸ Player.cs åŒä¸€ä¸ªç›®å½•ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/f7c52c1e-0437-48a3-b3e1-7c9d77a080bf.png)


ç‚¹å‡»ç”Ÿæˆä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image.png](https://file.liangxiegame.com/29e139ca-9fc4-4422-9d4c-7831ad6d75c6.png)

ç”Ÿæˆå®Œäº†ä¹‹åï¼Œæˆ‘ä»¬å†å°† Weapon ä¸Šçš„ Bind ç±»å‹æ”¹æˆ Weaponï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/54a25732-61ea-4dd9-84dd-7bb80d66fd2d.png)

ç„¶åç‚¹å‡» Bind ä¸Šçš„ç”Ÿæˆä»£ç ï¼Œç»“æœå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/83beb081-fb7a-48df-85f5-5caf01cac1fb.png)

è¿™æ · ViewController ä¸ ViewController åµŒå¥—ç»‘å®šå°±å®ç°äº†ã€‚

åœ¨ Player.cs ä¸­å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è°ƒç”¨ Weapon çš„å­ GameObject å¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/c29ba2f9-39b0-436a-8084-781edaf959fe.png)

å½“ç„¶å¯ä»¥å† Weapon.cs ä¸­å†™ Weapon è‡ªå·±çš„é€»è¾‘ã€‚


## ç”Ÿæˆ Prefab
åœ¨ ViewController æˆ– ç”Ÿæˆè„šæœ¬çš„ Inspector ä¸Šï¼Œæœ‰ä¸€ä¸ªç”Ÿæˆ prefab çš„é€‰é¡¹

![image.png](https://file.liangxiegame.com/f88d06e7-2b95-47fe-ac91-c446fc550447.png)

å‹¾é€‰åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/0b9de93d-12c9-498f-b38c-c2682aa98287.png)

è¿™é‡Œå¯ä»¥ä¿®æ”¹è¦ç”Ÿæˆçš„ç›®å½•ï¼Œç¬”è€…é€‰æ‹©å’Œè„šæœ¬ç”Ÿæˆçš„ç›®å½•ä¸€è‡´ï¼Œå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/7628fcb6-c9de-4fe5-9f80-8967d745b3aa.png)

ç„¶åç‚¹å‡»ï¼Œç”Ÿæˆä»£ç ï¼Œç»“æœå¦‚ä¸‹:

åœºæ™¯ä¸­çš„ Player å˜æˆäº† prefab
![image.png](https://file.liangxiegame.com/9e71ac1b-874e-47dd-b9ab-8d64e605f8a1.png)

ç”Ÿæˆç›®å½•ä¸­ä¹Ÿæœ‰äº† prefab

![image.png](https://file.liangxiegame.com/18caef79-77b1-41a6-a102-9d53683be04d.png)

## Whyï¼Ÿ
ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª  CodeGenKitï¼Ÿ

å› ä¸ºåˆ›å»ºè„šæœ¬ç›®å½•ã€åˆ›å»ºè„šæœ¬æ–‡ä»¶ã€å£°æ˜æˆå‘˜å˜é‡æˆ–è€…é€šè¿‡ transform.Find è·å–å­èŠ‚ç‚¹çš„å¼•ç”¨ã€ç„¶åæŒ‚è„šæœ¬ã€æ‹–æ‹½èµ‹å€¼ï¼Œè¿™äº›å·¥ä½œé‡éå¸¸å¤šï¼Œè€Œä¸”å¾ˆç¹é‡ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™éƒ¨åˆ†å·¥ä½œé‡é€šè¿‡ä»£ç ç”Ÿæˆå¹¶è‡ªåŠ¨èµ‹å€¼çš„æ–¹å¼ç»™ä¼˜åŒ–æ‰ï¼Œé‚£ä¹ˆé¡¹ç›®çš„å¼€å‘æ•ˆç‡å°±ä¼šå¾—åˆ°åŠå¤§åœ°æå‡ã€‚

CodeGenKit ä¸­çš„  ViewController é™¤äº†å¯ä»¥ç”¨äºæ™®é€šçš„ GameObjectï¼Œè¿˜å¯ä»¥æ”¯æŒ NGUI å’Œ UGUI ç­‰ UI ç»„ä»¶ã€‚

å¥½äº†ï¼Œå…³äºè„šæœ¬ç”Ÿæˆçš„åŠŸèƒ½ä»‹ç»åˆ°è¿™é‡Œã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 04. ActionKit æ—¶åºåŠ¨ä½œæ‰§è¡Œç³»ç»Ÿ
AciontKit æ˜¯ä¸€ä¸ªæ—¶åºåŠ¨ä½œæ‰§è¡Œç³»ç»Ÿã€‚

æ¸¸æˆä¸­ï¼ŒåŠ¨ç”»çš„æ’­æ”¾ã€å»¶æ—¶ã€èµ„æºçš„å¼‚æ­¥åŠ è½½ã€Tween çš„æ‰§è¡Œã€ç½‘ç»œè¯·æ±‚ç­‰ï¼Œè¿™äº›å…¨éƒ¨éƒ½æ˜¯æ—¶åºä»»åŠ¡ï¼Œè€Œ ActionKitï¼Œå¯ä»¥æŠŠè¿™äº›ä»»åŠ¡å…¨éƒ¨æ•´åˆåœ¨ä¸€èµ·ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ APIï¼Œæ¥å¯¹ä»–ä»¬çš„æ‰§è¡Œè¿›è¡Œ**è®¡åˆ’**ã€‚

OKï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ ActionKitçš„åŸºæœ¬ç”¨æ³•ã€‚

## å»¶æ—¶å›è°ƒ

ç¤ºä¾‹ä»£ç å¦‚ä¸‹:

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class DelayExample : MonoBehaviour
    {
        void Start()
        {
            Debug.Log("Start Time:" + Time.time);
            
            ActionKit.Delay(1.0f, () =>
            {
                Debug.Log("End Time:" + Time.time);
                
            }).Start(this);
        }
    }
}

// è¾“å‡ºç»“æœ
// Start Time: 0
// End Time: 1.00781
```

## åºåˆ—å’Œå®Œæˆå›è°ƒ
```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class SequenceAndCallback : MonoBehaviour
    {
        void Start()
        {
            Debug.Log("Sequence Start:" + Time.time);

            ActionKit.Sequence()
                .Callback(() => Debug.Log("Delay Start:" + Time.time))
                .Delay(1.0f)
                .Callback(() => Debug.Log("Delay Finish:" + Time.time))
                .Start(this, _ => { Debug.Log("Sequence Finish:" + Time.time); });
        }
    }
}
// è¾“å‡ºç»“æœ
// Sequence Start:0
// Delay Start:0
// Delay Finish:1.00537
// Sequence Finish:1.00537
```

## å¸§å»¶æ—¶

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class DelayFrameExample : MonoBehaviour
    {
        void Start()
        {
            Debug.Log("Delay Frame Start FrameCount:" + Time.frameCount);
            
            ActionKit.DelayFrame(1, () => { Debug.Log("Delay Frame Finish FrameCount:" + Time.frameCount); })
                .Start(this);


            ActionKit.Sequence()
                .DelayFrame(10)
                .Callback(() => Debug.Log("Sequence Delay FrameCount:" + Time.frameCount))
                .Start(this);

            // ActionKit.Sequence()
            //      .NextFrame()
            //      .Start(this);

            ActionKit.NextFrame(() => { }).Start(this);
        }
    }
}

// è¾“å‡ºç»“æœ
// Delay Frame Start FrameCount:1
// Delay Frame Finish FrameCount:2
// Sequence Delay FrameCount:11
```

## æ¡ä»¶æ‰§è¡Œ

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class ConditionExample : MonoBehaviour
    {
        private void Start()
        {
            ActionKit.Sequence()
                .Callback(() => Debug.Log("Before Condition"))
                .Condition(() => Input.GetMouseButtonDown(0))
                .Callback(() => Debug.Log("Mouse Clicked"))
                .Start(this);
        }
    }
}

// è¾“å‡ºç»“æœ
// Before Condition
// é¼ æ ‡å·¦é”®æŒ‰ä¸‹å
// Mouse Clicked
```

## é‡å¤æ‰§è¡Œ

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class RepeatExample : MonoBehaviour
    {
        private void Start()
        {
            ActionKit.Repeat()
                .Condition(() => Input.GetMouseButtonDown(0))
                .Callback(() => Debug.Log("Mouse Clicked"))
                .Start(this);


            ActionKit.Repeat(5)
                .Condition(() => Input.GetMouseButtonDown(1))
                .Callback(() => Debug.Log("Mouse right clicked"))
                .Start(this, () =>
                {
                    Debug.Log("Right click finished");
                });
        }
    }
}

// è¾“å‡ºç»“æœ
// æ¯æ¬¡ç‚¹å‡»é¼ æ ‡å·¦é”®éƒ½ä¼šè¾“å‡ºï¼šMouse Clicked 
// ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œåªä¼šè¾“å‡ºäº”æ¬¡ï¼šMouse right clickedï¼Œç¬¬äº”æ¬¡è¾“å‡º  Right click finished
// 
```

## å¹¶è¡Œæ‰§è¡Œ
```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class ParallelExample : MonoBehaviour
    {
        void Start()
        {
            Debug.Log("Parallel Start:" + Time.time);

            ActionKit.Parallel()
                .Delay(1.0f, () => { Debug.Log(Time.time); })
                .Delay(2.0f, () => { Debug.Log(Time.time); })
                .Delay(3.0f, () => { Debug.Log(Time.time); })
                .Start(this, () =>
                {
                    Debug.Log("Parallel Finish:" + Time.time);
                });
        }
    }
}

// è¾“å‡ºç»“æœ
// Parallel Start:0
// 1.030884
// 2.025135
// 3.018883
// Parallel Finish:3.018883
```


## æ›´å¤æ‚çš„ç¤ºä¾‹

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class ComplexExample : MonoBehaviour
    {
        private void Start()
        {
            ActionKit.Sequence()
                .Callback(() => Debug.Log("Sequence Start"))
                .Callback(() => Debug.Log("Parallel Start"))
                .Parallel(p =>
                {
                    p.Delay(1.0f, () => Debug.Log("Delay 1s Finished"))
                        .Delay(2.0f, () => Debug.Log("Delay 2s Finished"));
                })
                .Callback(() => Debug.Log("Parallel Finished"))
                .Callback(() => Debug.Log("Check Mouse Clicked"))
                .Sequence(s =>
                {
                    s.Condition(() => Input.GetMouseButton(0))
                        .Callback(() => Debug.Log("Mouse Clicked"));
                })
                .Start(this, () =>
                {
                    Debug.Log("Finish");
                    
                });
        }
    }
}

// Sequence Start
// Parallel Start
// Delay 1s Finished
// Delay 2s Finished
// Parallel Finished
// Check Mouse Clicked
// æ­¤æ—¶æŒ‰ä¸‹é¼ æ ‡å·¦é”®
// Mouse Clicked
// Finish
```


## è‡ªå®šä¹‰åŠ¨ä½œ

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class CustomExample : MonoBehaviour
    {
        class SomeData
        {
            public int ExecuteCount = 0;
        }

        private void Start()
        {
            ActionKit.Custom(a =>
            {
                a
                    .OnStart(() => { Debug.Log("OnStart"); })
                    .OnExecute(dt =>
                    {
                        Debug.Log("OnExecute");

                        a.Finish();
                    })
                    .OnFinish(() => { Debug.Log("OnFinish"); });
            }).Start(this);
            
            // OnStart
            // OnExecute
            // OnFinish

            ActionKit.Custom<SomeData>(a =>
                {
                    a
                        .OnStart(() =>
                        {
                            a.Data = new SomeData()
                            {
                                ExecuteCount = 0
                            };
                        })
                        .OnExecute(dt =>
                        {
                            Debug.Log(a.Data.ExecuteCount);
                            a.Data.ExecuteCount++;

                            if (a.Data.ExecuteCount >= 5)
                            {
                                a.Finish();
                            }
                        }).OnFinish(() => { Debug.Log("Finished"); });
                })
                .Start(this);
            
            // 0
            // 1
            // 2
            // 3
            // 4
            // Finished

            // è¿˜æ”¯æŒ Sequenceã€Repeatã€Spawn ç­‰
            // Also support sequence repeat spawn
            // ActionKit.Sequence()
            //     .Custom(c =>
            //     {
            //         c.OnStart(() => c.Finish());
            //     }).Start(this);
        }
    }
}
```


## åç¨‹æ”¯æŒ

```csharp
using System.Collections;
using UnityEngine;

namespace QFramework.Example
{
    public class CoroutineExample : MonoBehaviour
    {
        private void Start()
        {
            ActionKit.Coroutine(SomeCoroutine).Start(this);
            
            SomeCoroutine().ToAction().Start(this);

            ActionKit.Sequence()
                .Coroutine(SomeCoroutine)
                .Start(this);
        }

        IEnumerator SomeCoroutine()
        {
            yield return new WaitForSeconds(1.0f);
            Debug.Log("Hello:" + Time.time);
        }
    }
}

// è¾“å‡ºç»“æœ
// Hello:1.002077
// Hello:1.002077
// Hello:1.002077
```


## å…¨å±€ Mono ç”Ÿå‘½å‘¨æœŸ
```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class GlobalMonoEventsExample : MonoBehaviour
    {
        void Start()
        {
            ActionKit.OnUpdate.Register(() =>
            {
                if (Time.frameCount % 30 == 0)
                {
                    Debug.Log("Update");
                }
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            ActionKit.OnFixedUpdate.Register(() =>
            {
                // fixed update code here
                // è¿™é‡Œå†™ fixed update ç›¸å…³ä»£ç 
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
            
            ActionKit.OnLateUpdate.Register(() =>
            {
                // late update code here
                // è¿™é‡Œå†™ late update ç›¸å…³ä»£ç 
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            ActionKit.OnGUI.Register(() =>
            {
                GUILayout.Label("See Example Code");
                GUILayout.Label("è¯·æŸ¥çœ‹ç¤ºä¾‹ä»£ç ");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            ActionKit.OnApplicationFocus.Register(focus =>
            {
                Debug.Log("focus:" + focus);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            ActionKit.OnApplicationPause.Register(pause =>
            {
                Debug.Log("pause:" + pause);
            }).UnRegisterWhenGameObjectDestroyed(gameObject);

            ActionKit.OnApplicationQuit.Register(() =>
            {
                Debug.Log("quit");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }
    }
}
```

## DOTween é›†æˆ

éœ€è¦å…ˆæå‰è£…å¥½ DOTweenã€‚

ç„¶åå¯¼å…¥ Example ä¸­çš„å¦‚ä¸‹åŒ…ã€‚

![image.png](https://file.liangxiegame.com/63e3eba5-0dfc-4d53-af56-242d6a308124.png)

å¯¼å…¥ä¹‹åï¼Œå°±å¯ä»¥ç”¨ è®© ActionKit è·‘ DOTween äº†ï¼Œä»£ç å¦‚ä¸‹:

```csharp
using DG.Tweening;
using UnityEngine;

namespace QFramework.Example
{
    public class DOTweenExample : MonoBehaviour
    {
        private void Start()
        {
            // ä½¿ç”¨ Custom å°±å¯ä»¥æ–¹ä¾¿æ¥å…¥
            // Just Use Custom 
            ActionKit.Custom(c =>
            {
                c.OnStart(() => { transform.DOLocalMove(Vector3.one, 0.5f).OnComplete(c.Finish); });
            }).Start(this);
            
            // ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ IAction
            // Also implement with IAction
            DOTweenAction.Allocate(() => transform.DOLocalRotate(Vector3.one, 0.5f))
                .Start(this);
            
            // ä½¿ç”¨ ToAction
            // Use ToAction
            DOVirtual.DelayedCall(2.0f, () => LogKit.I("2.0f")).ToAction().Start(this);

            // é“¾å¼ API æ”¯æŒ
            // fluent api support
            ActionKit.Sequence()
                .DOTween(() => transform.DOScale(Vector3.one, 0.5f))
                .Start(this);
        }
    }
    
  
}
```

## UniRx é›†æˆ
éœ€è¦å…ˆæå‰è£…å¥½ UniRxã€‚

ç„¶åå¯¼å…¥ Example ä¸­çš„å¦‚ä¸‹åŒ…ã€‚

![image.png](https://file.liangxiegame.com/9b687ee1-83ec-49f5-b315-5795cc72b3ce.png)


å¯¼å…¥æˆåŠŸåï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹:

```csharp
using System;
using UniRx;
using UnityEngine;

namespace QFramework.Example
{
    public class UniRxExample : MonoBehaviour
    {
        void Start()
        {
            // å¯ä»¥ç›´æ¥ä½¿ç”¨ Custom
            // directly use custom
            ActionKit.Custom(c =>
            {
                c.OnStart(() => { Observable.Timer(TimeSpan.FromSeconds(1.0f)).Subscribe(_ => c.Finish()); });
            }).Start(this, () => LogKit.I("1.0f"));

            // ä½¿ç”¨ UniRxAction ä¸æ–¹ä¾¿...
            // Use UniRxAction 
            UniRxAction<long>.Allocate(() => Observable.Timer(TimeSpan.FromSeconds(2.0f))).Start(this,()=>LogKit.I("2.0f"));


            // ä½¿ç”¨ ToAction æ–¹ä¾¿æ˜“ç”¨
            // Use ToAction
            Observable.Timer(TimeSpan.FromSeconds(3.0f)).ToAction().Start(this, () => LogKit.I("3.0f"));

            ActionKit.Sequence()
                .UniRx(() => Observable.Timer(TimeSpan.FromSeconds(4.0f)))
                .Start(this, () => LogKit.I("4.0f"));
        }
    }
 
}
```

å¥½äº†ï¼Œå…³äº ActionKit çš„ä»‹ç»å°±åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 05. ResKit èµ„æºç®¡ç†&å¼€å‘è§£å†³æ–¹æ¡ˆ

## Res Kit ç®€ä»‹
Res Kitï¼Œæ˜¯èµ„æºç®¡ç†&å¿«é€Ÿå¼€å‘è§£å†³æ–¹æ¡ˆ

**ç‰¹æ€§å¦‚ä¸‹:**
* å¯ä»¥ä½¿ç”¨ä¸€ä¸ª API ä»  dataPathã€Resourcesã€StreammingAssetPathã€PersistentDataPathã€ç½‘ç»œç­‰åœ°æ–¹åŠ è½½èµ„æºã€‚
* åŸºäºå¼•ç”¨è®¡æ•°ï¼Œç®€åŒ–èµ„æºåŠ è½½å’Œå¸è½½ã€‚
* æ‹¥æŠ±æ¸¸æˆå¼€å‘æµç¨‹ä¸­çš„ä¸åŒé˜¶æ®µ
  * å¼€å‘é˜¶æ®µä¸ç”¨æ‰“ AB ç›´æ¥ä» dataPath åŠ è½½ã€‚
  * æµ‹è¯•é˜¶æ®µæ”¯æŒåªéœ€æ‰“ä¸€æ¬¡ AB å³å¯ã€‚
* å¯é€‰æ‹©ç”Ÿæˆèµ„æºåå¸¸é‡ä»£ç ï¼Œå‡å°‘æ‹¼å†™é”™è¯¯ã€‚
* å¼‚æ­¥åŠ è½½é˜Ÿåˆ—æ”¯æŒ
* å¯¹äº AssetBundle èµ„æºï¼Œå¯ä»¥åªé€šè¿‡èµ„æºåè€Œä¸æ˜¯ AssetBundle å + èµ„æºå åŠ è½½èµ„æºï¼Œç®€åŒ– API ä½¿ç”¨ã€‚


## Res Kit å¿«é€Ÿå…¥é—¨
æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬å®ç°åŠ¨æ€åŠ è½½èµ„æºï¼š
* Resources
* AssetBundle

åœ¨ Res Kit ä¸­ï¼Œæ¨èä½¿ç”¨ AssetBundle çš„æ–¹å¼è¿›è¡ŒåŠ è½½ï¼Œå› ä¸º Res Kit æ‰€å°è£…çš„ AssetBundle æ–¹å¼ï¼Œæ¯” Resources çš„æ–¹å¼æ›´å¥½ç”¨ã€‚

é™¤äº† Res Kit ä¸­çš„ AsseBundle æ–¹å¼æ›´æ˜“ç”¨å¤–ï¼ŒAssetBundle æœ¬èº«ç›¸æ¯” Resources æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œæ¯”å¦‚æ›´å°çš„åŒ…ä½“ï¼Œæ”¯æŒçƒ­æ›´ç­‰ã€‚

åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬çœ‹ä¸‹ Res Kit çš„åŸºæœ¬ä½¿ç”¨ã€‚

Res Kit åœ¨å¼€å‘é˜¶æ®µï¼Œåˆ†ä¸ºä¸¤æ­¥ã€‚
* æ ‡è®°èµ„æº
* å†™ä»£ç 

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¦ç¡®ä¿ï¼Œå½“å‰çš„ Res Kit ç¯å¢ƒä¸ºæ¨¡æ‹Ÿæ¨¡å¼ã€‚

æŒ‰ä¸‹å¿«æ·é”® ctrl + e æˆ–è€… ctrl + shift + r ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¢æ¿:

![image.png](https://file.liangxiegame.com/d6d1ac25-4c60-4b42-81ec-51b1628b640a.png)

ç¡®ä¿æ¨¡æ‹Ÿæ¨¡å¼å‹¾é€‰ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥ä½¿ç”¨æµç¨‹äº†ã€‚

### 1. èµ„æºæ ‡è®°

åœ¨ Asset ç›®å½•ä¸‹ï¼Œåªéœ€å¯¹éœ€è¦æ ‡è®°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å³é”®->@ResKit- AssetBundle Markï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![image.png](https://file.liangxiegame.com/2d793421-94cb-457f-80da-ee976f700f02.png)

æ ‡è®°å®Œäº†ï¼Œ

æ ‡è®°æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š

1. è¯¥èµ„æºæ ‡è®°çš„é€‰é¡¹ä¸ºå‹¾é€‰çŠ¶æ€

![image.png](https://file.liangxiegame.com/1ced7efd-a328-4c5e-a76a-4a85020acdd2.png)

2. è¯¥èµ„æºçš„ AssetLabel ä¸­çš„åå­—å¦‚ä¸‹
   ![image.png](https://file.liangxiegame.com/a7e20396-e553-4ead-8291-e4395fe53b30.png)

è¿™æ ·å°±æ ‡è®°æˆåŠŸäº†ã€‚

è¿™é‡Œæ³¨æ„ï¼Œä¸€æ¬¡æ ‡è®°å°±æ˜¯ä¸€ä¸ª AssetBundleï¼Œå¦‚æœæƒ³è¦è®© AssetBundle åŒ…å«å¤šä¸ªèµ„æºï¼Œå¯ä»¥å°†å¤šä¸ªèµ„æºæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åæ ‡è®°æ–‡ä»¶å¤¹ã€‚


### 2.èµ„æºåŠ è½½
æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥å†™èµ„æºåŠ è½½çš„ä»£ç å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼Œå…·ä½“çš„ä»£ç å«ä¹‰ï¼Œçœ‹æ³¨é‡Šå³å¯ã€‚ã€‚

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class ResKitExample : MonoBehaviour
    {
        // æ¯ä¸ªè„šæœ¬éƒ½éœ€è¦
        private ResLoader mResLoader = ResLoader.Allocate();

        private void Start()
        {
            // é¡¹ç›®å¯åŠ¨åªè°ƒç”¨ä¸€æ¬¡å³å¯
            ResKit.Init();
            
            // é€šè¿‡èµ„æºå + ç±»å‹æœç´¢å¹¶åŠ è½½èµ„æºï¼ˆæ›´æ–¹ä¾¿ï¼‰
            var prefab = mResLoader.LoadSync<GameObject>("AssetObj");
            var gameObj = Instantiate(prefab);
            gameObj.name = "è¿™æ˜¯ä½¿ç”¨é€šè¿‡ AssetName åŠ è½½çš„å¯¹è±¡";

            // é€šè¿‡ AssetBundleName å’Œ èµ„æºåæœç´¢å¹¶åŠ è½½èµ„æºï¼ˆæ›´ç²¾ç¡®ï¼‰
            prefab = mResLoader.LoadSync<GameObject>("assetobj_prefab", "AssetObj");
            gameObj = Instantiate(prefab);
            gameObj.name = "è¿™æ˜¯ä½¿ç”¨é€šè¿‡ AssetName  å’Œ AssetBundle åŠ è½½çš„å¯¹è±¡";
        }

        private void OnDestroy()
        {
            // é‡Šæ”¾æ‰€æœ‰æœ¬è„šæœ¬åŠ è½½è¿‡çš„èµ„æº
            // é‡Šæ”¾åªæ˜¯é‡Šæ”¾èµ„æºçš„å¼•ç”¨
            // å½“èµ„æºçš„å¼•ç”¨æ•°é‡ä¸º 0 æ—¶ï¼Œä¼šè¿›è¡ŒçœŸæ­£çš„èµ„æºå¸è½½æ“ä½œ
            mResLoader.Recycle2Cache();
            mResLoader = null;
        }
    }
}
```

å°†æ­¤è„šæœ¬æŒ‚åˆ°ä»»æ„ GameObject ä¸Šï¼Œè¿è¡Œåï¼Œç»“æœå¦‚ä¸‹:


![image.png](https://file.liangxiegame.com/04cd1727-b7ad-436d-988c-80b70c0fc106.png)

èµ„æºåŠ è½½æˆåŠŸã€‚

## æ¨¡æ‹Ÿæ¨¡å¼ä¸éæ¨¡æ‹Ÿæ¨¡å¼

### AssetBundle çš„ä¸ä¾¿ä¹‹å¤„
åœ¨ä½¿ç”¨ Res Kit ä¹‹å‰ï¼Œç›¸ä¿¡å¤§å®¶å¤šå¤šå°‘å°‘æ¥è§¦è¿‡ AssetBundleã€‚ æœ‰çš„ç«¥é‹å¯èƒ½æ˜¯åœ¨é¡¹ç›®ä¸­ç”¨è¿‡ AssetBundleï¼Œæœ‰çš„ç«¥é‹å¯èƒ½åªæ˜¯ç®€å•å­¦ä¹ è¿‡ AssetBundleã€‚æ€»ä¹‹ï¼ŒAssetBundle åœ¨ä¸é€šè¿‡ Res Kit ä½¿ç”¨ä¹‹å‰ï¼Œæ€»ç»“ä¸‹æ¥å°±ä¸¤ä¸ªå­—ï¼šéº»çƒ¦ã€‚

AssetBundle éº»çƒ¦åœ¨å“ªé‡Œå‘¢ï¼Ÿ

é¦–å…ˆ AssetBundleï¼Œéœ€è¦æ‰“åŒ…æ‰èƒ½åœ¨è¿è¡Œæ—¶åŠ è½½èµ„æºã€‚è€Œæ‰“åŒ…éœ€è¦æˆ‘ä»¬å†™ç¼–è¾‘å™¨æ‰©å±•è„šæœ¬ï¼Œåœ¨ç¼–è¾‘å™¨æ‰©å±•è„šæœ¬ä¸­è¿˜è¦å¤„ç†å¹³å°å’Œè·¯å¾„ç›¸å…³çš„é€»è¾‘ã€‚

åœ¨è¿è¡Œæ—¶ï¼Œè¿˜éœ€è¦æ ¹æ®å¹³å°å’Œè·¯å¾„å»åŠ è½½å¯¹åº”çš„ AssetBundleã€‚

è¿™äº›æ“ä½œæƒ³æƒ³å°±æ¯”è¾ƒå¤´ç—›ã€‚

æ—¢ç„¶ AssetBundle è¿™ä¹ˆéº»çƒ¦ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ AssetBundle å‘¢ï¼Ÿ

å› ä¸º AssetBundle å¯ä»¥ç»™é¡¹ç›®å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ï¼Œè€Œä¸” AssetBundle æ”¯æŒçƒ­æ›´æ–°ã€‚

æœ‰äº†è¿™ä¸¤ä¸ªä¼˜åŠ¿ï¼ŒAssetBundle å°±æˆäº†å¾ˆå¤šé¡¹ç›®çš„å¿…ç„¶é€‰æ‹©ã€‚

è€Œ Res Kit ä¸­ï¼Œä¸ºäº†è§£å†³é¢‘ç¹æ‰“åŒ…çš„é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ¦‚å¿µï¼šæ¨¡æ‹Ÿæ¨¡å¼ï¼ˆSimulation Modeï¼‰ã€‚

#### æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆSimulation Modeï¼‰

**ä»€ä¹ˆæ˜¯æ¨¡æ‹Ÿæ¨¡å¼ï¼Ÿ**

é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ¨¡æ‹ŸåŠ è½½ AssetBundle çš„æ¨¡å¼ï¼Œè¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œå¹¶æ²¡æœ‰çœŸæ­£å»åŠ è½½ AssetBundleï¼Œè€Œæ˜¯å»åŠ è½½ Application.dataPath ç›®å½•ä¸‹çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯ Assets ç›®å½•ä¸‹çš„èµ„æºã€‚

**è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ**

å¥½å¤„å°±æ˜¯æ¯å½“æœ‰èµ„æºä¿®æ”¹çš„æ—¶å€™ï¼Œå°±ä¸ç”¨å†æ‰“ AB åŒ…äº†ï¼Œå°±å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ è½½åˆ°ä¿®æ”¹åçš„èµ„æºã€‚

å¦‚æœæ˜¯éæ¨¡æ‹Ÿæ¨¡å¼ä¸‹ï¼Œæ¯å½“æœ‰èµ„æºä¿®æ”¹æ—¶ï¼Œå°±éœ€è¦å†æ‰“ä¸€æ¬¡ AB åŒ…ï¼Œæ‰èƒ½åŠ è½½åˆ°ä¿®æ”¹åçš„èµ„æºã€‚

æ‰€ä»¥ä¸€ä¸ªæ¨¡æ‹Ÿæ¨¡å¼ï¼Œè§£å†³äº†é¢‘ç¹æ‰“ AB åŒ…çš„é—®é¢˜ï¼Œä»è€Œåœ¨å¼€å‘é˜¶æ®µæé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚

é‚£ä¹ˆåœ¨ä½¿ç”¨ Res Kit çš„æ—¶å€™ï¼Œæ¨¡æ‹Ÿæ¨¡å¼å¯¹åº”çš„é˜¶æ®µæ˜¯å¼€å‘é˜¶æ®µï¼Œé‚£ä¹ˆéæ¨¡æ‹Ÿæ¨¡å¼å¯¹åº”çš„æ˜¯ä»€ä¹ˆé˜¶æ®µå‘¢ï¼Ÿ

ç­”æ¡ˆå°±æ˜¯çœŸæœºé˜¶æ®µã€‚

### å¼€å‘é˜¶æ®µã€çœŸæœºé˜¶æ®µ
å¼€å‘é˜¶æ®µã€çœŸæœºé˜¶æ®µå¹¶ä¸æ˜¯ Unity æä¾›çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç¬”è€…åœ¨è¿­ä»£ Res Kit ä¸­æå‡ºçš„ä¸¤ä¸ªæ¦‚å¿µã€‚

è¿™ä¸¤ä¸ªæ¦‚å¿µå¾ˆå®¹æ˜“ç†è§£ï¼š
* å¼€å‘é˜¶æ®µï¼šå¼€å‘é€»è¾‘çš„é˜¶æ®µï¼Œéœ€è¦ç¼–å†™å¤§é‡çš„é€»è¾‘ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½åœ¨ Unity Editor ç¯å¢ƒä¸‹å¼€å‘ã€‚
* çœŸæœºé˜¶æ®µï¼šéœ€è¦åœ¨çœŸæœºä¸Šè¿è¡Œçš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µä¸»è¦æ˜¯åšå¤§é‡çš„æµ‹è¯•æˆ–è€…çœŸæ­£å‘å¸ƒäº†ã€‚

ç›¸ä¿¡æœ‰ç‚¹è§„æ¨¡çš„é¡¹ç›®éƒ½ä¼šåˆ†é˜¶æ®µå‡ºæ¥çš„ï¼Œæ¯”å¦‚å¼€å‘é˜¶æ®µã€æµ‹è¯•é˜¶æ®µã€ç”Ÿäº§é˜¶æ®µç­‰ç­‰ï¼Œå¤§å®¶ç†è§£èµ·æ¥åº”è¯¥ä¸éš¾ã€‚

æ¥ä¸‹æ¥ç®€å•åˆ†æä¸€ä¸‹å¼€å‘é˜¶æ®µã€çœŸæœºé˜¶æ®µçš„ç‰¹ç‚¹ã€‚

**å¼€å‘é˜¶æ®µ**
åœ¨å¼€å‘é˜¶æ®µï¼Œå¼€å‘è€…éœ€è¦å†™å¤§é‡çš„é€»è¾‘ï¼Œè€Œä¸”èµ„æºçš„ç›®å½•è¿˜æ²¡æœ‰ç¨³å®šï¼Œä¸€èˆ¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¼šæœ‰å¾ˆå¤§çš„å˜åŒ–ã€‚
å¦‚æœæ¯æ¬¡èµ„æºçš„ä¿®æ”¹éƒ½éœ€è¦æ‰“ AB åŒ…çš„è¯ï¼Œä¼šéå¸¸å½±å“å¼€å‘è¿›åº¦ã€‚

**çœŸæœºé˜¶æ®µ**
çœŸæœºé˜¶æ®µï¼Œä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬çš„é€»è¾‘éƒ½å†™å®Œäº†ï¼Œåªéœ€è¦åšä¸€äº›æµ‹è¯•å’Œ debug å·¥ä½œã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œèµ„æºç›®å½•éƒ½ç¨³å®šäº†ï¼Œä¸éœ€è¦åšå¾ˆå¤§çš„è°ƒæ•´ã€‚

åœ¨çœŸæœºé˜¶æ®µï¼Œæ¯æ¬¡æ‰“ App åŒ…ä¹‹å‰ï¼Œåªéœ€è¦ Build ä¸€æ¬¡ AB å³å¯ã€‚

å½“ç„¶ï¼Œåœ¨ Unity Editor ç¯å¢ƒä¸­ï¼Œå¯ä»¥å–æ¶ˆå‹¾é€‰æ¨¡æ‹Ÿæ¨¡å¼ï¼Œè¿™æ ·åœ¨ Unity Editor ç¯å¢ƒä¸‹å¯ä»¥åŠ è½½çœŸæ­£çš„ AssetBundle åŒ…ã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æ‰€è¯´çš„ï¼Œæ‹¥æŠ±å„ä¸ªå¼€å‘é˜¶æ®µæŒ‡çš„å°±æ˜¯ä¸ºå¼€å‘é˜¶æ®µã€å’ŒçœŸæœºé˜¶æ®µåšäº†è€ƒè™‘ã€‚

æ­¤ç¯‡çš„å†…å®¹å°±è¿™äº›ã€‚

### å°ç»“
* å¼€å‘é˜¶æ®µï¼š
  *  æ¨¡æ‹Ÿæ¨¡å¼
* çœŸæœºé˜¶æ®µï¼š
  * æ¯æ¬¡æ‰“ App åŒ…ä¹‹å‰ï¼Œæ‰“ä¸€æ¬¡ AB åŒ…ã€‚
  * å¯ä»¥åœ¨ Unity Editor ç¯å¢ƒä¸‹ï¼Œå–æ¶ˆå‹¾é€‰æ¨¡æ‹Ÿæ¨¡å¼ï¼Œè¿™æ—¶åœ¨è¿è¡Œæ—¶åŠ è½½çš„èµ„æºåˆ™æ˜¯çœŸæ­£çš„ AssetBundle èµ„æº


## å¦‚ä½•æ‰“ AssetBundleï¼ˆçœŸæœºæ¨¡å¼ï¼‰


![image.png](https://file.liangxiegame.com/bcc21643-8c4a-4f6f-b3a9-db1ec3071119.png)

å–æ¶ˆå‹¾é€‰æ¨¡æ‹Ÿæ¨¡å¼æƒ…å†µä¸‹ï¼Œç‚¹å‡»æ‰“ AB åŒ… å³å¯ã€‚


## å¼‚æ­¥åŠ è½½
å¼‚æ­¥åŠ è½½ä»£ç å¦‚ä¸‹:
``` csharp
// æ·»åŠ åˆ°åŠ è½½é˜Ÿåˆ—
mResLoader.Add2Load("TestObj",(succeed,res)=>{
    if (succeed) 
    {
        res.Asset.As<GameObject>()
						.Instantiate();
    }
});

// æ‰§è¡Œå¼‚æ­¥åŠ è½½
mResLoader.LoadAsync();
```
ä¸ LoadSync ä¸åŒçš„æ˜¯ï¼Œå¼‚æ­¥åŠ è½½æ˜¯åˆ†ä¸¤æ­¥çš„ï¼Œç¬¬ä¸€æ­¥æ˜¯æ·»åŠ åˆ°åŠ è½½é˜Ÿåˆ—ï¼Œç¬¬äºŒæ­¥æ˜¯æ‰§è¡Œå¼‚æ­¥åŠ è½½ã€‚

è¿™æ ·åšæ˜¯ä¸ºäº†æ”¯æŒåŒæ—¶å¼‚æ­¥åŠ è½½å¤šä¸ªèµ„æºçš„ã€‚

## å¼‚æ­¥åŠ è½½
ä»£ç å¦‚ä¸‹:
```csharp
using System.Collections;
using UnityEngine;

namespace QFramework.Example
{
    public class AsyncLoadExample : MonoBehaviour
    {
        IEnumerator Start()
        {
            yield return ResKit.InitAsync();

            var resLoader = ResLoader.Allocate();
            
            resLoader.Add2Load<GameObject>("AssetObj 1",(b, res) =>
            {
                if (b)
                {
                    res.Asset.As<GameObject>().Instantiate();
                }
            });

            // AssetBundleName + AssetName
            resLoader.Add2Load<GameObject>("assetobj 2_prefab","AssetObj 2",(b, res) =>
            {
                if (b)
                {
                    res.Asset.As<GameObject>().Instantiate();
                }
            });
            
            resLoader.Add2Load<GameObject>("AssetObj 3",(b, res) =>
            {
                if (b)
                {
                    res.Asset.As<GameObject>().Instantiate();
                }
            });

            resLoader.LoadAsync(() =>
            {
                // åŠ è½½æˆåŠŸ 5 ç§’åå›æ”¶
                ActionKit.Delay(5.0f, () =>
                {
                    resLoader.Recycle2Cache();

                }).Start(this);
            });
        }

    }
}
```

ç»“æœå¦‚ä¸‹:

![image.png](https://file.liangxiegame.com/8ad406e4-f59c-43d2-bd4a-e7de57560958.png)


## åŠ è½½åœºæ™¯

æ³¨æ„ï¼šæ ‡è®°åœºæ™¯æ—¶è¦ç¡®ä¿ï¼Œä¸€ä¸ªåœºæ™¯æ˜¯ä¸€ä¸ª AssetBundleã€‚

```csharp
using UnityEngine;

namespace QFramework.Example
{
	public class LoadSceneExample : MonoBehaviour
	{
		private ResLoader mResLoader = null;

		void Start()
		{
			ResKit.Init();

			mResLoader = ResLoader.Allocate();

			// åŒæ­¥åŠ è½½
			mResLoader.LoadSceneSync("SceneRes");

			// å¼‚æ­¥åŠ è½½
			mResLoader.LoadSceneAsync("SceneRes");

			// å¼‚æ­¥åŠ è½½
			mResLoader.LoadSceneAsync("SceneRes", onStartLoading: operation =>
			{
				// åšä¸€äº›åŠ è½½æ“ä½œ
			});
		}

		private void OnDestroy()
		{
			mResLoader.Recycle2Cache();
			mResLoader = null;
		}
	}
}
```


## åŠ è½½ Resources ä¸­çš„èµ„æº

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
	public class LoadResourcesResExample : MonoBehaviour
	{
		public RawImage RawImage;
		
		private ResLoader mResLoader = ResLoader.Allocate();
		
		private void Start()
		{
			//  åŠ è½½ Resources ç›®å½•é‡Œçš„èµ„æºä¸ç”¨è°ƒç”¨ ResKit.Init
			
			RawImage.texture = mResLoader.LoadSync<Texture2D>("resources://TestTexture");
		}

		private void OnDestroy()
		{
			Debug.Log("On Destroy ");
			mResLoader.Recycle2Cache();
			mResLoader = null;
		}
	}
}
```


## å…³è”å¯¹è±¡ç®¡ç†

```csharp
using System.Collections;
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    public class ResLoaderRelateUnloadAssetExample : MonoBehaviour
    {
        // Use this for initialization
        IEnumerator Start()
        {
            var image = transform.Find("Image").GetComponent<Image>();

            ResKit.Init();

            var resLoader = ResLoader.Allocate();
            
            var texture2D = resLoader.LoadSync<Texture2D>("TextureExample1");

            // create Sprite æ‰©å±•
            var sprite = Sprite.Create(texture2D, new Rect(0, 0, texture2D.width, texture2D.height), Vector2.one * 0.5f);

            image.sprite = sprite;

            // æ·»åŠ å…³è”çš„ Sprite
            resLoader.AddObjectForDestroyWhenRecycle2Cache(sprite);

            yield return new WaitForSeconds(5.0f);
            
            // å½“é‡Šæ”¾æ—¶ sprite ä¹Ÿä¼šé”€æ¯
            resLoader.Recycle2Cache();
            resLoader = null;
        }
    }
}
```

## SpriteAtlas åŠ è½½

```csharp
using System.Collections;
using UnityEngine;
using UnityEngine.U2D;
using UnityEngine.UI;

namespace QFramework
{
	/// <inheritdoc />
	/// <summary>
	/// å‚è€ƒ:http://www.cnblogs.com/TheChenLin/p/9763710.html
	/// </summary>
	public class TestSpriteAtlas : MonoBehaviour
	{
		[SerializeField] private Image mImage;

		// Use this for initialization
		private IEnumerator Start()
		{
			var loader = ResLoader.Allocate();

			ResKit.Init();

			var spriteAtlas = loader.LoadSync<SpriteAtlas>("spriteatlas");
			var square = spriteAtlas.GetSprite("shop");
			
			loader.AddObjectForDestroyWhenRecycle2Cache(square);

			mImage.sprite = square;

			yield return new WaitForSeconds(5.0f);

			loader.Recycle2Cache();
			loader = null;
		}
	}
}
```

## åŠ è½½ç½‘ç»œå›¾ç‰‡

```csharp
using UnityEngine;
using UnityEngine.UI;

namespace QFramework.Example
{
    public class NetImageExample : MonoBehaviour
    {
        ResLoader mResLoader = ResLoader.Allocate();

        // Use this for initialization
        void Start()
        {
            var image = transform.Find("Image").GetComponent<Image>();
            
            mResLoader.Add2Load<Texture2D>(
                "http://pic.616pic.com/ys_b_img/00/44/76/IUJ3YQSjx1.jpg".ToNetImageResName(),
                (b, res) =>
                {
                    if (b)
                    {
                        var texture = res.Asset as Texture2D;

                        var sprite = Sprite.Create(texture, new Rect(0, 0, texture.width, texture.height),
                            Vector2.one * 0.5f);
                        image.sprite = sprite;
                        mResLoader.AddObjectForDestroyWhenRecycle2Cache(sprite);
                    }
                });
            
            mResLoader.LoadAsync();
        }
        
        private void OnDestroy()
        {
            mResLoader.Recycle2Cache();
            mResLoader = null;
        }
    }
}
```


## ä» PersistentDataPath åŠ è½½å›¾ç‰‡
```csharp
namespace QFramework.Example
{
	using System.Collections;
	using UnityEngine.UI;
	using UnityEngine;
	
	public class ImageLoaderExample : MonoBehaviour
	{
		private ResLoader mResLoader = null;

		private IEnumerator Start()
		{
			ResMgr.Init();
			
			mResLoader = ResLoader.Allocate();

			// local image
			var localImageUrl = "file://" + Application.persistentDataPath + "/Workspaces/lM1wmsLQtfzRQc6fsdEU.jpg";

			mResLoader.Add2Load(localImageUrl.ToLocalImageResName(),
				delegate(bool b, IRes res)
				{
					Debug.LogError(b);
					if (b)
					{
						var texture2D = res.Asset as Texture2D;
						transform.Find("Image").GetComponent<Image>().sprite = Sprite.Create(texture2D,
							new Rect(0, 0, texture2D.width, texture2D.height), Vector2.one * 0.5f);
					}
				});
			
			mResLoader.LoadAsync();
			
			
			yield return new WaitForSeconds(5.0f);
			mResLoader.Recycle2Cache();
			mResLoader = null;
		}
	}
}
```


## è‡ªå®šä¹‰ Res

ResKit æä¾›äº† è‡ªå®šä¹‰ Res ï¼Œé€šè¿‡è‡ªå®šä¹‰ Res å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è‡ªå®šä¹‰ Res çš„åŠ è½½æ¥æºï¼Œæ¯”å¦‚ PersistentDataPathã€StreamingAssetPathã€AssetBundle ç­‰ï¼Œç”šè‡³æ˜¯å†…å­˜ä¸­çš„ GameObject ç­‰èµ„äº§ï¼Œè¿˜å¯ä»¥é›†æˆ Addressables æˆ–è€…å…¶ä»–çš„èµ„æºç®¡ç†æ–¹æ¡ˆï¼ŒResKit å†…ç½®æ”¯æŒçš„ AssetBundleã€Resourcesã€ç½‘ç»œå›¾ç‰‡åŠ è½½ã€PersistentDataPath å›¾ç‰‡åŠ è½½éƒ½æ˜¯é€šè¿‡è‡ªå®šä¹‰ Res çš„æ–¹å¼æ‰©å±•è€Œæ¥ã€‚

æˆ‘ä»¬çœ‹ä¸‹è‡ªå®šä¹‰ Res çš„ç”¨æ³•ï¼Œå¦‚ä¸‹:
```csharp
using UnityEngine;

namespace QFramework
{
    public class CustomResExample : MonoBehaviour
    {
        // è‡ªå®šä¹‰çš„ Res
        public class MyRes : Res
        {
            public MyRes(string name)
            {
                mAssetName = name;
            }

            // åŒæ­¥åŠ è½½ï¼ˆè‡ªå·±å®ç°ï¼‰
            public override bool LoadSync()
            {
                // Asset = åŠ è½½çš„ç»“æœç»™ Asset èµ‹å€¼ 
                State = ResState.Ready;
                return true;
            }

            // å¼‚æ­¥åŠ è½½(è‡ªå·±å®ç°)
            public override void LoadAsync()
            {
                // Asset = åŠ è½½çš„ç»“æœç»™ Asset èµ‹å€¼ 
                State = ResState.Ready;
            }
            

            // é‡Šæ”¾èµ„æºï¼ˆè‡ªå·±å®ç°)
            protected override void OnReleaseRes()
            {
                // å¸è½½æ“ä½œ
                // Asset = null
                State = ResState.Waiting;
            }
        }

        // è‡ªå®šä¹‰çš„ Res åˆ›å»ºå™¨ï¼ˆåŒ…å«è¯†åˆ«åŠŸèƒ½ï¼‰
        public class MyResCreator : IResCreator
        {
            // è¯†åˆ«
            public bool Match(ResSearchKeys resSearchKeys)
            {
                return resSearchKeys.AssetName.StartsWith("myres://");
            }

            // åˆ›å»º
            public IRes Create(ResSearchKeys resSearchKeys)
            {
                return new MyRes(resSearchKeys.AssetName);
            }
        }

        void Start()
        {
            // æ·»åŠ åˆ›å»ºå™¨
            ResFactory.AddResCreator<MyResCreator>();

            var resLoader = ResLoader.Allocate();

            var resSearchKeys = ResSearchKeys.Allocate("myres://hello_world");
            
            var myRes =  resLoader.LoadResSync(resSearchKeys);
            
            resSearchKeys.Recycle2Cache();
            
            Debug.Log(myRes.AssetName);
            Debug.Log(myRes.State);
        }
    }
}
```

éå¸¸ç®€å•ã€‚

## ä»£ç ç”Ÿæˆ

Res Kit æ”¯æŒä»£ç ç”Ÿæˆï¼Œç”ŸæˆæŒ‰é’®çš„ä½ç½®å¦‚ä¸‹æ‰€ç¤º:
![image.png](https://file.liangxiegame.com/e482f08e-2e8e-4b43-84bf-f32722cc5f5c.png)
ç‚¹å‡»ç”Ÿæˆä»£ç å³å¯ï¼Œç”Ÿæˆåç»“æœå¦‚ä¸‹ã€‚
![image.png](http://file.liangxiegame.com/0ea13581-4960-4bc8-bbf1-b49a03455271.png)

ç”Ÿæˆäº† QAssets ä»£ç æ–‡ä»¶ï¼Œä»£ç å†…å®¹å¦‚ä¸‹:

```csharp
namespace QAssetBundle
{
  
    public class Testobj_prefab
    {
        public const string BundleName = "testobj_prefab";
        public const string TESTOBJ = "testobj";
    }
    public class Testsprite_png
    {
        public const string BundleName = "testsprite_png";
        public const string TESTSPRITE = "testsprite";
    }
}

```

ç”Ÿæˆäº†ä»£ç ï¼Œé‚£ä¹ˆåœ¨å†™èµ„æºåŠ è½½çš„ä»£ç çš„æ—¶å€™å°±ä¼šçˆ½çš„é£èµ·ï¼Œå¦‚ä¸‹å›¾ç¤º:
![image.png](http://file.liangxiegame.com/7b8ae854-aafe-49d8-9318-5f7d1190c8cc.png)

å›¾ä¸­ï¼Œç»™å‡ºäº†èµ„æºåå­—çš„æç¤ºã€‚

è¿™æ ·å°±ä¸å®¹æ˜“å‡ºç°å­—ç¬¦ä¸²çš„æ‹¼å†™é”™è¯¯äº†ã€‚

## ResLoader æ¨èç”¨æ³•

ResLoader çš„æ¨èç”¨æ³•ï¼Œæ˜¯ä¸€ä¸ªéœ€è¦åŠ è½½çš„å•å…ƒç”³è¯·ä¸€ä¸ª ResLoaderã€‚

ä»£ç å¦‚ä¸‹:

```csharp
using QF.Res;
using QF.Extensions;
using UnityEngine;

namespace QF.Example 
{
	public class TestResKit : MonoBehaviour 
	{
		/// <summary>
		/// æ¯ä¸€ä¸ªéœ€è¦åŠ è½½èµ„æºçš„å•å…ƒï¼ˆè„šæœ¬ã€ç•Œé¢ï¼‰ç”³è¯·ä¸€ä¸ª ResLoader
		/// ResLoader æœ¬èº«ä¼šè®°å½•è¯¥è„šæœ¬åŠ è½½è¿‡çš„èµ„æº
		/// </summary>
		/// <returns></returns>
		ResLoader mResLoader = ResLoader.Allocate ();
  
    ...
  
        void Destroy()
		{
			// é‡Šæ”¾æ‰€æœ‰æœ¬è„šæœ¬åŠ è½½è¿‡çš„èµ„æº
			// é‡Šæ”¾åªæ˜¯é‡Šæ”¾èµ„æºçš„å¼•ç”¨
			// å½“èµ„æºçš„å¼•ç”¨æ•°é‡ä¸º 0 æ—¶ï¼Œä¼šè¿›è¡ŒçœŸæ­£çš„èµ„æºå¸è½½æ“ä½œ
			mResLoader.Recycle2Cache();
			mResLoader = null;
		}
	}
}
```

åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼ŒTestResKit æ˜¯ä¸€ä¸ªéœ€è¦åŠ è½½èµ„æºçš„å•å…ƒã€‚

**è¿™ä¸ªå•å…ƒæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ**

å…¶å®å¾ˆç®€å•ï¼Œå•å…ƒå¯ä»¥æ˜¯ UIPanel ï¼ˆç•Œé¢ï¼‰ï¼Œæˆ–è€…ä»»ä½•éœ€è¦åŠ è½½èµ„æºæœåŠ¡çš„ MonoBehaviourã€‚

## ResLoader çš„èŒè´£

ResLoader çš„èŒè´£å­—å¦‚å…¶æ„ï¼Œå°±æ˜¯è´Ÿè´£åŠ è½½èµ„æºçš„ï¼Œå³èµ„æºåŠ è½½å™¨ã€‚

ä¸€ä¸ª ResLoader ä¼šè®°å½•æ‰€æœ‰å®ƒåŠ è½½è¿‡çš„èµ„æºã€‚

è¿™æ ·å®ƒåœ¨é‡Šæ”¾èµ„æºçš„æ—¶å€™åªéœ€è¦æ ¹æ®åŠ è½½è®°å½•ï¼Œè¿›è¡Œé‡Šæ”¾å³å¯ã€‚

ResLoader ä¸ å•å…ƒï¼ˆTest è„šæœ¬ï¼‰çš„ç¤ºæ„å›¾å¦‚ä¸‹:
![image.png](http://file.liangxiegame.com/296b0166-bdea-47d5-ac87-4b55c91df16f.png)

è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ï¼ŒResLoader ä¸æ˜¯è¿›è¡ŒçœŸæ­£çš„èµ„æºåŠ è½½æ“ä½œï¼Œè€Œæ˜¯è¿›è¡Œèµ„æºçš„å¼•ç”¨è·å–ã€‚

çœŸæ­£çš„èµ„æºåŠ è½½æ˜¯åœ¨ ResMgr ä¸­å®Œæˆï¼Œè¿™ä¸ªè¿‡ç¨‹ç”¨æˆ·æ˜¯æ— æ³•æ„ŸçŸ¥çš„åˆ°çš„ã€‚

ResLoader è·å–èµ„æºå¼•ç”¨çš„è¿‡ç¨‹å¦‚ä¸‹:

1. ä» ResLoader çš„å¼•ç”¨è®°å½•ä¸­æŸ¥è¯¢æ˜¯å¦å·²ç»è·å–äº†å¼•ç”¨ï¼Œå¦‚æœä¹‹å‰å·²ç»åœ¨ ResLoader è®°å½•è¿‡èµ„æºå¼•ç”¨åˆ™è¿”å›èµ„æºã€‚å¦åˆ™æ‰§è¡Œ 2.
2. ä» ResMgr ä¸­æŸ¥è¯¢æ˜¯å¦å·²ç»æœ‰èµ„æºå¯¹è±¡ï¼Œå¦‚æœæœ‰èµ„æºå¯¹è±¡ï¼Œè¿”å›èµ„æºï¼Œå¹¶åœ¨ ResLoader ä¸­è®°å½•å¼•ç”¨ï¼ŒåŒæ—¶å¯¹èµ„æºå¯¹è±¡è¿›è¡Œå¼•ç”¨è®¡æ•° +1 æ“ä½œï¼Œå¦åˆ™æ‰§è¡Œ 3.
3. è®© ResMgr è¿›è¡Œèµ„æºåŠ è½½ï¼ŒåŒæ—¶åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œå‰©ä¸‹çš„æ­¥éª¤åŒ 2ã€‚

å¤§è‡´çš„è®¿é—®èµ„æºçš„è¿‡ç¨‹å°±æ˜¯å¦‚æ­¤ï¼Œä¸ç†è§£çš„ç«¥é‹ä¸è¦ç´§ï¼Œå› ä¸ºå¯¹ä½¿ç”¨ä¸Šæ¥è¯´ä¸é‡è¦ã€‚

æˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œå»ºè®®æ¯ä¸ªéœ€è¦åŠ è½½çš„è„šæœ¬ç”³è¯·ä¸€ä¸ª ResLoaderï¼Œæ˜¯ä¸ºäº†æ›´æ–¹ä¾¿åœ°è®©å¤§å®¶è¿›è¡Œèµ„æºç®¡ç†ã€‚

ä¸ç®¡è¿™ä¸ªè„šæœ¬åŠ è½½è¿‡å¤šå°‘ä¸ªä¸œè¥¿ï¼Œä¹Ÿä¸ç®¡åˆ«çš„è„šæœ¬åŠ è½½è¿‡å¤šå°‘ï¼Œåªéœ€è¦å„è‡ªè„šæœ¬é‡Šæ”¾è‡ªå·±çš„ ResLoader å³å¯ã€‚

å› ä¸ºæ¯ä¸ªèµ„æºå¯¹è±¡å¯¹é›†æˆäº†å¼•ç”¨è®¡æ•°çš„ã€‚

## ç”³è¯· ResLoader çš„æ¶ˆè€—

å‡ ä¹æ²¡æœ‰æ¶ˆè€—ï¼Œå› ä¸º ResLoader æ˜¯ä»å¯¹è±¡æ± ä¸­ç”³è¯·çš„ã€‚


## WebGL æ³¨æ„äº‹é¡¹è¡¥å……

åœ¨ WebGL å¹³å° ResKit åŠ è½½ AssetBundle èµ„æºåªæ”¯æŒå¼‚æ­¥åŠ è½½ã€‚


å¼‚æ­¥åˆå§‹åŒ–
```csharp
StartCoroutine(ResKit.InitAsync());
// æˆ–è€…
ResKit.InitAsync().ToAction().StartGlobal();
```

å¼‚æ­¥åŠ è½½èµ„æº
* å…ˆ Add2Load
* å†è°ƒç”¨ LoadAsync()


å¥½äº†ï¼ŒResKit çš„åŠŸèƒ½å°±å…¨éƒ¨ä»‹ç»å®Œäº†ã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)





# 06. UIKit ç•Œé¢ç®¡ç†&å¿«é€Ÿå¼€å‘è§£å†³æ–¹æ¡ˆ

## UI Kit ç®€ä»‹

UI Kit æ˜¯ä¸€å¥—ç•Œé¢ç®¡ç†&å¿«é€Ÿå¼€å‘è§£å†³æ–¹æ¡ˆ

UI Kit çš„ç‰¹æ€§å¦‚ä¸‹ï¼š

* ç•Œé¢ç®¡ç†
* å±‚çº§ç®¡ç†
* ä»£ç ç”ŸæˆåŠç»„ä»¶è‡ªåŠ¨ç»‘å®šï¼ˆåº•å±‚ç”¨çš„ ViewController)


## UI Kit åŸºæœ¬ä½¿ç”¨

UI Kit æœ¬èº«æœ‰ä¸€å¥—æ¨èä½¿ç”¨çš„å·¥ä½œæµç¨‹ï¼Œè€Œæ­¤å·¥ä½œæµç¨‹çš„è®¾è®¡æ˜¯ä¸ºäº†ä½¿æ¯ä¸ªç•Œé¢åªè´Ÿè´£å±•ç¤ºæ•°æ®å’Œç›‘å¬ç”¨æˆ·è¾“å…¥ï¼Œç•Œé¢ä¸ç•Œé¢ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¹¶ä¸”å¯ç‹¬ç«‹æµ‹è¯•ã€‚

ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ¶ä½œä¸€ä¸ªæ¸¸æˆä¸»é¡µï¼ˆUIBasicPanelï¼‰ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼šTestUIBasicPanelï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![image-20220725171613899](https://file.liangxiegame.com/1b23e2de-9af1-4ce7-b5fd-7f1af8f1688b.png)

åœ¨è¿™é‡Œå¤§å®¶è¦æ³¨æ„ä¸€ä¸‹ï¼ŒUI Kit æ¨èæ¯ä¸ªç•Œé¢åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æµ‹è¯•åœºæ™¯ï¼Œè¦ä¿è¯æ¯ä¸ªç•Œé¢æ˜¯å¯ä»¥ç‹¬ç«‹æµ‹è¯•çš„ã€‚



æ¥ç€æ‰“å¼€ TestUIBasicPanel å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20220725171641152](https://file.liangxiegame.com/0f2accd3-1836-4d38-9858-3cc7828dc72f.png)

æˆ‘ä»¬æ‹–å‡ºæ¥ä¸€ä¸ª UIRoot prefabï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725171556290](https://file.liangxiegame.com/3804bb25-0112-4798-bee8-d1b9bf13f134.png)

è¿™é‡Œéå¸¸æ¸…æ™°åœ°å¯ä»¥çœ‹åˆ° UI Kit æ‰€æ”¯æŒçš„æ‰€æœ‰å±‚çº§ã€‚

æ¥ç€æˆ‘ä»¬åœ¨ Design å±‚çº§ä¸‹åˆ›å»ºä¸€ä¸ª Panelï¼ˆå³å‡» Design->UI->Panel) ï¼Œå¹¶å‘½åä¸º UIBasicPanelï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725171752004](https://file.liangxiegame.com/6b626de9-223f-4d32-9031-285c1d537c75.png)

è¿™é‡Œè¦è¯´ä¸€ç‚¹ï¼ŒDesign å±‚çº§ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥åšè®¾è®¡çš„å±‚çº§ï¼Œä»€ä¹ˆæ˜¯è®¾è®¡ï¼Ÿå°±æ˜¯æ‹¼ç•Œé¢ï¼Œè¿™ä¸ªå±‚çº§å°±æ˜¯ä¸“é—¨ç”¨æ¥æ‹¼ç•Œé¢çš„ï¼ŒDesign å±‚çº§ä¼šåœ¨è¿è¡Œçš„æ—¶å€™ä¼šè‡ªåŠ¨éšè—æ‰è‡ªå·±ä»¥åŠæ‰€æœ‰çš„å­èŠ‚ç‚¹ã€‚

OKï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°† UIBasic åˆ¶ä½œæˆ prefabï¼Œå°†å…¶æ”¾åˆ° Assets/Art/UIPrefabs ç›®å½•ä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç›®å½•å°±è‡ªå·±æ‰‹åŠ¨åˆ›å»ºä¸€ä¸‹ã€‚

æ”¾å…¥åå¦‚ä¸‹å›¾æ‰€ç¤º:

![image-20220725172338703](https://file.liangxiegame.com/584225aa-eb8a-4a7d-a44e-32ecd6732aa2.png)

Assets/Art/UIPrefab è¿™ä¸ªç›®å½•æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå®ƒæ˜¯ QFramework çº¦å®šçš„ä¸“é—¨æ”¾ç½® UI ç•Œé¢ prefab çš„ä½ç½®ã€‚è€Œ Assets/Art æ˜¯æ¡†æ¶æ¨èå­˜æ”¾èµ„æºçš„ä½ç½®ï¼Œå½“ç„¶å…³äºèµ„æºçš„å­˜æ”¾ä½ç½®åªæ˜¯æ¨èï¼Œè€Œä¸æ˜¯å¼ºåˆ¶çš„ã€‚

ä½†æ˜¯ UI ç•Œé¢çš„ prefab å¿…é¡»æ”¾åœ¨ Assets/Art/UIPrefab ç›®å½•ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªéƒ¨åˆ†åœ¨ä»£ç ç”Ÿæˆçš„æ—¶å€™éœ€è¦ã€‚

é‚£ä¹ˆæœ‰çš„ç«¥é‹å¯èƒ½ä¼šé—®ï¼ŒAssets/Art/UIPrefab è¿™ä¸ªè·¯å¾„å¯ä»¥ä¸å¯ä»¥æ›´æ”¹ï¼Ÿ

å½“ç„¶å¯ä»¥ï¼Œæ›´æ”¹çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æ‰“å¼€åŒ…ç®¡ç†é¢æ¿(QFramework/Preference ctrl + e)ï¼Œæ‰“å¼€åå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¢æ¿:

![image-20220725172030417](https://file.liangxiegame.com/146ffecf-e9b8-46fc-8e6e-1b95832256fd.png)

è¯¦ç»†çš„è®¾ç½®æ–¹å¼åœ¨ä¸Šè¾¹ä»‹ç»äº†ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚

æ¥ä¸‹æ¥éœ€è¦å°† UIHomePanel prefab æ ‡è®°ä¸º AssetBundleï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![image-20220725172438374](https://file.liangxiegame.com/f999ac89-5b91-453f-a865-1dea7045a1d3.png)

æ ‡è®°æˆåŠŸåã€‚

ä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æœ:

![image-20220725172140857](https://file.liangxiegame.com/3c313f23-2350-4e88-a7b3-88958e9e6219.png)

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦ç¡®ä¿ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ Res Kit éœ€è¦ä¿è¯å½“å‰ç¯å¢ƒæ˜¯æ¨¡æ‹Ÿç¯å¢ƒï¼ˆSimulation Modeï¼‰ï¼Œå…·ä½“çœ‹é¢æ¿ä¸­çš„å¦‚ä¸‹é€‰é¡¹æ˜¯å¦æ˜¯å‹¾ä¸Šå³å¯ã€‚

![image-20220725172213241](https://file.liangxiegame.com/98e4043d-bd1b-4a29-9363-890f9f545b12.png)

ç¡®ä¿å‹¾ä¸Šä¹‹åï¼Œæˆ‘ä»¬å°±å¼€å§‹ç”Ÿæˆä»£ç ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼ˆå³é”®->@UI-Kit Create UI Code):

![image-20220725172505171](https://file.liangxiegame.com/de51f6ad-fef7-46dd-adee-c286b77511fe.png)

ç‚¹å‡»ä¹‹åç­‰å¾…ç¼–è¯‘ï¼Œç¼–è¯‘ç»“æŸåï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ç»“æœ:

**è„šæœ¬ç”ŸæˆæˆåŠŸ**

![image-20220725172532517](https://file.liangxiegame.com/7f3959f1-66fc-44de-a8b1-97e31383dcdd.png)



**è„šæœ¬è‡ªåŠ¨æŒ‚è½½äº† UIBasicPanel Prefab ä¸Š**

![image-20220725172550535](https://file.liangxiegame.com/b386fd53-1f84-4ede-a79c-a20533361fa1.png)

åˆ°æ­¤ï¼Œä»£ç ç”Ÿæˆéƒ¨åˆ†å°±ä»‹ç»å®Œäº†ã€‚

æ¥ç€ï¼Œæˆ‘ä»¬æƒ³åŠæ³•è®©è¿™ä¸ªåœºæ™¯ç‹¬ç«‹è¿è¡Œã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œåœºæ™¯ï¼Œæ˜¯ä¸ä¼šåŠ è½½ä»»ä½•ç•Œé¢çš„ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725172721472](https://file.liangxiegame.com/4ecc5084-4f8b-4ac3-a62b-d4b7a4c9967e.png)

å¦‚ä½•è®©è¿™ä¸ªåœºæ™¯åŠ è½½ UIBasicPanel å‘¢ï¼Ÿ

å¾ˆç®€å•ï¼Œä½¿ç”¨ UIPanelTester å¦‚ä¸‹æ‰€ç¤º:

![image-20220725172923702](https://file.liangxiegame.com/dd934412-abfd-4d92-9906-3e084a2b761d.png)

æŒ‰ç…§å›¾ä¸­æ ·å­è®¾ç½®å°±å¥½ï¼Œç„¶åè¿è¡Œåœºæ™¯ã€‚
ç»“æœå¦‚ä¸‹:

![image-20220725173003435](https://file.liangxiegame.com/71acdc41-14a2-42c3-a9c7-6fef2af9757b.png)

å›¾ä¸­æˆåŠŸåŠ è½½äº†æ”¹ç•Œé¢ã€‚

è¿™æ ·ï¼Œæœ€åŸºæœ¬çš„ UIBasicPanel æµ‹è¯•åœºæ™¯å°±ç®—æ­å»ºå®Œäº†ï¼ŒåŒæ—¶æˆ‘ä»¬æ˜¯å®Œå…¨æŒ‰ç…§ QFramework æ¨èçš„å·¥ä½œæµç¨‹å®Œæˆçš„ã€‚

è™½ç„¶æ­¥éª¤ä¼šç¨å¾®ç¹çä¸€ç‚¹ï¼Œä½†æ˜¯ç”¨ä¸€æ®µæ—¶é—´å¤§å®¶å°±ä¼šè§‰å¾—è¿™æ˜¯å€¼å¾—çš„ã€‚

OKï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»æ§ä»¶çš„è‡ªåŠ¨ç»‘å®šåŠŸèƒ½ã€‚

## æ§ä»¶çš„è‡ªåŠ¨ç»‘å®šåŠŸèƒ½

æˆ‘ä»¬åœ¨ UIBasicPanel ä¸Šæ·»åŠ ä¸€äº›æŒ‰é’®ï¼Œå¹¶åœ¨æ¯ä¸ªæŒ‰é’®ä¸ŠæŒ‚ä¸Š Bind è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725173212119](https://file.liangxiegame.com/9f099faf-d488-491c-bb74-444816c48d6f.png)

æ¥ç€ Apply UIBasicPanelï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725173259294](https://file.liangxiegame.com/5782a40b-f683-41a2-9db7-7481853aa6a8.png)

è¿™é‡Œè¦æ³¨æ„ï¼Œä¸€å®šè¦é€‰å®š UIBasicPanel å†è¿›è¡Œ Applyï¼Œåƒä¸‡åˆ«é€‰æˆ UIRoot äº†ã€‚

Apply ä¹‹åï¼Œå†æ¬¡ç”Ÿæˆä¸€æ¬¡ä»£ç ï¼Œæ“ä½œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725172505171](https://file.liangxiegame.com/de51f6ad-fef7-46dd-adee-c286b77511fe.png)

ç”Ÿæˆä¹‹åï¼Œç»“æœå¦‚ä¸‹:

![image-20220725191039907](https://file.liangxiegame.com/3f332d24-b7cc-403e-a8d0-e628bf186f9e.png)

æ¥ç€ï¼Œæˆ‘ä»¬æ‰“å¼€ UIHomePanel.cs è„šæœ¬ï¼Œè¯•ç€å†™ä¸€äº›ä»£ç :

```csharp
using UnityEngine;
using UnityEngine.UI;
using QFramework;

namespace QFramework.Example
{
	public class UIBasicPanelData : UIPanelData
	{
	}
	public partial class UIBasicPanel : UIPanel
	{
		protected override void OnInit(IUIData uiData = null)
		{
			mData = uiData as UIBasicPanelData ?? new UIBasicPanelData();
			
			BtnStart.onClick.AddListener(() =>
			{
				Debug.Log("å¼€å§‹æ¸¸æˆ");
			});
		}
		
		protected override void OnOpen(IUIData uiData = null)
		{
		}
		
		protected override void OnShow()
		{
		}
		
		protected override void OnHide()
		{
		}
		
		protected override void OnClose()
		{
		}
	}
}

```

ä»£ç å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯åœ¨ OnInit çš„æ—¶å€™æ³¨å†Œäº† BtnStart æŒ‰é’®ã€‚

æ¥ç€æˆ‘ä»¬è¿è¡Œåœºæ™¯ï¼Œæ¥ç€ç‚¹å‡» BtnStart æŒ‰é’®ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹:
![image.png](http://file.liangxiegame.com/70f2fbb8-1267-407a-960f-bb019f114a83.png)

è¿™æ ·æ§ä»¶è‡ªåŠ¨ç»‘å®šåŠŸèƒ½å°±ä»‹ç»å®Œäº†ã€‚



è‡ªåŠ¨ç»‘å®šçš„åŠŸèƒ½ä¸ View Controller + Bind æ˜¯ä½¿ç”¨çš„æ˜¯åŒä¸€å¥—æœºåˆ¶ã€‚



## æ‰“å¼€ã€å…³é—­ç•Œé¢

æˆ‘ä»¬è¿è¡Œ UIBasicPanel æ˜¯é€šè¿‡ UIPanelTester å®ç°çš„ã€‚

UIPanelTester æ˜¯ä¸€ä¸ª UI ç•Œé¢çš„æµ‹è¯•å™¨ï¼Œå®ƒåªèƒ½åœ¨ç¼–è¾‘å™¨ç¯å¢ƒä¸‹è¿è¡Œã€‚

çœŸæ­£æ‰“å¼€ä¸€ä¸ª UI ç•Œé¢ï¼Œæ˜¯é€šè¿‡ UIKit.OpenPanel è¿™ä¸ª API å®Œæˆçš„ã€‚

åªéœ€è¦å†™å¦‚ä¸‹ä»£ç å³å¯:

```csharp
UIKit.OpenPanel<UIBasicPanel>();
```

ä»£ç éå¸¸ç®€å•ã€‚

è€Œæˆ‘ä»¬è¦å…³é—­æ‰ä¸€ä¸ª UI ç•Œé¢ä¹Ÿæ¯”è¾ƒå®¹æ˜“ï¼Œä»£ç å¦‚ä¸‹:

```csharp
UIKit.ClosePanel<UIBasicPanel>();
```

å¦‚æœæ˜¯åœ¨ä¸€ä¸ªç•Œé¢å†…éƒ¨å…³æ‰è‡ªå·±çš„è¯ï¼Œä»£ç å¦‚ä¸‹:

```csharp
this.CloseSelf(); // this ç»§æ‰¿è‡ª UIPanel 
```

OKï¼Œåˆ°æ­¤æˆ‘ä»¬æ¥è§¦äº† 3 ä¸ª APIï¼š

* UIKit.OpenPanel\<T\>();
* UIKit.ClosePanel\<T\>();
* UIPanel.CloseSelf();

åè¾¹çš„ä¸¤ä¸ªæ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œå¾ˆç®€å•ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ª API æ¯”è¾ƒé‡è¦ï¼Œå› ä¸ºå®ƒæœ‰ä¸€äº›å‚æ•°æˆ‘ä»¬å¯ä»¥å¡«ã€‚

## UIKit.OpenPanel

UIKit.OpenPanel çš„å‚æ•°å®šä¹‰åŠé‡è½½å¦‚ä¸‹ï¼š

```csharp
public static T OpenPanel<T>(UILevel canvasLevel = UILevel.Common, IUIData uiData = null,
            string assetBundleName = null,
            string prefabName = null) where T : UIPanel
{
	...
}

public static T OpenPanel<T>(IUIData uiData, PanelOpenType panelOpenType = PanelOpenType.Single,
            string assetBundleName = null,
            string prefabName = null) where T : UIPanel
{
	...
}

public static UIPanel OpenPanel(string panelName, UILevel level = UILevel.Common, string assetBundleName = null)
{
	...
}
```



æ‰€æœ‰å‚æ•°å¦‚ä¸‹ï¼š

* canvasLevelï¼šç•Œé¢åœ¨å“ªä¸ªå±‚çº§æ‰“å¼€
  * é»˜è®¤å€¼ï¼šCommon
* uiDataï¼šæ‰“å¼€æ—¶å¯ä»¥ç»™ç•Œé¢ä¼ çš„åˆå§‹æ•°æ®
  * é»˜è®¤å€¼ï¼šnull
* assetBundleNameï¼šç•Œé¢èµ„æºæ‰€åœ¨çš„ assetBundle å
  * é»˜è®¤å€¼ï¼šnull
* prefabNameï¼šå¦‚æœç•Œé¢åå­—å’Œ prefab åå­—ä¸åŒï¼Œåˆ™ä»¥è¿™ä¸ªå‚æ•°ä¸ºå‡†å»åŠ è½½ç•Œé¢èµ„æº
  * é»˜è®¤å€¼ï¼šnull

éƒ½æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥è¿™å››ä¸ªå‚æ•°éƒ½å¯ä»¥ä¸ç”¨ä¼ ã€‚

ä¸è¿‡è¿™å››ä¸ª API åœ¨æŸç§æƒ…å†µä¸‹éå¸¸å®ç”¨ã€‚

ä¸‹è¾¹ä¸¾ä¸€äº›ä¾‹å­ã€‚

```csharp
// åœ¨ Forward å±‚çº§æ‰“å¼€
UIKit.OpenPanel<UIBasicPanel>(UILevel.Forward);

// ä¼ é€’åˆå§‹æ•°æ®ç»™ UIHomePanel
UIKit.OpenPanel<UIBasicPanel>(new UIHomePanelData()
{
    Coin = 10
});
            
// ä» UIHomePanelTest.prefab åŠ è½½ç•Œé¢ 
UIKit.OpenPanel<UIBasicPanel>(prefabName: "UIBasicPanel");
```

éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚

æœ‰çš„ç«¥é‹å¯èƒ½ä¼šé—®ï¼Œæˆ‘ä»¬ç»™ UIHomePanel ä¼ é€’çš„  UIHomePanelDataï¼Œåœ¨å“ªé‡Œä½¿ç”¨å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯åœ¨ï¼ŒOnInit å’Œ OnOpen ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```csharp
namespace QFramework.Example
{
    using System;
    using System.Collections;
    using System.Collections.Generic;
    using System.Linq;
    using UnityEngine;
    using UnityEngine.UI;
    
    
    public class UIBasicPanelData : QFramework.UIPanelData
    {
        public int Coin;
    }
    
    public partial class UIBasicPanel : QFramework.UIPanel
    {
        protected override void OnInit(QFramework.IUIData uiData)
        {
            mData = uiData as UIBasicPanelData ?? new UIBasicPanelData();
            // please add init code here
            
            // å¤–è¾¹ä¼ è¿›æ¥çš„ï¼Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨
            Debug.Log(mData.Coin);
        }
        
        protected override void OnOpen(QFramework.IUIData uiData)
        {
            // æ¯æ¬¡ OpenPanel çš„æ—¶å€™ä½¿ç”¨
            Debug.Log((uiData as UIBasicPanelData).Coin);
        }
        
        protected override void OnShow()
        {

        }
        
        protected override void OnHide()
        {
        }
        
        protected override void OnClose()
        {
        }
    }
}

```

ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ

ç¬”è€…è®¤ä¸ºï¼Œç•Œé¢æœ‰ä¸¤ç§æ˜¾ç¤ºæ•°æ®çš„ç”¨æ³•ï¼Œä¸€ç§æ˜¯æœ‰çš„ç•Œé¢æ˜¯éœ€è¦ä»å¤–è¾¹å¡«å……çš„ï¼Œæ¯”å¦‚è­¦å‘Šã€å¼¹æ¡†ã€æˆ–è€…é“å…·ä¿¡æ¯é¡µé¢ç­‰ã€‚å¦ä¸€ç§ç•Œé¢æ˜¯éœ€è¦è‡ªå·±è·å–æ•°æ®å¹¶å±•ç¤ºçš„ï¼Œæ¯”å¦‚æ¸¸æˆä¸­çš„ä¸»è§’é‡‘å¸ã€ç­‰çº§ã€ç»éªŒå€¼ç­‰ã€‚



å¦‚æœç•Œé¢çš„æ•°æ®éƒ½ä»å¤–è¾¹å¡«å……ï¼Œé‚£ä¹ˆè¿™ä¸ªç•Œé¢ä¼šæ‹¥æœ‰æ›´å¥½çš„å¯å¤ç”¨æ€§ã€‚



å½“ç„¶éœ€è¦ä¸€ä¸ªå¯å¤ç”¨æ€§çš„ç•Œé¢è¿˜æ˜¯éœ€è¦ä¸€ä¸ªæ™®é€šç•Œé¢å°±çœ‹å¤§å®¶çš„éœ€æ±‚äº†ï¼Œå¹¶ä¸æ˜¯è¯´æœ‰å¯å¤ç”¨æ€§çš„ç•Œé¢å°±æ˜¯å¥½çš„ã€‚

## å¼‚æ­¥åŠ è½½ç•Œé¢

```csharp
StartCoroutine(UIKit.OpenPanelAsync<UIHomePanel>());
// æˆ–è€…
UIKit.OpenPanelAsync<UIHomePanel>().ToAction().Start(this);
```

åœ¨ WebGL å¹³å°ä¸Š, AssetBundle åŠ è½½èµ„æºåªæ”¯æŒå¼‚æ­¥åŠ è½½ï¼Œæ‰€ä»¥ä¸ºæ­¤æä¾›äº† UIKit çš„å¼‚æ­¥åŠ è½½æ”¯æŒã€‚





## UIPanel ç”Ÿå‘½å‘¨æœŸ

æˆ‘ä»¬å…ˆçœ‹ä¸‹  UIBasicPanel çš„ä»£ç ï¼Œå¦‚ä¸‹:

```csharp
namespace QFramework.Example
{
    using System;
    using System.Collections;
    using System.Collections.Generic;
    using System.Linq;
    using UnityEngine;
    using UnityEngine.UI;
    
    
    public class UIBasicPanelData : QFramework.UIPanelData
    {
    }
    
    public partial class UIBasicPanel : QFramework.UIPanel
    {        
        protected override void OnInit(QFramework.IUIData uiData)
        {
            mData = uiData as UIHomePanelData ?? new UIHomePanelData();
            // please add init code here
            
            
        }
        
        protected override void OnOpen(QFramework.IUIData uiData)
        {
        }
        
        protected override void OnShow()
        {

        }
        
        protected override void OnHide()
        {
        }
        
        protected override void OnClose()
        {
        }
    }
}
```

é»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¦‚ä¸‹:

* OnInit
* OnOpen
* OnShow
* OnHide
* OnClose

OnInit åˆ™æ˜¯åœ¨ UIPanel æ‰€åœ¨çš„ prefab åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œè°ƒç”¨çš„ï¼Œåœ¨è°ƒç”¨ UIKit.OpenPanel æ—¶ï¼Œåªè¦åœ¨ UIKit ä¸­æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜ç•Œé¢æ—¶ï¼Œå°±ä¼šè°ƒç”¨ä¸€æ¬¡ OnInit è¿™ä¸ªå‘¨æœŸã€‚

OnOpen å°±æ˜¯æ¯æ¬¡ UIKit.OpenPanel è°ƒç”¨æ—¶ï¼Œå°±ä¼šè°ƒç”¨ã€‚

OnShow  å®é™…ä¸Šè°ƒç”¨æ—¶æœºä¸ UIKit.OpenPanel æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ OnShow æ˜¯æœ€åˆç‰ˆæœ¬é—ç•™ä¸‹æ‹‰çš„ APIï¼Œæ‰€ä»¥å°±ä¿ç•™äº†ã€‚å½“ç„¶è¿˜æœ‰ UIMgr.ShowPanel è°ƒç”¨æ—¶ï¼ŒOnShow ä¼šè¢«è°ƒç”¨

OnHide åˆ™æ˜¯åœ¨ UIKit.HidePanel è°ƒç”¨æ—¶ï¼ŒOnHide ä¼šè¢«è°ƒç”¨ã€‚

æœ€å OnClose å°±æ˜¯åœ¨ UIKit.ClosePanel è°ƒç”¨æ—¶ï¼Œå°±ä¼šè§¦å‘ï¼Œå®é™…ä¸Š OnClose ç›¸å½“äº OnDestory è¿™ä¸ªå‘¨æœŸã€‚

å¤§æ¦‚å°±è¿™äº›ï¼Œå…¶ä¸­ UIKit.OpenPanel ä¼šè§¦å‘èµ„æºçš„åŠ è½½å’Œåˆå§‹åŒ–æ“ä½œï¼Œè€Œ UIKit.ClosePanel åˆ™ä¼šè§¦å‘å¸è½½å’Œé”€æ¯æ“ä½œï¼Œåªè¦è®°å¾—è¿™ä¸¤ç‚¹å°±å¥½ã€‚

ç¬”è€…åŸºæœ¬ä¸Šå°±åªä¼šç”¨åˆ° OnInit å’Œ OnClose è¿™äº›å‘¨æœŸï¼Œå¶å°”ä¼šç”¨ä¸€ç”¨ OnOpenã€‚



OKï¼Œæ­¤ç¯‡çš„å†…å®¹å°±è¿™äº›ã€‚






## UIKit å‰©ä¸‹çš„å¸¸ç”¨ API

### UIKit.Root.SetResolution

å‚æ•°å®šä¹‰å¦‚ä¸‹ï¼š

![image.png](http://file.liangxiegame.com/bac63766-0f9a-4d9c-92fd-cb6b90324262.png)

å¯¹åº” UIRoot ä¸Šçš„ Canvas Scaler å¦‚ä¸‹:

![image.png](http://file.liangxiegame.com/bc2c2122-c559-48bf-8b2f-ea4609826493.png)

å¤§éƒ¨åˆ†é¡¹ç›®ï¼Œç”¨è¿™ä¸ª API åšå±å¹•é€‚é…è¶³å¤Ÿäº†ã€‚

### UIKit.Root.Camera

è·å– UIRoot çš„æ‘„åƒæœºã€‚

```csharp
var uiCamera = UIKit.Root.Camera;
```

### UIKit.Stack.Pushã€UIPanel.Backï¼ˆPopï¼‰

æœ‰çš„æ—¶å€™ï¼ŒUI éœ€è¦å®ç°ä¸€ä¸ª UI ç•Œé¢çš„å †æ ˆï¼Œä»¥ä¾¿äºæ”¯æŒè¿”å›ä¸Šä¸€é¡µè¿™æ ·çš„æ“ä½œã€‚

è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨ Push å’Œ UIPanel.Back å®ç°ã€‚

ç¤ºä¾‹ä»£ç :

```csharp
UIKit.Stack.Push(this); // this æ˜¯ Panel
// UIHomePanel éœ€è¦ç¡®ä¿æ˜¯æ‰“å¼€çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ‰“å¼€ä¼šæŠ¥é”™ã€‚
UIKit.Stack.Push<UIHomePanel>();
            
this.Back(); // å¼¹å‡º UIHomePanel
this.Back(); // å¼¹å‡º this
```

éå¸¸ç®€å•ã€‚



## UIPanel è‡ªåŠ¨ç”Ÿæˆå·¥å…·

åœ¨æ­¤ç¯‡çš„æœ€å¼€å§‹ï¼Œç¬”è€…æ‰‹åŠ¨åˆ›å»ºäº†ä¸€å¥—å›´ç»• UIBasicPanel çš„æµ‹è¯•ã€å¼€å‘åœºæ™¯ï¼Œå…¶è¿‡ç¨‹æ¯”è¾ƒç¹çã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…å†™äº†ä¸€ä¸ªç®€å•çš„ UIPanel è‡ªåŠ¨ç”Ÿæˆå·¥å…·ã€‚

æ¥ä¸‹æ¥çœ‹ä¸‹å®ƒçš„åŸºæœ¬ä½¿ç”¨æµç¨‹ã€‚

### åŸºæœ¬ä½¿ç”¨

é¦–å…ˆï¼Œå¿«æ·é”® ctrl + e æ‰“å¼€ PackageKit é¢æ¿ï¼Œå¦‚ä¸‹:

![image-20220725213353833](https://file.liangxiegame.com/12dcb73a-c255-45f4-869e-a00700d3b3c1.png)

åœ¨ä¸Šå›¾ä¸­ç•Œé¢åå­—çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ Game/UIGamePanelï¼Œç„¶åç‚¹å‡»åˆ›å»º UI Panelï¼Œå¦‚ä¸‹æ‰€ç¤º:

![image-20220725213736831](https://file.liangxiegame.com/19dfe911-4cdd-4432-a99c-00423b38d781.png)



è¾“å…¥ä¹‹åå¯ä»¥çœ‹åˆ°å³å°†ç”Ÿæˆæ–‡ä»¶çš„é¢„è§ˆã€‚

åœ¨è¿™ä¸ªé¢æ¿ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® åˆ†è¾¨ç‡ä¸é€‚é…å¯¹é½ï¼Œè¿˜æœ‰æ¨¡å—çš„ç›®å½•ï¼Œå¦‚æœä¸æƒ³åœ¨æ›´ç›®å½•åˆ›å»ºæŒ‰ç…§è§„èŒƒç”Ÿæˆæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–å­ç›®å½•ä¸­åˆ›å»ºã€‚

æˆ‘ä»¬ç‚¹å‡» "åˆ›å»º UI Panel" è¿™ä¸ªæŒ‰é’®ã€‚



ç‚¹å‡»ä¹‹åç»“æœå¦‚ä¸‹:



![image-20220725214053092](https://file.liangxiegame.com/daf92af1-1e66-4b86-bf4b-e331c272570b.png)



ç›¸å…³çš„ prefabï¼Œåœºæ™¯ã€è„šæœ¬éƒ½ç”Ÿæˆå¥½äº†ï¼Œå°±è¿ AssetBundle ä¹Ÿéƒ½æ ‡è®°å¥½äº†ï¼Œå¦‚ä¸‹:



![image-20220725214155564](https://file.liangxiegame.com/a0a6c3e3-c4b6-4602-8b92-a47506714a98.png)

è¿™å°±æ˜¯è¿™ä¸ªå·¥å…·çš„ä¸€ä¸ªç”¨å¤„ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè§£å†³äº†ç¬”è€…å¤§é‡çš„å¼€å‘å·¥ä½œé‡ã€‚


åœ¨ä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬äº†è§£äº†ç•Œé¢çš„æ‰“å¼€å’Œå…³é—­ç›¸å…³çš„ APIã€‚

åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹ UI Kit ä¸­çš„ å­ç•Œé¢/å­æ§ä»¶â€”UI Element

## UI Element ç®€ä»‹

åœ¨å‰ç¯‡ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼Œä¸€ä¸ª UIPanel æ˜¯å¯ä»¥è‡ªåŠ¨ç»‘å®šå‡ ä¸ª å­æ§ä»¶çš„ï¼ˆBindï¼‰ã€‚ä½†æ˜¯å½“ä¸€ä¸ªç•Œé¢ç»“æ„æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œä¸å¯èƒ½ä¸€ä¸ª UIPanel ç®¡ç†æ•°åä¸ª Bindï¼Œè¿™æ—¶å€™å°±éœ€è¦å¯¹ Bind è¿›è¡Œä¸€äº›æ‰“ç»„æ“ä½œã€‚æˆ‘ä»¬çš„ UIElement å°±å¯ä»¥ç™»åœºäº†ã€‚

## UIElement åŸºæœ¬ä½¿ç”¨

ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼Œå°±æ˜¯å°† Bind ä¸­çš„ æ ‡è®°ç±»å‹ æ”¹æˆ Elementå³å¯,å¦‚ä¸‹æ‰€ç¤ºã€‚

![image.png](https://file.liangxiegame.com/47b78081-62cd-41e2-b96b-47383dc80e04.png)

![image.png](https://file.liangxiegame.com/b9533003-b30b-406e-b14c-4f8f777b1e95.png)

å¹¶ä¸”è¦ç»™ ç”Ÿæˆç±»å å¡«å†™ä¸€ä¸ªåå­—ï¼Œè¿™ä¸ªåå­—å†³å®šç”Ÿæˆçš„ç±»çš„åå­—ã€‚è¿™é‡Œå¡«å†™äº† UIAboutSubPanelã€‚


ä¹‹åè¿›è¡Œ Apply æ“ä½œã€‚

![image-20220728141929443](https://file.liangxiegame.com/46876a38-e980-49a8-bbc8-59e74f968f3d.png)



æ³¨æ„è¿™é‡Œ Apply çš„æ˜¯ UIBasicPanelã€‚

æ¥ç€ç”Ÿæˆä»£ç ï¼Œ å¦‚ä¸‹:

![image-20220728142010223](https://file.liangxiegame.com/800b53e4-0d6a-43f4-9aa1-ce3815d5fc87.png)


ç­‰å¾…ç¼–è¯‘åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š



![image-20220728142048854](https://file.liangxiegame.com/3c05a2b9-f815-421b-b0b4-379a0477e401.png)





BtnClose ç”± UIAboutSubPanel ç®¡ç†äº†

![image-20220728142125763](https://file.liangxiegame.com/956e3e01-32a3-4582-a691-59e2d9e647de.png)

æˆ‘ä»¬çœ‹ä¸‹è„šæœ¬ç›®å½•:

![image-20220728142202239](https://file.liangxiegame.com/76847346-79ad-4003-84f7-6111152e457a.png)

ç›®å½•ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œæ˜¯ä»¥çˆ¶ Panel ï¼ˆUIBasicPanelï¼‰ä¸ºåçš„ã€‚

æ‰“å¼€ UIAboutSubPanel è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º:

```csharp
/****************************************************************************
 * 2022.7 LIANGXIEWIN
 ****************************************************************************/

using System;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using QFramework;

namespace QFramework.Example
{
	public partial class SubPanel1 : UIElement
	{
		private void Awake()
		{
		}

		protected override void OnBeforeDestroy()
		{
		}
	}
}
```

å†çœ‹ä¸‹ UILoginView.Designer.cs è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```csharp
/****************************************************************************
 * 2022.7 LIANGXIEWIN
 ****************************************************************************/

using UnityEngine;
using UnityEngine.UI;
using QFramework;

namespace QFramework.Example
{
	public partial class SubPanel1
	{
		[SerializeField] public UnityEngine.UI.Button BtnStart2;
		[SerializeField] public UnityEngine.UI.Button BtnStart3;

		public void Clear()
		{
			BtnStart2 = null;
			BtnStart3 = null;
		}

		public override string ComponentName
		{
			get { return "SubPanel1";}
		}
	}
}
```

ç»“æ„ä¸ä¹‹å‰çš„ UIBasicPanel éå¸¸ç›¸ä¼¼ã€‚

æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥å†™ä¸€äº›ä¸å­æ¨¡å—ç›¸å…³çš„é€»è¾‘äº†ï¼Œå…³äº UIElement çš„åŸºæœ¬ä½¿ç”¨å°±ä»‹ç»åˆ°è¿™é‡Œã€‚




## åŒä¸€ä¸ªç±»å‹çš„ç•Œé¢æ‰“å¼€å¤šä¸ª

```csharp
UIKit.OpenPanel<UIMultiPanel>(new UIMultiPanelData(), PanelOpenType.Multiple);
```





## å¦‚ä½•è‡ªå®šä¹‰ç•Œé¢åŠ è½½æ–¹å¼?



ç»§æ‰¿ AbstractPanelLoaderPool ç±»ï¼Œå†å®ç°ä¸€ä¸ª IPanelLoader çš„ç±»ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹:



```csharp
using System;
using UnityEngine;

namespace QFramework.Example
{
    public class CustomPanelLoaderExample : MonoBehaviour
    {
        public class ResourcesPanelLoaderPool : AbstractPanelLoaderPool
        {
            /// <summary>
            /// Load Panel from Resources
            /// </summary>
            public class ResourcesPanelLoader : IPanelLoader
            {
                private GameObject mPanelPrefab;

                public GameObject LoadPanelPrefab(PanelSearchKeys panelSearchKeys)
                {
                    mPanelPrefab = Resources.Load<GameObject>(panelSearchKeys.GameObjName);
                    return mPanelPrefab;
                }

                public void LoadPanelPrefabAsync(PanelSearchKeys panelSearchKeys, Action<GameObject> onPanelLoad)
                {
                    var request = Resources.LoadAsync<GameObject>(panelSearchKeys.GameObjName);

                    request.completed += operation => { onPanelLoad(request.asset as GameObject); };
                }

                public void Unload()
                {
                    mPanelPrefab = null;
                }
            }

            protected override IPanelLoader CreatePanelLoader()
            {
                return new ResourcesPanelLoader();
            }
        }

        void Start()
        {
            // æ¸¸æˆå¯åŠ¨æ—¶ï¼Œè®¾ç½®ä¸€æ¬¡
            UIKit.Config.PanelLoaderPool = new ResourcesPanelLoaderPool();
        }
    }
}
```



å¦‚æœæƒ³è¦æ”¯æŒ å…¶ä»–æ–¹å¼åŠ è½½ç•Œé¢åˆ™å¯ä»¥é€šè¿‡æ­¤æ–¹å¼å®šåˆ¶ã€‚



å¦å¤–ï¼ŒQFramework ä¸­çš„ UIKit é»˜è®¤ä½¿ç”¨ ResKit çš„æ–¹å¼åŠ è½½ç•Œé¢ã€‚



å¯ä»¥åœ¨ QFramework æºç ä¸­çœ‹åˆ°å¦‚ä¸‹ä»£ç :



```csharp
using System;
using UnityEngine;

namespace QFramework
{
    public class UIKitWithResKitInit
    {
        [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
        public static void Init()
        {
            UIKit.Config.PanelLoaderPool = new ResKitPanelLoaderPool();
        }
    }
    
    ...
}
```



å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹å¼åŠ è½½ç•Œé¢ï¼Œéœ€è¦å°†ä»¥ä¸Šä»£ç æ³¨é‡Šæ‰ã€‚



å¥½äº†ï¼Œå…³äº UIKit è‡ªå®šä¹‰åŠ è½½ç•Œé¢å°±ç®€å•ä»‹ç»åˆ°è¿™é‡Œã€‚



## UI Kit å°ç»“

åœ¨è¿™ä¸€ç« ï¼ŒUI Kit çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½æ¥è§¦è¿‡äº†ï¼Œå¦‚ä¸‹ï¼š

* UIPanel/UIElement ä»£ç ç”Ÿæˆ
* UIKit å¸¸ç”¨ API
  * UIKit.OpenPanelï¼ˆAsyncï¼‰
  * UIKit.ClosePanel
  * UIKit.CloseSelf
  * UIKit.SetResolution
  * UIKit.Stack.Pushã€UIPanel.Back(Pop)
* UIPanel ç”Ÿå‘½å‘¨æœŸ
* UIPanel æµ‹è¯•åœºæ™¯ç”Ÿæˆå·¥å…·

åªè¦æŒæ¡äº†ä»¥ä¸Šè¿™äº›ï¼ŒåŸºæœ¬ä¸Šå¼€å‘ä¸€äº›ç•Œé¢å°±æ²¡å•¥é—®é¢˜äº†ã€‚

å…³äº UIKit å°±ä»‹ç»åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)













  
# 07. AudioKit éŸ³é¢‘ç®¡ç†è§£å†³æ–¹æ¡ˆ

## åŸºæœ¬ä½¿ç”¨

AudioKit éŸ³é¢‘æ’­æ”¾ç›¸å…³çš„åŠŸèƒ½å¦‚ä¸‹:
* æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ’­æ”¾ä¸€ä¸ªéŸ³ä¹ï¼Œæ’­æ”¾åˆ«çš„éŸ³ä¹ä¼šç›´æ¥å¸è½½æ‰æ­£åœ¨æ’­æ”¾çš„éŸ³ä¹ã€‚
* æ’­æ”¾éŸ³æ•ˆï¼ŒåŒä¸€æ—¶é—´å¯ä»¥æ’­æ”¾å¤šä¸ªéŸ³æ•ˆï¼Œå½“å¤šäººè¯´è¯æ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ’­æ”¾äººå£°ã€‚
* æ’­æ”¾äººå£°ï¼Œä¸æ’­æ”¾èƒŒæ™¯éŸ³ä¹ä¸€è‡´ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ’­æ”¾ä¸€ä¸ªäººå£°ï¼Œç”¨äºæ’­æ”¾ä¸€äº›æ—ç™½ä¹‹ç±»çš„å£°éŸ³éå¸¸é€‚åˆã€‚

å¯¹åº”çš„ API è°ƒç”¨æ–¹å¼å¦‚ä¸‹:

```csharp
btnPlayGame.onClick.AddListener(() => { AudioKit.PlayMusic("resources://game_bg"); });

btnPlaySound.onClick.AddListener(() => { AudioKit.PlaySound("resources://game_bg"); });

btnPlayVoiceA.onClick.AddListener(() => { AudioKit.PlayVoice("resources://game_bg"); });
```


AudioKit è®¾ç½®ç›¸å…³çš„åŠŸèƒ½å¦‚ä¸‹:
* èƒŒæ™¯éŸ³ä¹å¼€å…³
* éŸ³æ•ˆå¼€å…³
* äººå£°å¼€å…³

è°ƒç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

```csharp
btnSoundOn.onClick.AddListener(() => { AudioKit.Settings.IsSoundOn.Value = true; });

btnSoundOff.onClick.AddListener(() => { AudioKit.Settings.IsSoundOn.Value = false; });

btnMusicOn.onClick.AddListener(() => { AudioKit.Settings.IsMusicOn.Value = true; });

btnMusicOff.onClick.AddListener(() => { AudioKit.Settings.IsMusicOn.Value = false; });

btnVoiceOn.onClick.AddListener(() => { AudioKit.Settings.IsVoiceOn.Value = true; });

btnVoiceOff.onClick.AddListener(() => { AudioKit.Settings.IsVoiceOn.Value = false; });
```
è¿™æ˜¯æ‰“å¼€å£°éŸ³è¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨æ–¹å¼ã€‚


è°ƒæ•´éŸ³é‡å¤§å°çš„ä»£ç å¦‚ä¸‹:

```csharp
AudioKit.Settings.MusicVolume.RegisterWithInitValue(v => musicVolumeSlider.value = v);
AudioKit.Settings.VoiceVolume.RegisterWithInitValue(v => voiceVolumeSlider.value = v);
AudioKit.Settings.SoundVolume.RegisterWithInitValue(v => soundVolumeSlider.value = v);
            
musicVolumeSlider.onValueChanged.AddListener(v => { AudioKit.Settings.MusicVolume.Value = v; });
voiceVolumeSlider.onValueChanged.AddListener(v => { AudioKit.Settings.VoiceVolume.Value = v; });
soundVolumeSlider.onValueChanged.AddListener(v => { AudioKit.Settings.SoundVolume.Value = v; });
```


## å¦‚ä½•è‡ªå®šä¹‰éŸ³é¢‘åŠ è½½

ä¸ UIKit ä¸€æ ·, AudioKit ä¹Ÿæ”¯æŒäº†è‡ªå®šä¹‰éŸ³é¢‘åŠ è½½çš„æ–¹å¼ã€‚

å‚è€ƒä»£ç å¦‚ä¸‹:

```csharp
using System;
using UnityEngine;

namespace QFramework.Example
{
    public class CustomAudioLoaderExample : MonoBehaviour
    {
        /// <summary>
        /// å®šä¹‰ä» Resources åŠ è½½éŸ³é¢‘
        /// </summary>
        class ResourcesAudioLoaderPool : AbstractAudioLoaderPool
        {
            protected override IAudioLoader CreateLoader()
            {
                return new ResourcesAudioLoader();
            }
        }

        class ResourcesAudioLoader : IAudioLoader
        {
            private AudioClip mClip;
        
            public AudioClip Clip => mClip;

            public AudioClip LoadClip(AudioSearchKeys panelSearchKeys)
            {
                mClip = Resources.Load<AudioClip>(panelSearchKeys.AssetName);
                return mClip;
            }

            public void LoadClipAsync(AudioSearchKeys audioSearchKeys, Action<bool,AudioClip> onLoad)
            {
                var resourceRequest = Resources.LoadAsync<AudioClip>(audioSearchKeys.AssetName);
                resourceRequest.completed += operation =>
                {
                    var clip = resourceRequest.asset as AudioClip;
                    onLoad(clip, clip);
                };
            }

            public void Unload()
            {
                Resources.UnloadAsset(mClip);
            }
        }
        
        
        void Start()
        {
            // å¯åŠ¨æ—¶éœ€è¦è°ƒç”¨ä¸€æ¬¡
            AudioKit.Config.AudioLoaderPool = new ResourcesAudioLoaderPool();
        }
    }
}

```

ç”±äº QFramework ä¸­çš„ AudioKit é»˜è®¤æ˜¯é€šè¿‡ ResKit åŠ è½½ï¼Œæ‰€ä»¥ä½¿ç”¨è‡ªå®šä¹‰åŠ è½½æ–¹å¼æ—¶ï¼Œè¯·å°†é¡¹ç›®ä¸­å¦‚ä¸‹ä»£ç æ³¨é‡Šæ‰:

```csharp
    public class AudioKitWithResKitInit 
    {
        [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
        public static void Init()
        {
            AudioKit.Config.AudioLoaderPool = new ResKitAudioLoaderPool();
        }
    }
```


å…³äº AudioKit å°±ä»‹ç»åˆ°è¿™ã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)



# 08. FluentAPI é“¾å¼ API

## FluentAPI ç®€ä»‹
FluentAPI æ˜¯ ç¬”è€…ç§¯ç´¯çš„ Unity API çš„ä¸€äº›é“¾å¼å°è£…ã€‚

åŸºæœ¬ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š
```csharp
// traditional style
var playerPrefab = Resources.Load<GameObject>("no prefab don't run");
var playerObj = Instantiate(playerPrefab);

playerObj.transform.SetParent(null);
playerObj.transform.localRotation = Quaternion.identity;
playerObj.transform.localPosition = Vector3.left;
playerObj.transform.localScale = Vector3.one;
playerObj.layer = 1;
playerObj.layer = LayerMask.GetMask("Default");

Debug.Log("playerPrefab instantiated");

// Extension's Style,same as above 
Resources.Load<GameObject>("playerPrefab")
    .Instantiate()
    .transform
    .Parent(null)
    .LocalRotationIdentity()
    .LocalPosition(Vector3.left)
    .LocalScaleIdentity()
    .Layer(1)
    .Layer("Default")
    .ApplySelfTo(_ => { Debug.Log("playerPrefab instantiated"); });
```

ä»£ç å¾ˆç®€å•ã€‚

FluentAPI åŒ…å« 100 å¤šä¸ªå¸¸ç”¨ API çš„é“¾å¼å°è£…ï¼Œå…·ä½“å¯ä»¥å‚è€ƒç¼–è¾‘å™¨å†…æ–‡æ¡£ã€‚

![image.png](https://file.liangxiegame.com/67604baa-a9ca-4f03-8f7a-c1f88be322b7.png)

å¦å¤– é“¾å¼ API å¯ä»¥ä¸ QFramework çš„å…¶ä»–æ¨¡å—é…åˆä½¿ç”¨äº‹åŠåŠŸå€ï¼Œæ¯”å¦‚ ResKit ä¸ FluentAPI ç»“åˆï¼Œå‚è€ƒä»£ç å¦‚ä¸‹:

```csharp
mResLoader.LoadSync<GameObject>("mygameobj")
  .InstantiateWithParent(parent)
  .transform
  .LocalIdentity()
  .Name("MyGameObj")
  .Show();
```


é“¾å¼ API å°±ä»‹ç»åˆ°è¿™é‡Œã€‚



## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 09. SingletonKit å•ä¾‹æ¨¡æ¿å¥—ä»¶

SingletonKit æ˜¯ QFramework çš„ç¬¬ä¸€ä¸ªæ”¶é›†çš„å·¥å…·ï¼Œç»è¿‡äº† 7 å¹´çš„è¿­ä»£ï¼Œç°åœ¨å·²ç»éå¸¸æˆç†Ÿäº†ã€‚

å¥½ä¹…ä¸è§ ï¼ä¹‹å‰æƒ³ç€è®©å„ä½ç›´æ¥ç”¨ QFrameworkï¼Œä½†æ˜¯åæ¥æƒ³æƒ³ï¼Œå¦‚æœæ­£åœ¨è¿›è¡Œçš„é¡¹ç›®ç›´æ¥ä½¿ç”¨QFrameworkï¼Œè¿™æ ·é£é™©å¤ªé«˜äº†ï¼Œè¦æ”¹çš„ä»£ç å¤ªå¤šï¼Œæ‰€ä»¥æ‰“ç®—é™†ç»­ç‹¬ç«‹å‡ºæ¥ä¸€äº›å·¥å…·å’Œæ¨¡å—,å…è®¸å„ä½ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ¨¡å—çš„è¿›è¡Œæ›´æ¢ï¼Œå‡å°‘æ›´æ¢å¸¦æ¥çš„é£é™©ã€‚

## QSingleton:

ä¹‹å‰æœ‰å‡ ç¯‡æ–‡ç« ä»‹ç»è¿‡å•ä¾‹æ¨¡æ¿åœ¨ Unity ä¸­çš„å‡ ç§å®ç°ã€‚ä¹‹ååˆå‚è€ƒäº†å…¶ä»–çš„å•ä¾‹åº“çš„å®ç°ï¼Œå€Ÿé‰´(chao)äº†å®ƒä»¬çš„ä¼˜ç‚¹,å€Ÿé‰´äº†å“ªé‡Œæœ‰å£°æ˜åŸä½œè€…ã€‚

## å¿«é€Ÿå¼€å§‹:

å®ç°ä¸€ä¸ªç»§æ‰¿ MonoBehaviour çš„å•ä¾‹ç±»

```csharp
namespace QFramework.Example
{
	[MonoSingletonPath("[Audio]/AudioManager")]
	public class AudioManager : ManagerBase,ISingleton
	{
		public static AudioManager Instance
		{
			get { return QMonoSingletonProperty<AudioManager>.Instance; }
		}
		
		public void OnSingletonInit()
		{
			
		}

		public void Dispose()
		{
			QMonoSingletonProperty<AudioManager>.Dispose();
		}


		public void PlaySound(string soundName)
		{
			
		}

		public void StopSound(string soundName)
		{
			
		}
	}
}
```

ç»“æœå¦‚ä¸‹:
![DraggedImage.png](https://upload-images.jianshu.io/upload_images/2296785-a0d55653522f9037.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
è¿™æ ·ä»å¤´åˆ°å°¾éƒ½å¾ˆï¼ä¼˜ï¼é›…ï¼


## C# å•ä¾‹ç±»

*   Singleton.cs

```csharp
public class GameDataManager : Singleton<GameDataManager>
{
    private static int mIndex = 0;

    private Class2Singleton() {}

    public override void OnSingletonInit()
    {
        mIndex++;
    }

    public void Log(string content)
    {
        Debug.Log(""GameDataManager"" + mIndex + "":"" + content);
    }
}

GameDataManager.Instance.Log(""Hello"");
// GameDataManager1:OnSingletonInit:Hello
GameDataManager.Instance.Log(""Hello"");
// GameDataManager1:OnSingletonInit:Hello
GameDataManager.Instance.Dispose();
```

åªéœ€ç®€å•ç»§æ‰¿QSingletonï¼Œå¹¶å£°æ˜épublicæ„é€ æ–¹æ³•å³å¯ã€‚å¦‚æœæœ‰éœ€è¦è·å–å•ä¾‹åˆå§‹åŒ–çš„æ—¶æœºï¼Œåˆ™å¯ä»¥é€‰æ‹©é‡è½½OnSingletonInitæ–¹æ³•ã€‚

## ç»“æœ:
``` 
Hello World!
Hello World!
```


## Mono å•ä¾‹

* MonoSingleton.cs
```csharp
public class GameManager : MonoSingleton<GameManager>
{
    public override void OnSingletonInit()
    {
        Debug.Log(name + "":"" + ""OnSingletonInit"");
    }

    private void Awake()
    {
        Debug.Log(name + "":"" + ""Awake"");
    }

    private void Start()
    {
        Debug.Log(name + "":"" + ""Start"");
    }

    protected override void OnDestroy()
    {
        base.OnDestroy();
			
        Debug.Log(name + "":"" + ""OnDestroy"");
    }
}

var gameManager = GameManager.Instance;
// GameManager:OnSingletonInit
// GameManager:Awake
// GameManager:Start
// ---------------------
// GameManager:OnDestroy
```


## Mono å±æ€§å•ä¾‹
ä»£ç å¦‚ä¸‹:

* MonoSingletonProperty.cs
```csharp
public class GameManager : MonoBehaviour,ISingleton
{
    public static GameManager Instance
    {
        get { return MonoSingletonProperty<GameManager>.Instance; }
    }
		
    public void Dispose()
    {
    	MonoSingletonProperty<GameManager>.Dispose();
    }
		
    public void OnSingletonInit()
    {
    	Debug.Log(name + "":"" + ""OnSingletonInit"");
    }
    
    private void Awake()
    {
        Debug.Log(name + "":"" + ""Awake"");
    }
    
    private void Start()
    {
        Debug.Log(name + "":"" + ""Start"");
    }
    
    protected void OnDestroy()
    {
        Debug.Log(name + "":"" + ""OnDestroy"");
    }
}
var gameManager = GameManager.Instance;
// GameManager:OnSingletonInit
// GameManager:Awake
// GameManager:Start
// ---------------------
// GameManager:OnDestroy
```

## C# å±æ€§å•ä¾‹

ä»£ç å¦‚ä¸‹ï¼š

* SingletonProperty.cs
```csharp
public class GameDataManager : ISingleton
{
    public static GameDataManager Instance
    {
        get { return SingletonProperty<GameDataManager>.Instance; }
    }

    private GameDataManager() {}
		
    private static int mIndex = 0;

    public void OnSingletonInit()
    {
        mIndex++;
    }

    public void Dispose()
    {
        SingletonProperty<GameDataManager>.Dispose();
    }
		
    public void Log(string content)
    {
        Debug.Log(""GameDataManager"" + mIndex + "":"" + content);
    }
}
 
GameDataManager.Instance.Log(""Hello"");
// GameDataManager1:OnSingletonInit:Hello
 
GameDataManager.Instance.Log(""Hello"");
// GameDataManager1:OnSingletonInit:Hello
 
GameDataManager.Instance.Dispose();
```



## MonoSingletPath é‡å‘½å


ä»£ç å¦‚ä¸‹ï¼š
MonoSingletonPath.csï¼š

```csharp
namespace QFramework.Example
{
	using UnityEngine;

	[MonoSingletonPath("[Example]/MonoSingeltonPath")]
	class ClassUseMonoSingletonPath : QMonoSingleton<ClassUseMonoSingletonPath>
	{
		
	}
	
	public class MonoSingletonPath : MonoBehaviour
	{
		private void Start()
		{
			var intance = ClassUseMonoSingletonPath.Instance;
		}
	}
}
```

## ç»“æœ:
![DraggedImage.png](https://upload-images.jianshu.io/upload_images/2296785-8bf380c8327ffbce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)





## PersistentMonoSingleton

å½“åœºæ™¯é‡ŒåŒ…å«ä¸¤ä¸ª PersistentMonoSingletonï¼Œä¿ç•™å…ˆåˆ›å»ºçš„

```csharp
public class GameManager : PersistentMonoSingleton<GameManager>
{
 
}
 
IEnumerator Start()
{
    var gameManager = GameManager.Instance;
 
    var newGameManager = new GameObject().AddComponent<GameManager>();
 
    yield return new WaitForEndOfFrame();
 
    Debug.Log(FindObjectOfTypes<GameManager>().Length);
    // 1
    Debug.Log(gameManager == null);
    // false
    Debug.Log(newGameManager == null);
    // true
}
```

## ReplaceableMonoSingleton

å½“åœºæ™¯é‡ŒåŒ…å«ä¸¤ä¸ª ReplaceableMonoSingletonï¼Œä¿ç•™æœ€ååˆ›å»ºçš„

```csharp
public class GameManager : ReplaceableMonoSingleton<GameManager>
{
 
}

IEnumerator Start()
{
    var gameManager = GameManager.Instance;
 
    var newGameManager = new GameObject().AddComponent<GameManager>();
 
    yield return new WaitForEndOfFrame();
 
    Debug.Log(FindObjectOfTypes<GameManager>().Length);
    // 1
    Debug.Log(gameManager == null);
    // true
    Debug.Log(newGameManager == null);
    // false
}
```


å…³äº SingletonKit çš„ä»‹ç»å°±åˆ°è¿™ã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.game




# 10. FSMKit çŠ¶æ€æœº

QFramework å†…ç½®äº†ä¸€ä¸ªç®€æ˜“çš„çŠ¶æ€æœºï¼ŒåŸºæœ¬ä½¿ç”¨å¦‚ä¸‹:

## é“¾å¼

```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class IStateBasicUsageExample : MonoBehaviour
    {
        public enum States
        {
            A,
            B
        }

        public FSM<States> FSM = new FSM<States>();

        void Start()
        {
            FSM.State(States.A)
                .OnCondition(()=>FSM.CurrentStateId == States.B)
                .OnEnter(() =>
                {
                    Debug.Log("Enter A");
                })
                .OnUpdate(() =>
                {
                    
                })
                .OnFixedUpdate(() =>
                {
                    
                })
                .OnGUI(() =>
                {
                    GUILayout.Label("State A");
                    if (GUILayout.Button("To State B"))
                    {
                        FSM.ChangeState(States.B);
                    }
                })
                .OnExit(() =>
                {
                    Debug.Log("Enter B");

                });

            FSM.State(States.B)
                .OnCondition(() => FSM.CurrentStateId == States.A)
                .OnGUI(() =>
                {
                    GUILayout.Label("State B");
                    if (GUILayout.Button("To State A"))
                    {
                        FSM.ChangeState(States.A);
                    }
                });
            
            FSM.StartState(States.A);
        }

        private void Update()
        {
            FSM.Update();
        }

        private void FixedUpdate()
        {
            FSM.FixedUpdate();
        }

        private void OnGUI()
        {
            FSM.OnGUI();
        }

        private void OnDestroy()
        {
            FSM.Clear();
        }
    }
}
```

è¿è¡Œä¹‹åï¼Œç»“æœå¦‚ä¸‹:

![1](https://file.liangxiegame.com/c263fec3-02eb-4af6-bb84-a3310440cfa9.gif)

æ²¡å•¥é—®é¢˜ã€‚



## ç±»æ¨¡å¼

é“¾å¼é€‚åˆåœ¨å¿«é€Ÿå¼€å‘é˜¶æ®µï¼Œæˆ–è€…åœ¨çŠ¶æ€éå¸¸å°‘çš„é˜¶æ®µä½¿ç”¨ã€‚



è€Œå¦‚æœçŠ¶æ€è¾ƒå¤šï¼Œæˆ–è€…ç›¸åº”ä»£ç é‡è¾ƒå¤šçš„é˜¶æ®µï¼Œå¯ä»¥ä½¿ç”¨ç±»æ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹:



```csharp
using UnityEngine;

namespace QFramework.Example
{
    public class IStateClassExample : MonoBehaviour
    {

        public enum States
        {
            A,
            B,
            C
        }

        public FSM<States> FSM = new FSM<States>();

        public class StateA : AbstractState<States,IStateClassExample>
        {
            public StateA(FSM<States> fsm, IStateClassExample target) : base(fsm, target)
            {
            }

            protected override bool OnCondition()
            {
                return mFSM.CurrentStateId == States.B;
            }

            public override void OnGUI()
            {
                GUILayout.Label("State A");

                if (GUILayout.Button("To State B"))
                {
                    mFSM.ChangeState(States.B);
                }
            }
        }
        
        
        public class StateB: AbstractState<States,IStateClassExample>
        {
            public StateB(FSM<States> fsm, IStateClassExample target) : base(fsm, target)
            {
            }

            protected override bool OnCondition()
            {
                return mFSM.CurrentStateId == States.A;
            }

            public override void OnGUI()
            {
                GUILayout.Label("State B");

                if (GUILayout.Button("To State A"))
                {
                    mFSM.ChangeState(States.A);
                }
            }
        }

        private void Start()
        {
            FSM.AddState(States.A, new StateA(FSM, this));
            FSM.AddState(States.B, new StateB(FSM, this));

            // æ”¯æŒå’Œé“¾å¼æ¨¡å¼æ··ç”¨
            // FSM.State(States.C)
            //     .OnEnter(() =>
            //     {
            //
            //     });
            
            FSM.StartState(States.A);
        }

        private void OnGUI()
        {
            FSM.OnGUI();
        }

        private void OnDestroy()
        {
            FSM.Clear();
        }
    }
}
```



è¿è¡Œä¹‹åç»“æœå¦‚ä¸‹ã€‚



![1](https://file.liangxiegame.com/c263fec3-02eb-4af6-bb84-a3310440cfa9.gif)

å…³äºçŠ¶æ€æœºçš„ä»‹ç»å°±åˆ°è¿™é‡Œã€‚


## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)

# 11. PoolKit å¯¹è±¡æ± å¥—ä»¶


## SimpleObjectPool ç®€æ˜“å¯¹è±¡æ± 

```csharp
class Fish
{
             
}

var pool = new SimpleObjectPool<Fish>(() => new Fish(),initCount:50);
 
Debug.Log(pool.CurCount);
// 50 
var fish = pool.Allocate();
 
Debug.Log(pool.CurCount);
// 49
pool.Recycle(fish);

Debug.Log(pool.CurCount);
// 50


// ---- GameObject ----
var gameObjPool = new SimpleObjectPool<GameObject>(() =>
{
    var gameObj = new GameObject(""AGameObject"");
    // init gameObj code 

    // gameObjPrefab = Resources.Load<GameObject>(""somePath/someGameObj"");
                
    return gameObj;
}, (gameObj) =>
{
    // reset code here
});
```

## SafeObjectPool å®‰å…¨å¯¹è±¡æ± 

```csharp
class Bullet :IPoolable,IPoolType
{
    public void OnRecycled()
    {
        Debug.Log(""å›æ”¶äº†"");
    }
 
    public  bool IsRecycled { get; set; }
 
    public static Bullet Allocate()
    {
        return SafeObjectPool<Bullet>.Instance.Allocate();
    }
             
    public void Recycle2Cache()
    {
        SafeObjectPool<Bullet>.Instance.Recycle(this);
    }
}
 
SafeObjectPool<Bullet>.Instance.Init(50,25);
             
var bullet = Bullet.Allocate();
 
Debug.Log(SafeObjectPool<Bullet>.Instance.CurCount);
             
bullet.Recycle2Cache();
 
Debug.Log(SafeObjectPool<Bullet>.Instance.CurCount);
 
// can config object factory
// å¯ä»¥é…ç½®å¯¹è±¡å·¥å‚
SafeObjectPool<Bullet>.Instance.SetFactoryMethod(() =>
{
    // bullet can be mono behaviour
    return new Bullet();
});
             
SafeObjectPool<Bullet>.Instance.SetObjectFactory(new DefaultObjectFactory<Bullet>());
 
// can set
// å¯ä»¥è®¾ç½®
// NonPublicObjectFactory: å¯ä»¥é€šè¿‡è°ƒç”¨ç§æœ‰æ„é€ æ¥åˆ›å»ºå¯¹è±¡,can call private constructor to create object
// CustomObjectFactory: è‡ªå®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ–¹å¼,can create object by Func<T>
// DefaultObjectFactory: é€šè¿‡ new åˆ›å»ºå¯¹è±¡, can create object by new 
```

## åŸºæœ¬çš„æ•°æ®ç»“æ„å°è£… Listã€Dictionary

```csharp
var names = ListPool<string>.Get()
names.Add(""Hello"");

names.Release2Pool();
// or ListPool<string>.Release(names);
```


```csharp
var infos = DictionaryPool<string,string>.Get()
infos.Add(""name"",""liangxie"");

infos.Release2Pool();
// or DictionaryPool<string,string>.Release(names);
```

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
# 12. TableKit è¡¨æ•°æ®ç»“æ„

åœ¨è®¾è®¡ UIKitã€ResKit ç­‰ç³»ç»Ÿæ—¶ï¼Œå¦‚æœåªä½¿ç”¨é»˜è®¤çš„ List å’Œ Dictionary æ¥ç®¡ç†æ•°æ®å’Œå¯¹è±¡éœ€è¦åšå¾ˆå¤šçš„å°è£…ã€‚

å› ä¸ºæœ¬èº« List å’Œ Dictionary æ”¯æŒçš„æŸ¥è¯¢æ–¹å¼æ¯”è¾ƒå•ä¸€ï¼Œå¦‚æœæƒ³åšä¸€äº›æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚è”åˆæŸ¥è¯¢ï¼Œé‚£ä¹ˆ List å’Œ Dictionary çš„æ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚

æ‰€ä»¥ä¸ºæ­¤ï¼Œç¬”è€…ç®€å•å°è£…äº†ä¸€ä¸ª Table æ•°æ®ç»“æ„ã€‚

ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹:

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

namespace QFramework
{
    public class TableKitExample : MonoBehaviour
    {
        public class Student
        {
            public string Name { get; set; }
            public int Age { get; set; }
            public int Level { get; set; }
        }
        public class School : Table<Student>
        {
            public TableIndex<int, Student> AgeIndex = new TableIndex<int, Student>((student) => student.Age);
            public TableIndex<int, Student> LevelIndex = new TableIndex<int, Student>((student) => student.Level);
            
            protected override void OnAdd(Student item)
            {
                AgeIndex.Add(item);
                LevelIndex.Add(item);
            }

            protected override void OnRemove(Student item)
            {
                AgeIndex.Remove(item);
                LevelIndex.Remove(item);
            }

            protected override void OnClear()
            {
                AgeIndex.Clear();
                LevelIndex.Clear();
            }

            public override IEnumerator<Student> GetEnumerator()
            {
                return AgeIndex.Dictionary.Values.SelectMany(s=>s).GetEnumerator();
            }

            protected override void OnDispose()
            {
                AgeIndex.Dispose();
                LevelIndex.Dispose();
            }
        }


        private void Start()
        {
            var school = new School();
            school.Add(new Student(){Age = 1,Level = 2,Name = "liangxie"});
            school.Add(new Student(){Age = 2,Level = 2,Name = "ava"});
            school.Add(new Student(){Age = 3,Level = 2,Name = "abc"});
            school.Add(new Student(){Age = 3,Level = 3,Name = "efg"});
            
            foreach (var student in school.LevelIndex.Get(2).Where(s=>s.Age < 3))
            {
                Debug.Log(student.Age + ":" + student.Level + ":" + student.Name);
            }
        }
    }
}
// 1:2:liangxie
// 2:2:ava
```


TableKit å…¼é¡¾æŸ¥è¯¢åŠŸèƒ½æ”¯æŒå’Œæ€§èƒ½ï¼Œåœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¹‹é—´å–å¾—äº†ä¸€ä¸ªå¹³è¡¡ã€‚

ResKitã€UIKit çš„æ•°æ®ç®¡ç†å…¨éƒ¨ç”± TableKit æ”¯æŒã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)


# 13. å…¶ä»–äº‹ä»¶å·¥å…·

QFramework é™¤äº†æ”¯æŒäº†  TypeEventSystemã€EasyEvent è¿˜æ”¯æŒäº† EnumEventSystemã€StringEventSystemã€‚


## EnumEventSystem

EnumEventSystem å‰èº«æ˜¯ è€ç‰ˆæœ¬ QFramework çš„ QEventSystem

``` csharp
using UnityEngine;

namespace QFramework
{
	public class EnumEventExample : MonoBehaviour
	{
		#region äº‹ä»¶å®šä¹‰

		public enum TestEvent
		{
			Start,
			TestOne,
			End,
		}

		public enum TestEventB
		{
			Start = TestEvent.End, // ä¸ºäº†ä¿è¯æ¯ä¸ªæ¶ˆæ¯ Id å”¯ä¸€ï¼Œéœ€è¦å¤´å°¾ç›¸æ¥
			TestB,
			End,
		}

		#endregion äº‹ä»¶å®šä¹‰
		
		void Start()
		{
			EnumEventSystem.Global.Register(TestEvent.TestOne, OnEvent);
		}

		void OnEvent(int key, params object[] obj)
		{
			switch (key)
			{
				case (int) TestEvent.TestOne:
					Debug.Log(obj[0]);
					break;
			}
		}

		private void Update()
		{
			if (Input.GetMouseButtonDown(0))
			{
				EnumEventSystem.Global.Send(TestEvent.TestOne, "Hello World!");
			}
		}

		private void OnDestroy()
		{
			EnumEventSystem.Global.UnRegister(TestEvent.TestOne, OnEvent);
		}
	}
}
```


## StringEventSystem

StringEventSystem çš„å‰èº«æ˜¯ï¼Œè€ç‰ˆæœ¬çš„ MsgDispatcher

``` csharp
using UnityEngine;

namespace QFramework
{
	public class EnumEventExample : MonoBehaviour
	{
		#region äº‹ä»¶å®šä¹‰

		public enum TestEvent
		{
			Start,
			TestOne,
			End,
		}

		public enum TestEventB
		{
			Start = TestEvent.End, // ä¸ºäº†ä¿è¯æ¯ä¸ªæ¶ˆæ¯ Id å”¯ä¸€ï¼Œéœ€è¦å¤´å°¾ç›¸æ¥
			TestB,
			End,
		}

		#endregion äº‹ä»¶å®šä¹‰
		
		void Start()
		{
			EnumEventSystem.Global.Register(TestEvent.TestOne, OnEvent);
		}

		void OnEvent(int key, params object[] obj)
		{
			switch (key)
			{
				case (int) TestEvent.TestOne:
					Debug.Log(obj[0]);
					break;
			}
		}

		private void Update()
		{
			if (Input.GetMouseButtonDown(0))
			{
				EnumEventSystem.Global.Send(TestEvent.TestOne, "Hello World!");
			}
		}

		private void OnDestroy()
		{
			EnumEventSystem.Global.UnRegister(TestEvent.TestOne, OnEvent);
		}
	}
}
// è¾“å‡ºç»“æœ
// ç‚¹å‡»é¼ æ ‡å·¦é”®
// Hello World
```


## StringEventSystem

``` csharp
using UnityEngine;

namespace QFramework.Example
{
    public class StringEventSystemExample : MonoBehaviour
    {
        void Start()
        {
            StringEventSystem.Global.Register("TEST_ONE", () =>
            {
                Debug.Log("TEST_ONE");
            }).UnRegisterWhenGameObjectDestroyed(gameObject);
            
            // äº‹ä»¶ + å‚æ•°
            StringEventSystem.Global.Register<int>("TEST_TWO", (count) =>
            {
                Debug.Log("TEST_TWO:" + count);

            }).UnRegisterWhenGameObjectDestroyed(gameObject);
        }

        private void Update()
        {
            if (Input.GetMouseButtonDown(0))
            {
                StringEventSystem.Global.Send("TEST_ONE");
                StringEventSystem.Global.Send("TEST_TWO",10);
                
            }
        }
    }
}

// è¾“å‡ºç»“æœ
// ç‚¹å‡»é¼ æ ‡å·¦é”®
// TEST_ONE
// TEST_TWO:10

```




## å¯¹æ¯”

* TypeEventSystemï¼š
  * äº‹ä»¶ä½“å®šä¹‰ç®€æ´
  * æ¯”è¾ƒé€‚åˆç”¨äºè®¾è®¡æ¡†æ¶
  * æ”¯æŒ struct è·å¾—è¾ƒå¥½å†…å­˜æ€§èƒ½
  * ä½¿ç”¨åå°„ï¼ŒCPU æ€§èƒ½ç›¸å¯¹æ¯”è¾ƒå·®

* EasyEvent
  * æ–¹ä¾¿ã€æ˜“ç”¨ã€å¼€å‘æ•ˆç‡é«˜
  * CPU æ€§èƒ½ã€å†…å­˜æ€§èƒ½è¾ƒå¥½ï¼Œæ¥è¿‘å§”æ‰˜
  * åŠŸèƒ½æœ‰é™
  * æ¯”è¾ƒé€‚åˆè®¾è®¡é€šç”¨è§£å†³å·¥å…·ï¼Œæ¯”å¦‚é€šç”¨èƒŒåŒ…ã€å…¨å±€ç”Ÿå‘½å‘¨æœŸè§¦å‘ç­‰
  * StringEventSystemã€TypeEventSystem çš„åº•å±‚ç”± EasyEvent å®ç°

* EnumEventSystem
  * ä½¿ç”¨æšä¸¾ä½œä¸ºäº‹ä»¶ idï¼Œæ¯”è¾ƒé€‚åˆå’ŒæœåŠ¡ç«¯çš„ protobuf æˆ–å¸¦æœ‰æ¶ˆæ¯ id çš„é•¿é“¾æ¥é€šä¿¡
  * æ€§èƒ½è¾ƒå¥½
  * æšä¸¾ç”¨äºå®šä¹‰æ¶ˆæ¯ä½“æœ‰ç»´æŠ¤æˆæœ¬

* StringEventSystem
  * ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºäº‹ä»¶ idï¼Œæ¯”è¾ƒé€‚åˆå’Œå…¶ä»–è„šæœ¬å±‚é€šä¿¡ï¼Œæ¯”å¦‚ Luaã€ILRuntimeã€PlayMaker ç­‰ã€‚
  * æ€§èƒ½ä¸€èˆ¬


ç›®å‰å®˜æ–¹æ¨èä½¿ç”¨ TypeEventSystem å’Œ EasyEvent è¿™ä¸¤ä¸ªå·¥å…·ã€‚

å¦‚æœè¦å’Œç½‘ç»œé€šä¿¡åˆ™é€‰æ‹©ç”¨ EnumEventSystemã€‚

å¦‚æœè¦å’Œå…¶ä»–è„šæœ¬å±‚é€šä¿¡é€‰æ‹©ç”¨ StringEventSystemã€‚

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
    
    
    
        
# 14. æ›´å¤šå†…å®¹


## æ¡ˆä¾‹ã€Šäº”å­æ£‹ã€‹

![2f4dacbd-e59b-43af-b7be-44220fac664e.png](https://file.liangxiegame.com/a76bc24a-1828-46f2-94c5-8bd24884f932.png)


æºç åœ°å€:
* github https://github.com/liangxiegame/QFramework
* gitee https://gitee.com/liangxiegame/QFramework

![image.png](https://file.liangxiegame.com/3abceb70-2d17-4457-aff1-ef8a6ef4bd66.png)

## æ¡ˆä¾‹ã€Šæ‰«é›·ã€‹

ä½œè€…ï¼šJoker

![172348_4d54744e_5161625.webp](https://file.liangxiegame.com/c6116b7e-a08b-4c13-ae64-7053be3c503c.png)

æºç åœ°å€:
* github https://github.com/liangxiegame/QFramework
* gitee https://gitee.com/liangxiegame/QFramework

![image.png](https://file.liangxiegame.com/6482d4eb-5af9-4932-a2f8-2164cb22e931.png)

## æ›´å¤šå†…å®¹

*   è½¬è½½è¯·æ³¨æ˜åœ°å€ï¼š[liangxiegame.com](https://liangxiegame.com) ï¼ˆé¦–å‘ï¼‰ å¾®ä¿¡å…¬ä¼—å·ï¼šå‡‰é‹çš„ç¬”è®°
*   QFramework ä¸»é¡µï¼š[qframework.cn](https://qframework.cn)
*   QFramework äº¤æµç¾¤: 623597263
*   QFramework Github åœ°å€: [https://github.com/liangxiegame/qframework](https://github.com/liangxiegame/qframework)
*   QFramework Gitee åœ°å€ï¼š[https://gitee.com/liangxiegame/QFramework](https://gitee.com/liangxiegame/QFramework)
*   GamePix ç‹¬ç«‹æ¸¸æˆå­¦é™¢ & Unity è¿›é˜¶å°ç­åœ°å€ï¼š[https://www.gamepixedu.com/](https://www.gamepixedu.com/)
